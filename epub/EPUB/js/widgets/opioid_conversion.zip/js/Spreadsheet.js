!function(e){function t(t){for(var r,a,s=t[0],u=t[1],l=t[2],d=0,f=[];d<s.length;d++)a=s[d],o[a]&&f.push(o[a][0]),o[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(c&&c(t);f.length;)f.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var u=n[s];0!==o[u]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={32:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/js/";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var c=u;i.push([729,0]),n()}({1:function(e,t,n){var r=n(56),o=n(133);o.default&&(o=o.default);var i={ADD_ATTR:["target","autocorrect","marker"]},a=o();r.fn.extend({sanitizeHtml:function(e,t){return a.sanitize(e,t||i)},safeHtml:function(e,t){return null==e?this.html():this.html(this.sanitizeHtml(e,t))},safeAppend:function(e,t){return null==e?this.append(null):this.append(this.sanitizeHtml(e,t))},safeAttr:function(e,t){var n=this.get(0).tagName;return a.isValidAttribute(n,e,t)?this.attr(e,t):this},isSafeURLForNavigation:function(e){return a.isValidAttribute("a","href",e)}}),e.exports=r},100:function(e,t){e.exports=window.Blob},101:function(e,t,n){var r=n(4).getDateString,o=n(14).pick,i=function(e,t,n,i,a,s){var u=s.bwConfig,l=s.studentinfo,c=s.tr,d=u.getConfigSync(),f=i.getParameters();function p(e){return!e||0===e.length}function h(t){return t.indexOf("bookwidgets.com")>=0||t.indexOf("localhost")>=0?{"Bookwidgets-Platform":e.getPlatform()}:{}}function g(){return f.teacher_id}function m(){return f.school_id}function v(){return f.hasOwnProperty("wv")}return{createStudentWorkSubmitter:function(s,u,b,w){var y={FLD_STUDENT_NAME:"#student",FLD_STUDENT_ACCOUNT:"#student_account",FLD_STUDENT_EMAIL:"#student_email",FLD_STUDENT_ID:"#student_id",FLD_STUDENT_CLASS_ID:"#student_class_id",FLD_TEACHER_EMAIL:"#email",FLD_YOUR_NAME:"#you",FLD_YOUR_EMAIL:"#your_email",FLD_TO_EMAIL:"#to_email"},C={};C[y.FLD_STUDENT_NAME]="student_name",C[y.FLD_STUDENT_EMAIL]="student_email",C[y.FLD_STUDENT_ID]="student_id",C[y.FLD_STUDENT_CLASS_ID]="student_class_id",C[y.FLD_TEACHER_EMAIL]="teacher_email",C[y.FLD_YOUR_NAME]="student_name",C[y.FLD_YOUR_EMAIL]="student_email",C[y.FLD_TO_EMAIL]="to_email";var D=g(),A=m();y._postdata={test_name:s,uuid2:b,WA:w,book_title:u,submit_timestamp:(new Date).toISOString(),submit_date:r(),tzoffset:(new Date).getTimezoneOffset()/60*-1,include_grading:!0,submitted_via_shortcode:window.bwshortcode,answers:[]},"wv"in f&&(y._postdata.wv=f.wv),y._extradata={},y._answersComposer=void 0,y._assetUploadAgenda=[],y._eventCallbacks={},y._lastServerResponse="",y._lastServerData=null,y._leftButtons=[],y._rightButtons=[],y._dialogOptions={},y._endpoint="",y._fieldSettings={},y.setCompanyInfo=function(e,t,n,r){y._postdata.company_name=e,y._postdata.company_address=t,y._postdata.company_phone=n,y._postdata.company_website=r},y.setIncludeGrading=function(e){y._postdata.include_grading=e?"yes":"no"},y.setElapsedTime=function(e){y._postdata.time=e},y.setEndpoint=function(e){y._endpoint=e},y._storeField=function(e,t){var n=y._fieldSettings[e].isVisible,r=y._fieldSettings[e].isEditable;if(n&&r){var o=C[e];l.set(o,t)}},y._setStudentInfo=function(e,t,n,r){y._postdata.student_name=e,y._postdata.student_id=t,y._postdata.student_email=n,y._postdata.student_class_id=r,l.hasStudentAccount()&&(y._postdata.student_userid=l.getStudentAccountUserId(),y._postdata.student_name=l.getStudentAccountUserName(),y._postdata.student_email=l.getStudentAccountEmail(),y._postdata.student_id=l.getStudentAccountProviderHumanId(),y._postdata.student_token=l.getStudentAccountToken());var o=f.context_id;o&&(y._postdata.context_id=o),D&&(y._postdata.teacher_id=D),f.course_id&&(y._postdata.course_id=f.course_id),A&&(y._postdata.school_id=A),y._storeField(y.FLD_STUDENT_NAME,e),y._storeField(y.FLD_STUDENT_ID,t),y._storeField(y.FLD_STUDENT_EMAIL,n),y._storeField(y.FLD_STUDENT_CLASS_ID,r)},y._setTeacherEmail=function(e){y._postdata.teacher_email=e,y._storeField(y.FLD_TEACHER_EMAIL,e)},y._setShareInfo=function(e,t,n,r){y._postdata.student_name=e,y._postdata.student_email=t,y._postdata.to_email=n,y._postdata.message=r,y._storeField(y.FLD_YOUR_NAME,e),y._storeField(y.FLD_YOUR_EMAIL,t),y._storeField(y.FLD_TO_EMAIL,n)},y._setDownloadInfo=function(e,t,n,r){y._postdata.student_name=e,y._storeField(y.FLD_YOUR_NAME,e)},y.setAnswersComposer=function(e){y._answersComposer=e},y.addExtraData=function(e){for(var t in e)y._extradata[t]=e[t]},y.scheduleAssetUpload=function(e,t,n){y._assetUploadAgenda.push({assetFetcherCB:e,assetUploadCompleteCB:t,userdata:n})},y.configureFormField=function(e,t,n,r){y._fieldSettings[e]={isVisible:t,isEditable:n,defaultValue:r}},y.configureFormField(y.FLD_STUDENT_ACCOUNT,!0===l.hasStudentAccount(),!1,l.getStudentAccountUserName()||""),y.configureFormField(y.FLD_STUDENT_NAME,!1===l.hasStudentAccount()&&"yes"==d.student_name_isVisible,"yes"==d.student_name_isEditable,d.student_name_defaultValue),y.configureFormField(y.FLD_STUDENT_EMAIL,!1===l.hasStudentAccount()&&"yes"==d.student_email_isVisible,"yes"==d.student_email_isEditable,d.student_email_defaultValue),y.configureFormField(y.FLD_STUDENT_ID,!1===l.hasStudentAccount()&&"yes"==d.student_id_isVisible,"yes"==d.student_id_isEditable,d.student_id_defaultValue);var E=p(f.student_class_id)?p(l.getStudentAccountClassName())?void 0:l.getStudentAccountClassName():f.student_class_id,_="yes"==d.student_class_id_isEditable&&!E;function S(e,n,r,o){var i,a=t(document.createElement("label"));a.attr("for",n),a.attr("id",n+"_label"),a.text(e),o.append(a),"textarea"==r?(i=t(document.createElement("textarea"))).attr("rows",5):((i=t(document.createElement("input"))).attr("type",r),i.on("focus",function(){this.value=this.value})),i.attr("name",n),i.attr("id",n),i.attr("value",""),o.append(i)}function k(e){return e.split(",").length>1}function x(t,n){var r={content:"",ibw_platform:e.getPlatform()};for(var o in y._extradata)r[o]=y._extradata[o];void 0===y._submitPreparer&&(y._submitPreparer=function(e){e()}),y.showProgressDialog(n),setTimeout(function(){y._submitPreparer(function(){y.uploadAssets(function(){console.log("All assets uploaded, now sending answers"),y.composeAllAnswers(),r.content=JSON.stringify(y._postdata),t(r),y.trigger(y.EVT_AFTER_SEND),console.log("Submit complete")},function(){console.log("Asset upload failed, aborting"),y.closeProgressDialog(),y.trigger(y.EVT_SUBMIT_FAILED),y.trigger(y.EVT_AFTER_SEND)})},function(e){console.log("Aborted by client: "+e),y.closeProgressDialog(),y._lastServerResponse=void 0,y.trigger(y.EVT_SUBMIT_FAILED),y.trigger(y.EVT_AFTER_SEND)})},100)}function O(){x(y.sendResults.bind(y),c("Sending, please wait..."))}function I(){var e=t(this),r=e.find("#student").val(),o=e.find("#student_id").val(),i=e.find("#student_email").val(),a=e.find("#student_class_id").val(),s=e.find("#email").val();if(!1!==l.hasStudentAccount()||""!==r){if(!D){if(!(null!=s&&""!==s||"yes"===d.teacher_email_isVisible&&"yes"===d.teacher_email_isEditable||!1!==v()))return void n.showAlert(c("This field is required:")+" "+c("Teacher Email"),c("Send Failed"));if(k(s))return void n.showAlert(c("You can't specify multiple addresses for field:")+" "+c("Teacher Email"),c("Send Failed"))}e.dialog("close"),e.remove(),y.trigger(y.EVT_BEFORE_SEND),y._setStudentInfo(r,o,i,a),y._setTeacherEmail(s),O()}else n.showAlert(c("This field is required:")+" "+c("Student Name"),c("Send Failed"))}function F(){var e=t(this),r=e.find("#you").val(),o=e.find("#your_email").val(),i=e.find("#to_email").val(),a=e.find("#message").val();""!==r?""!==i?(e.dialog("close"),e.remove(),y.trigger(y.EVT_BEFORE_SEND),y._setShareInfo(r,o,i,a),O()):n.showAlert(c("This field is required:")+" "+c("To Email"),c("Send Failed")):n.showAlert(c("This field is required:")+" "+c("Your Name"),c("Send Failed"))}function T(){var e=t(this),r=e.find("#you").val();""!==r?(e.dialog("close"),e.remove(),y.trigger(y.EVT_BEFORE_SEND),y._setDownloadInfo(r),x(y.generate.bind(y),c("Generating PDF, please wait..."))):n.showAlert(c("This field is required:")+" "+c("Your Name"),c("Download Failed"))}return y.configureFormField(y.FLD_STUDENT_CLASS_ID,"yes"==d.student_class_id_isVisible,_,p(E)?p(d.student_class_id_defaultValue)?"":d.student_class_id_defaultValue:E),y.configureFormField(y.FLD_TEACHER_EMAIL,"yes"==d.teacher_email_isVisible&&!D&&!A,"yes"==d.teacher_email_isEditable,D||d.teacher_email_defaultValue),y.configureFormField(y.FLD_YOUR_NAME,!0,!0,""),y.configureFormField(y.FLD_YOUR_EMAIL,!0,!0,""),y.configureFormField(y.FLD_TO_EMAIL,!0,!0,""),y.addButtonBeforeDefaultButtons=function(e,t){y._leftButtons.push({text:e,click:t})},y.addButtonAfterDefaultButtons=function(e,t){y._rightButtons.push({text:e,click:t})},y.addDialogOptions=function(e){for(var t in e)y._dialogOptions[t]=e[t]},y.setAsyncSubmitPreparer=function(e){y._submitPreparer=e},y.EVT_BEFORE_SHOW="beforeShow",y.EVT_BEFORE_SEND="beforeSend",y.EVT_AFTER_SEND="afterSend",y.EVT_SUBMIT_SUCCEEDED="submitSucceeded",y.EVT_SUBMIT_FAILED="submitFailed",y.on=function(e,t){y._eventCallbacks[e]?y._eventCallbacks[e].push(t):(y._eventCallbacks[e]=[],y._eventCallbacks[e].push(t))},y.trigger=function(e){if(y._eventCallbacks[e])for(var t=0;t<y._eventCallbacks[e].length;++t)y._eventCallbacks[e][t]()},y._applyFormFieldSettings=function(e){if(0!=(a=t(e)).length){var n=t(e+"_label"),r=y._fieldSettings[e].isVisible,o=y._fieldSettings[e].isEditable,i=y._fieldSettings[e].defaultValue;k(i)&&(r&&o?function(e,n){for(var r=t(e),o=t(document.createElement("select")).attr({id:r.attr("id"),name:r.attr("name")}),i=0;i<n.length;++i)t(document.createElement("option")).safeHtml(n[i]).appendTo(o);r.replaceWith(o),r.remove()}(e,function(e){for(var t=e.split(","),n=[],r=0;r<t.length;++r)n.push(t[r].trim());return n}(i)):i=i.split(",")[0]);var a=t(e);if(n=t(e+"_label"),!1===r&&(a.hide(),n.hide()),!1===o&&a.attr("disabled","true"),a.val(i),r&&o){var s=C[e];l.get(s,function(e){null!=e&&""!==e&&a.val(e)})}}},y.showSendDialog=function(e,r){l.initialized().done(function(){if(l.isCoAccount())n.showAlert(c("Submit is disabled because you're not logged in with a student account. e.g. a parent account."),c("Can't submit"));else{var o=function(){t("#student-work-submitter-dialog").remove();var e=t(document.createElement("div"));e.attr("id","student-work-submitter-dialog"),e.css("display","none");var n=t(document.createElement("div"));return n.attr("id","student-work-submitter-dialog-info"),e.append(n),S("","student_account","text",e),S(c("Student Name"),"student","text",e),S(c("Student ID"),"student_id","text",e),S(c("Student Email"),"student_email","email",e),S(c("Class ID"),"student_class_id","text",e),S(c("Teacher Email"),"email","email",e),t("body").append(e),e}(),s=!1;for(var u in y._fieldSettings)y._applyFormFieldSettings(u),s=s||y._fieldSettings[u].isVisible&&y._fieldSettings[u].isEditable&&t(u).length>0;e?(t("#student-work-submitter-dialog-info").safeHtml(e),t("#student-work-submitter-dialog-info").removeClass("hidden")):t("#student-work-submitter-dialog-info").addClass("hidden");for(var d=[],f=0;f<y._leftButtons.length;++f)d.push(y._leftButtons[f]);for(d.push({text:c("Send"),click:I}),f=0;f<y._rightButtons.length;++f)d.push(y._rightButtons[f]);var p={dialogClass:"bw-dialog bw-student-work-submitter",modal:!0,title:c("Send Answer"),width:Math.min(450,.9*t(window).width())+"px",buttons:d};for(var h in y._dialogOptions)p[h]=y._dialogOptions[h];o.dialog(p);var g=i.getParameters(!1).toplevel;s||1!==d.length||!r||!a.isLTI()||g||I.call(o)}})},y.showShareDialog=function(e){console.log("showShare"),l.initialized().done(function(){var n=function(){t("#student-work-share-dialog").remove();var e=t(document.createElement("div"));e.attr("id","student-work-share-dialog"),e.css("display","none");var n=t(document.createElement("div"));return n.attr("id","student-work-share-dialog-info"),e.append(n),S(c("Your Name"),"you","text",e),S(c("Your Email"),"your_email","email",e),S(c("To Email"),"to_email","email",e),S(c("Optional Message"),"message","textarea",e),t("body").append(e),e}();for(var r in y._fieldSettings)y._applyFormFieldSettings(r);e?(t("#student-work-share-dialog-info").safeHtml(e),t("#student-work-share-dialog-info").removeClass("hidden")):t("#student-work-share-dialog-info").addClass("hidden");for(var o=[],i=0;i<y._leftButtons.length;++i)o.push(y._leftButtons[i]);for(o.push({text:c("Send"),click:F}),i=0;i<y._rightButtons.length;++i)o.push(y._rightButtons[i]);var a={dialogClass:"bw-dialog bw-student-work-submitter",modal:!0,title:c("Share"),width:Math.min(450,.9*t(window).width())+"px",buttons:o};for(var s in y._dialogOptions)a[s]=y._dialogOptions[s];n.dialog(a)})},y.showDownloadDialog=function(e){console.log("showDownload"),l.initialized().done(function(){var n=function(){t("#student-work-download-dialog").remove();var e=t(document.createElement("div"));e.attr("id","student-work-download-dialog"),e.css("display","none");var n=t(document.createElement("div"));return n.attr("id","student-work-download-dialog-info"),e.append(n),S(c("Your Name"),"you","text",e),t("body").append(e),e}();for(var r in y._fieldSettings)y._applyFormFieldSettings(r);e?(t("#student-work-download-dialog-info").safeHtml(e+"<br>"),t("#student-work-download-dialog-info").removeClass("hidden")):t("#student-work-download-dialog-info").addClass("hidden");for(var o=[],i=0;i<y._leftButtons.length;++i)o.push(y._leftButtons[i]);for(o.push({text:c("Generate"),click:T}),i=0;i<y._rightButtons.length;++i)o.push(y._rightButtons[i]);var a={dialogClass:"bw-student-work-submitter",modal:!0,title:c("Download as PDF"),width:Math.min(450,.9*t(window).width())+"px",buttons:o};for(var s in y._dialogOptions)a[s]=y._dialogOptions[s];n.dialog(a)})},y.showProgressDialog=function(e){(function(){var e="student-work-submitter-progress-dialog";t("#"+e).remove();var n=t(document.createElement("div"));n.attr("id",e),n.css("display","none");var r=t(document.createElement("div"));r.addClass("spinner"),n.append(r);var o=t(document.createElement("div"));return o.addClass("progress-message"),o.text(c("Uploading your answers...")),n.append(o),t("body").append(n),n})().dialog({modal:!0,dialogClass:"no-close bw-dialog",title:e})},y.updateProgressMessage=function(e){t(".progress-message").text(e)},y.closeProgressDialog=function(){t("#student-work-submitter-progress-dialog").remove()},y.uploadAssets=function(e,t){var n=y._assetUploadAgenda,r=null,o=0,i=n.length;(r=function(){if(n.length>0){var a=n.shift(),s=a.assetFetcherCB(a.userdata);console.log("Uploading",s),++o,s?(y.updateProgressMessage(("audio/mpeg"===s.mimetype?c("Uploading audio"):c("Uploading image"))+" "+o+" / "+i),y.sendAsset(s,function(e){a.assetUploadCompleteCB(e,a.userdata),r()},function(){y._lastServerResponse=void 0,t()})):r()}else y.updateProgressMessage(c("Uploading your answers...")),e()})()},y.sendAssetAjax=function(e,n,r){var o={content:JSON.stringify({is_asset:!0,asset_data:e.data,asset_mimetype:e.mimetype})};for(var i in y._extradata)o[i]=y._extradata[i];t.ajax({type:"POST",headers:h(y._endpoint),url:y._endpoint,data:o,success:function(e){n(e)},error:function(){r()}})},y.genRandomString=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},y.sendAsset=y.sendAssetAjax,y.composeAllAnswers=function(){y._postdata.answers=y._answersComposer()},y.sendAudioPacket=function(e,n,r,o,i){var a=y._endpoint+".m4a?t="+e+"&d="+n+"&p="+r,s=new Audio;t(s).on("loadedmetadata",function(){var e=Math.floor(10*t(this)[0].duration);o(e)}),t(s).on("error",function(){console.log("Audio package load failure: "+s.error.code),i("Network or server problem")}),s.src=a},y.getPacket=function(e){for(var t=0,n=e.length,r=0,o="",i="";;){var a=n-t;if(0===a)break;var s=e.substr(t,100),u=encodeURIComponent(s),l=u.length;if(r+l>1900){i=e.substr(t);break}t+=a<100?a:100,o+=u,r+=l}return{packet:o,remaining:i}},y.sendAudio=function(e,t,n,r,o){void 0===r&&(r=y.genRandomString(20)),void 0===o&&(o=1);var i,a=y.getPacket(e);""===a.remaining?(i=t,o=0):i=function(e,t,n){return function(i){0===i?y.sendAudio(e,t,n,r,o+1):n("Wrong server response")}}(a.remaining,t,n),y.sendAudioPacket(r,a.packet,o,i,n)},y.sendResultsAudio=function(e){y.sendAudio(JSON.stringify(e),function(e){switch(console.log("sendAudio success handler called"),y.closeProgressDialog(),e){case 0:console.error("Oops, server expected another packet..."),y._lastServerResponse=void 0,y.trigger(y.EVT_SUBMIT_FAILED);break;case 1:console.log("That's a success!"),y.trigger(y.EVT_SUBMIT_SUCCEEDED);break;case 2:console.error("Network or server error"),y._lastServerResponse="NEWUSER",y.trigger(y.EVT_SUBMIT_FAILED);break;case 3:console.error("Network or server error"),y._lastServerResponse="USERNOTACTIVE",y.trigger(y.EVT_SUBMIT_FAILED);break;case 4:console.error("Network or server error"),y._lastServerResponse="INVALIDUSER",y.trigger(y.EVT_SUBMIT_FAILED);break;case 5:console.error("Network or server error"),y._lastServerResponse="STUDENTNOTAUTHORIZED",y.trigger(y.EVT_SUBMIT_FAILED);break;default:console.error("Unexpected server return value"),y._lastServerResponse=void 0,y.trigger(y.EVT_SUBMIT_FAILED)}},function(e){console.error("sendAudio error handler called: "+e),y.closeProgressDialog(),y._lastServerResponse=void 0,y.trigger(y.EVT_SUBMIT_FAILED)})},y.sendResultsAjax=function(e){e.accept_json_response=!0,d.hasOwnProperty("widget_language")&&""!=d.widget_language&&(e.lang=d.widget_language),t.ajax({type:"POST",headers:h(y._endpoint),url:y._endpoint,data:e,success:function(e,t,n){console.log("Submit OK"),y.closeProgressDialog();var r=n.getResponseHeader("Content-Type");switch(y._lastServerResponse=e,y._lastServerMessage=null,y._lastServerData=null,r){case"application/json":e.hasOwnProperty("status")&&"OK"===e.status?(console.log("That's a success!"),y._lastServerData=o(e,["data","messages"]),y.trigger(y.EVT_SUBMIT_SUCCEEDED)):e.hasOwnProperty("code")?(console.log("That's a failure!",e),y._lastServerResponse=e.code,y._lastServerMessage=e.message,y.trigger(y.EVT_SUBMIT_FAILED)):(console.log("That's a success!"),y.trigger(y.EVT_SUBMIT_SUCCEEDED));break;case"text/html":console.log("That's a success!"),y.trigger(y.EVT_SUBMIT_SUCCEEDED);break;default:"OK"==e?(console.log("That's a success!"),y.trigger(y.EVT_SUBMIT_SUCCEEDED)):(console.log("That's a failure!"),y.trigger(y.EVT_SUBMIT_FAILED))}},error:function(e){console.error("AJAX error handler called");try{var t=JSON.parse(e.responseText);y._lastServerResponse=null,y._lastServerData=null,y._lastServerMessage=t.message}catch(e){console.error("Error msg not json"),y._lastServerResponse=void 0}y.closeProgressDialog(),y.trigger(y.EVT_SUBMIT_FAILED)}})},y.generate=function(e){t.ajax({type:"POST",headers:h(y._endpoint),url:y._endpoint,data:e,success:function(e,r,o){var i,a,s;console.log("AJAX success handler called"),y.closeProgressDialog(),"application/json"==o.getResponseHeader("Content-Type")?(console.log("That's a success!"),y._lastServerResponse=e,i=e.url,a=e.filename,s=t(document.createElement("div")).append(t(document.createElement("a")).attr({href:i,download:a}).safeHtml(c("Click here to download your PDF"))),n.showAlert(s.html(),c("PDF generated"))):(console.log("That's a failure!"),y._lastServerResponse=e,n.showAlert(c("Could not generate PDF.  Please try again later."),c("Generate PDF failed")))},error:function(){console.log("AJAX error handler called"),y.closeProgressDialog(),y._lastServerResponse=void 0,n.showAlert(c("Could not generate PDF.  Please try again later."),c("Generate PDF failed"))}})},y.sendResults="ibw-platform-ipad-ibooks-epub"==e.getPlatform()?y.sendResultsAudio:y.sendResultsAjax,y.getLastServerResponse=function(){return y._lastServerResponse},y.getLastServerMessage=function(){return y._lastServerMessage},y.getLastServerData=function(){return y._lastServerData},y.afterSubmitFailed=function(e,t){var r="",o=this.getLastServerResponse();if(o)if(r=e+"<br><br>","NEWUSER"===o)r+=c("The email address you provided has not been registered.")+"<br><br>",r+=c("To prevent abuse, results can only be sent to registered email addresses.")+" ",r+=c("Activate by clicking on the link in the email which was sent to the address provided.")+" ",r+=c("You can also register at www.bookwidgets.com.")+"<br>";else if("USERNOTACTIVE"===o)r+=c("The email address you provided has not been activated.")+"<br><br>",r+=c("To prevent abuse, results can only be sent to registered email addresses.")+" ",r+=c("Activate by clicking on the link in the email which was sent to the address provided.")+" ",r+=c("You can also register at www.bookwidgets.com.")+"<br>";else if("INVALIDUSER"===o)r+=c("Invalid user name")+"<br>";else{var i;r+=(i=this.getLastServerMessage())?i+"<br>":c("Unknown error")+"<br>"}else(i=this.getLastServerMessage())?r+=i+"<br>":r=t;n.showAlert(r,c("Send Failed"))},y},isTeacherEmailRequired:function(){return!g()&&!m()&&!v()}}}.bind(null,n(5),n(1),n(21),n(16),n(45));e.exports={bindToContext:i}},109:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"setState",function(){return c}),n.d(r,"create",function(){return d}),n.d(r,"hide",function(){return f});var o=n(22),i=n.n(o),a=n(90),s=n.n(a),u=n(1),l=n(40);function c(e,t){var n=u("#loginbutton");if((n.safeHtml()!==t||n.attr("state")!==e)&&(n.safeHtml(t).attr({state:e}),"offline"===e||"online"===e)){var r=u(document.createElement("div")).addClass("login-change-wrapper").appendTo("#top-container"),o=n.clone();o.attr("id","login-change-alert").appendTo(r).fadeIn(400,"swing",function(){setTimeout(function(){o.fadeOut(400,"swing",function(){r.remove()})},1e3)}),n.effect&&n.effect("pulsate",{times:4},500)}l.centerTitle()}function d(e){var t=u(document.createElement("div")).addClass("loginbutton bw-tooltext").attr("id","loginbutton");l.prependToTitleToolbar(t),t.tapOrClick(e)}function f(){u("#loginbutton").hide()}var p=n(91),h=n.n(p),g=n(79),m=n.n(g),v=n(92),b=n.n(v),w=n(93),y=n.n(w),C=n(94),D=n.n(C),A=n(95),E=n.n(A),_=n(96),S=n.n(_),k=n(97),x=n.n(k),O=n(89),I=n.n(O),F=n(98),T=n(99),B=n.n(T),N=n(100),P=n.n(N),R=n(21),L=n.n(R),M=n(17),W=n.n(M),U=n(101),j=n.n(U);function q(e){e=e||{};var t={bwConfig:i.a,StudentAccountButtonUI:e.StudentAccountButtonUI||r,dialog:L.a,throbber:m.a};return t.tr=W.a,t.credentialstorage=s()(),t.studentaccountui=B.a,t.studentaccount=b.a.bindToContext(t),t.studentaccountbutton=y.a.bindToContext(t),t.bwds=I.a,t.blob=P.a,t.bwdsstorage=S.a.bindToContext(t),t.onlinestorage=E.a.bindToContext(t),t.writecachingonlinestorage=x.a.bindToContext(t),t.studentinfo=h.a.bindToContext(t),t.StorageBusyMarker=e.StorageBusyMarker||F,e.nostorage||(t.widgetstorage=D.a.bindToContext(t)),e.nosubmitter||(t.StudentWorkSubmitter=j.a.bindToContext(t)),t}n.d(t,"createDefaultContext",function(){return q})},11:function(e,t,n){var r=n(123),o=n(136),i=n(59),a=n(10);e.exports=function(e,t){return(a(e)?r:o)(e,i(t,3))}},110:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return d});var r=n(58),o=n.n(r),i=n(5),a=n(26),s=n(14).extend,u=n(74),l=a.createLogger("ProgressLogger"),c=new o.a;function d(e){var t=void 0!==e||"ibw-platform-ipad-bookwidgets"===i.getPlatform();e=e||function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),t.setAttribute("height","1px"),t.setAttribute("width","1px"),document.documentElement.appendChild(t),t.parentNode.removeChild(t),t=null};var n={};function r(e,t){n.callObjC("progress",s({cmd:e},t),function(){l.error("ProgressLogger: OK for:"+e)},function(){l.error("ProgressLogger: ERROR for:",e)})}n.resultForCallback=function(e,t){c.processCallback(e,t)},n.runningInIframe=function(){try{return window.self!==window.parent}catch(e){return!0}},n.callObjC=function(t,r,o,i){var a=u.url(t,r),s=c.registerCallbacks(o,i),l="'"+s.ok+"'",d="'"+s.error+"'",f="ProgressLogger.resultForCallback";n.runningInIframe()&&(f="function ProgressLogger_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; ProgressLogger_callback_wrapper"),e(a+"&okCallbackId="+l+"&errorCallbackId="+d+"&callbackFunc="+f)},n.restart=function(){t&&r("restart")},n.registerScore=function(e,n,o,i,a){return t?(r("registerScore",{identifier:e,title:n,score:i,maxScore:o,primary:!0===a}),{lastval:i,update:function(t){return t!==this.lastval&&(r("updateScore",{identifier:e,title:n,score:t,maxScore:o,primary:!0===a}),this.lastval=t,!0)}}):{update:function(){return!1}}},n.registerBinary=function(e,t,n,r,o){return{update:function(){return!1}}},n.registerQuantity=function(e,n,o,i){return t?(r("registerQuantity",{identifier:e,title:n,quantity:o,primary:!0===i}),{lastval:o,update:function(t){return t!==this.lastval&&(r("updateQuantity",{identifier:e,title:n,quantity:t,primary:!0===i}),this.lastval=t,!0)}}):{update:function(){return!1}}};var o=0;return n.setProgress=function(e,n){if(t){var i=Math.max(0,Math.min(1,e/n));i!==o&&(r("setProgress",{progress:i}),o=i)}},n.registerSet=function(e,n,r,o){if(!t)return{registerAccess:function(){return!1}};var i=this;return{elements:[],accesscount:0,accessedcount:0,accessedLogger:this.registerQuantity(e+"accessed",n,0),accessesLogger:this.registerQuantity(e+"accesses",r,0),registerAccess:function(e){return this.accessesLogger.update(++this.accesscount),this.elements.hasOwnProperty(e)||(this.elements[e]=!0,this.accessedLogger.update(++this.accessedcount),i.setProgress(this.accessedcount,o)),!0}}},window.ProgressLogger=n,n}c.startListening()},111:function(e,t,n){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n(65);function r(e){return"iBookWidgets/"+e}var o=e.createLogger("BWKSLocal");return{getItem:function(e){return o.debug("getItem "+r(e)),t.GetItem(r(e))},setItem:function(e,n){o.debug("setItem "+r(e));try{return t.SetItem(r(e),n),!0}catch(e){return!1}},removeItem:function(e){o.debug("removeItem "+r(e)),t.RemoveItem(r(e))},clear:function(){o.debug("clear"),t.Clear()}}}.bind(null,n(26));e.exports={f:r}},112:function(e,t,n){e.exports=function(e){var t=n(26).createLogger("WebSQLAsyncKeyStore");function r(e,n,r){t.error("WebSQL Error: executeSQL triggered error: "+r.message),null!=e&&e(r)}var o=function(e,t){this.name=e||"BWDS1",this.initialized=!1,this.valid=!1,this.db=null,this.openDatabase=void 0!==t?t:window.openDatabase?window.openDatabase.bind(window):function(){console.error("webSQL not supported")}};return o.prototype._prepareDatabase=function(e,n){var r=this.openDatabase(this.name,"","Offline BW storage",5242880);return""==r.version&&(t.debug("WebSQL: creating db"),r.changeVersion(r.version,"1.0",function(e){t.debug("WebSQL: creating table"),e.executeSql("CREATE TABLE keyvalue (keyname PRIMARY KEY, dir, name, value, attribs)")},n)),r},o.prototype._initializeAndRun=function(e,n){if(this.initialized)this.valid?void 0!==e&&e():(t.debug("WebSQL Error: Database is initialized but not valid, calling error"),void 0!==n&&n(this.error));else if(this.initialized=!0,this.openDatabase){try{t.debug("WebSQL: initializing database"),this.db=this._prepareDatabase(function(e){t.debug("WebSQL Error: Received error while preparing database: "+e.message)}),this.valid=!0}catch(e){switch(e.code){case e.SECURITY_ERR:t.debug("WebSQL Error: Received security error: "+e.message);break;case e.INVALID_STATE_ERR:t.debug("WebSQL Error: Received invalid state error: "+e.message);break;default:t.debug("WebSQL Error: Received error "+e.code+": "+e.message)}return this.valid=!1,this.error=e,void n(e)}e()}else t.debug("WebSQL Error: No WebSQL database available"),this.valid=!1,this.error={code:9999,message:"WebSQL Error: No WebSQL database available"},n(this.error)},o.prototype._initializeAndRunTransaction=function(e,n,r){var o=this;this._initializeAndRun(function(){o.db[e?"readTransaction":"transaction"](function(e){try{n(e)}catch(e){t.error("Error while executing transaction: "+e.code+": "+e.message),null!=r&&r(e)}},function(e){t.error("WebSQL Error: "+e.code+" starting transaction :"+e.message),o.valid=!1,o.initialized=!1,null!=r&&r(e)})},function(e){t.error("WebSQL Error: database not valid"),null!=r&&r(e)})},o.prototype._initializeAndRunReadTransaction=function(e,t){this._initializeAndRunTransaction(!0,e,t)},o.prototype._initializeAndRunReadWriteTransaction=function(e,t){this._initializeAndRunTransaction(!1,e,t)},o.prototype.getItemsAsync=function(e,n,o){if(0===e.length)return t.debug("WebSQL Error: getItemsAsync without names"),void o({code:9999,message:"WebSQL Error: getItemsAsync without names"});this._initializeAndRunReadTransaction(function(i){for(var a="",s=0;s<e.length;++s)a+=(""==a?"":", ")+"?";i.executeSql("SELECT keyname, value, attribs FROM keyvalue where keyname IN ("+a+")",e,function(e,r){for(var o={},i=0;i<r.rows.length;++i){var a=r.rows.item(i);o[a.keyname]=a,t.debug("WebSQL: read ("+a.keyname+") = "+a.value)}n(o)},r.bind(null,o))},o)},o.prototype.getDirAttribs=function(e,t,n){this._initializeAndRunReadTransaction(function(o){o.executeSql("SELECT keyname, attribs FROM keyvalue where dir = ?",[e],function(e,n){for(var r={},o=0;o<n.rows.length;++o){var i=n.rows.item(o);r[i.keyname]=i.attribs}t(r)},r.bind(null,n))},n)},o.prototype.setItemsAsync=function(e,n,o){if(0===e.length)return t.error("WebSQL Error: setItemsAsync without names"),void o({code:9999,message:"setItemsAsync without names"});if(e.length>1)return t.error("WebSQL Error: setItemsAsync can only handle 1 item"),void o({code:9999,message:"setItemsAsync can only handle 1 item"});var i=e[0];this._initializeAndRunReadWriteTransaction(function(a){var s,u=i.key,l=u.lastIndexOf("/"),c="";-1!=l&&(c=u.substring(0,l)),s=u.substring(l+1),a.executeSql("INSERT OR REPLACE INTO 'keyvalue' ( 'keyname', 'dir', 'name', 'value', 'attribs' ) VALUES ( ? , ? , ?, ? , ? )",[i.key,c,s,i.value,i.attribs],function(r,a){a.rowsAffected!=e.length?(t.error("WebSQL Error: store error on key "+name),o({code:9999,message:"WebSQL store error: wrong # rows affected"})):null!=n?(t.debug("WebSQL: wrote ("+i.key+")"),n()):t.error("WebSQL Error: setItemsAsync no OK function")},r.bind(null,o))},o)},o.prototype.removeItemsAsync=function(e,n,o){if(0===e.length)return t.debug("WebSQL Error: removeItemsAsync without names"),void o({code:9999,message:"WebSQL Error: removeItemsAsync without names"});this._initializeAndRunReadWriteTransaction(function(i){for(var a="",s=0;s<e.length;++s)a+=(""==a?"":", ")+"?";i.executeSql("DELETE FROM keyvalue where keyname IN ("+a+")",e,function(r,o){t.debug("WebSQL: removed "+e.join(", ")),null!=n&&n()},r.bind(null,o))},o)},o.prototype.clearAllAsync=function(e,n){this._initializeAndRunReadWriteTransaction(function(o){o.executeSql("DELETE FROM keyvalue",[],function(n,r){t.debug("WebSQL: Cleared all"),null!=e&&e()},r.bind(null,n))},n)},o}()},114:function(e,t,n){var r=n(14).each,o=n(115);e.exports=function(e){var t=n(26).createLogger("IndexedDBAsyncKeyStore");var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;this.idbstore=t};return i.prototype.getItemsAsync=function(e,n,r){var o=this;if(t.debug("IndexedDBAsyncKeyStore getItemsAsync"),0===e.length)return t.debug("IndexedDB Error: getItemsAsync without names"),void r({code:9999,message:"IndexedDB Error: getItemsAsync without names"});var i={};e.reduce(function(e,n){return e.then(function(){return function(e){var n=this;return t.debug("readelem ",e),new Promise(function(r,o){n.idbstore.get(e).then(function(n){t.debug("read elem: "+e),null!=n&&(i[e]=n),r()},function(n){t.debug("error accessing elem: "+e),o(n)}).catch(function(e){t.error("Caught idb exception",e),o(e)})})}.bind(o,n)()})},Promise.resolve()).then(function(){n(i)},r)},i.prototype.getDirAttribs=function(e,n,o){t.debug("IndexedDBAsyncKeyStore getDirAttribs"),this.idbstore.direlems(e).then(function(e){var t={};r(e,function(e){t[e.keyname]=e.attribs}),n(t)},o)},i.prototype.setItemsAsync=function(e,n,r){if(t.debug("IndexedDBAsyncKeyStore setItemsAsync"),0===e.length)return t.error("IndexedDB Error: setItemsAsync without names"),void r({code:9999,message:"setItemsAsync without names"});if(e.length>1)return t.error("IndexedDB Error: setItemsAsync can only handle 1 item"),void r({code:9999,message:"setItemsAsync can only handle 1 item"});var o,i,a=e[0];this.idbstore.set(a.key,{keyname:a.key,value:a.value,attribs:a.attribs,dir:(o=a.key,i=o.lastIndexOf("/"),-1!=i?o.substring(0,i):"")}).then(function(){n()},r).catch(r)},i.prototype.removeItemsAsync=function(e,n,r){var o=this;if(t.debug("IndexedDBAsyncKeyStore removeItemsAsync"),0===e.length)return t.debug("IndexedDB Error: removeItemsAsync without names"),void r({code:9999,message:"IndexedDB Error: removeItemsAsync without names"});e.reduce(function(e,t){return e.then(function(){return o.idbstore.del(t)})},Promise.resolve()).then(function(){n()},r)},i.prototype.clearAllAsync=function(e,n){t.debug("IndexedDBAsyncKeyStore clearAllAsync"),this.idbstore.clear().then(e,n)},i}()},115:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"Store",function(){return a}),n.d(t,"get",function(){return u}),n.d(t,"set",function(){return l}),n.d(t,"del",function(){return c}),n.d(t,"clear",function(){return d}),n.d(t,"direlems",function(){return f});var o,i=n(162),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bwds-store",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keyval";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storeName=n,this._dbp=new i(function(e,r){var o=indexedDB.open(t,1);o.onerror=function(){return r(o.error)},o.onsuccess=function(){return e(o.result)},o.onupgradeneeded=function(){o.result.createObjectStore(n).createIndex("dir_idx","dir")}})}var t,n,o;return t=e,(n=[{key:"_withIDBStore",value:function(e,t){var n=this;return this._dbp.then(function(r){return new i(function(o,i){var a=r.transaction(n.storeName,e);a.oncomplete=function(){return o()},a.onabort=a.onerror=function(){return i(a.error)},t(a.objectStore(n.storeName))})})}}])&&r(t.prototype,n),o&&r(t,o),e}();function s(){return o||(o=new a),o}function u(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readonly",function(n){t=n.get(e)}).then(function(){return t.result})}function l(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:s())._withIDBStore("readwrite",function(n){n.put(t,e)})}function c(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readwrite",function(t){t.delete(e)})}function d(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:s())._withIDBStore("readwrite",function(e){e.clear()})}function f(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readonly",function(n){t=n.index("dir_idx").getAll(e)}).then(function(){return t.result})}},116:function(e,t,n){var r,o,i;e.exports=(r=n(87),o=n(46),i=n(26).createLogger("AsyncKeyStoreToBWDSAdapter"),function(e){var t={};function n(e,n){t.queue.executeSequential(function(t){try{e(t)}catch(e){console.error("AsyncBWDS: Uncaught error: "+e),r.handleException(e,n,t)}})}return t.async=e,t.queue=r.newCallbackQueue(),t.readNoSync=function(e,n,r){i.debug("readNoSync "+e),t.async.getItemsAsync([e],function(r){if(r.hasOwnProperty(e)){var o=JSON.parse(r[e].attribs);!1===o.removed?n(r[e].value,t.fileStat(e,o)):n(null,t.fileStat(e,o))}else n(null,null)},function(e){r(e)})},t.read=function(e,i){n(function(n){t.readNoSync(e,function(e,t){null==e?r.callSafe(i,r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"),null,t):r.callSafe(i,null,e,t),n()},function(e){r.handleException(e,i,n)})},i)},t.writeNoSync=function(e,n,o,a){i.debug("writeNoSync "+e+" "+n);var s=null==n?0:n.length;t.async.getItemsAsync([e],function(i){var u,l=r.getDateTime();i.hasOwnProperty(e)?((u=JSON.parse(i[e].attribs)).updated_at=l,u.filesize=s,u.isdir=null==n,u.removed=!1,u.version=u.version+1,u.offline=!1):u={created_at:l,updated_at:l,filesize:s,isdir:null==n,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1},t.async.setItemsAsync([{key:e,value:null==n?"":n,attribs:JSON.stringify(u)}],function(n){if(""!=e){var r=e.lastIndexOf("/"),i="";-1!=r&&(i=e.substring(0,r)),t.writeNoSync(i,null,o,a)}else o(t.fileStat(e,u))},function(e){a(e)})},function(e){a(e)})},t.write=function(e,o,i){n(function(n){t.writeNoSync(e,null==o?"":o,function(e){r.callSafe(i,null,e),n()},function(e){r.handleException(e,i,n)})},i)},t.removeFiles=function(e,n,o){if(0==e.length)null!=n&&n();else{var a=e.shift(),s=a.attribs,u=r.getDateTime();s.removed=!0,s.offline=!1,s.updated_at=u,t.async.setItemsAsync([{key:a.name,value:"",attribs:JSON.stringify(s)}],function(){t.removeFiles(e,function(){n(s)},o)},function(){i.error("removeFiles, could not write new file attribs to clear, removing including attribs"),t.async.removeItemsAsync([a.name],function(){t.removeFiles(e,function(){n(s)},o)},o)})}},t.removeRecurse=function(e,n,r){if(0==e.length)null!=n&&n();else{var o=e.shift();t.async.getDirAttribs(o,function(o){var i=[];for(var a in o){var s=JSON.parse(o[a]);!1===s.removed&&(!0===s.isdir&&e.push(a),i.push({name:a,attribs:s}))}t.removeFiles(i,function(){t.removeRecurse(e,n,r)},r)},r)}},t.removeNoSync=function(e,n,a){i.debug("removeNoSync "+e),""==e?t.removeRecurse([e],n,function(e){r.handleException(e,a)}):t.async.getItemsAsync([e],function(i){if(i.hasOwnProperty(e)){var s=JSON.parse(i[e].attribs);!1===s.removed?s.isdir?t.removeFiles([{name:e,attribs:s}],function(){t.removeRecurse([e],n,function(e){r.handleException(e,a)})},function(e){r.handleException(e,a)}):t.removeFiles([{name:e,attribs:s}],function(r){n(t.fileStat(e,r))},function(e){r.handleException(e,a)}):a(r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"))}else a(r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"))},function(e){r.handleException(e,a)})},t.remove=function(e,o){n(function(n){t.removeNoSync(e,function(){r.callSafe(o,null),n()},function(e){r.callSafe(o,e),n()})},o)},t.dirNoSync=function(e,n,o){i.debug("dirNoSync "+e),t.async.getDirAttribs(e,function(t){var o=[];for(var i in t)!1===JSON.parse(t[i]).removed&&""!=i&&o.push(r.trimLeadingSlash(i.substr(e.length)));o.length>0?n(o):n(null)},function(e){o(e)})},t.dir=function(e,i){n(function(n){t.dirNoSync(e,function(t){null!==t?r.callSafe(i,null,t):""===e?r.callSafe(i,null,[]):r.callSafe(i,r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file")),n()},function(e){r.handleException(e,i,n)})},i)},t.fileStat=function(e,t){return{name:e,size:t.filesize,created:t.created_at,modified:t.updated_at,isdir:t.isdir,removed:t.removed,version:t.version,backup_version:t.backup_version,backup_date:t.hasOwnProperty("backup_date")?t.backup_date:null,offline:!!t.hasOwnProperty("offline")&&t.offline}},t.dirStat=function(e,n,r,o){i.debug("dirNoSync "+e),t.async.getDirAttribs(e,function(e){var o=[];for(var i in e)""!==i&&o.push(t.fileStat(i,JSON.parse(e[i])));r(n,o)},function(e){o(e)})},t.statNoSync=function(e,n,r){i.debug("statNoSync "+e),t.async.getItemsAsync([e],function(o){if(o.hasOwnProperty(e)){var i=JSON.parse(o[e].attribs),a=t.fileStat(e,i);i.isdir?t.dirStat(e,a,n,r):n(a)}else n(null)},function(e){r(e)})},t.stat=function(e,i){n(function(n){t.statNoSync(e,function(e,t){null!==e?void 0===t?r.callSafe(i,null,e):r.callSafe(i,null,e,t):r.callSafe(i,r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file")),n()},function(e){r.handleException(e,i,n)})},i)},t.setStatNoSync=function(e,n,a,s){i.debug("setStatNoSync "+e),t.async.getItemsAsync([e],function(i){if(i.hasOwnProperty(e)){var u=JSON.parse(i[e].attribs);for(var l in n)if("backup_date"==l)u.backup_date=n.backup_date;else{if("backup_version"!=l)return void s(r.error(o.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attribute "+l));u.backup_version=n.backup_version}t.async.setItemsAsync([{key:e,value:i[e].value,attribs:JSON.stringify(u)}],function(n){a(t.fileStat(e,u))},function(e){r.handleException(e,s)})}else s(r.error(o.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))},function(e){s(e)})},t.setStat=function(e,o,i){n(function(n){t.setStatNoSync(e,o,function(e){r.callSafe(i,null,e),n()},function(e){r.callSafe(i,e),n()})},i)},t.executeSync=function(e,n){t.queue.executeSequential(e,n)},t.removeAll=function(e){var n=[""],r=[],o=null;!function i(){if(r.length>0){var a=r.shift();t.removeNoSync(a,function(){i()},function(){console.log("Could not remove ",a),o="Could not remove file",i()})}else if(0!==n.length){var s=n.shift();t.dirStat(s,null,function(e,t){for(var o=0;o<t.length;++o){var a=t[o];a.removed||(a.isdir?n.push(a.name):r.push(a.name))}i()},function(){console.log("Error getting stat for ",s),o="Error removing files",i()})}else e(o)}()},t.clearAll=function(e){i.debug("clearAll"),t.async.clearAllAsync?t.async.clearAllAsync(function(){i.debug("AsyncBWDS.clearAll OK callback"),r.callSafe(e)},function(t){r.handleException(t,e)}):t.removeAll(e)},t})},117:function(e,t,n){e.exports=function(e,t,r){var o=n(26).createLogger("SyncKeyStoreToBWDSAdapter");function i(t,n){try{t()}catch(t){o.error("Uncaught error: "+t),e.handleException(t,n)}}return function(n){var r={};function a(n,o,i){return!1!==r.keystore.setItem(n,o)||(e.callSafe(i,e.error(t.BWDS_ERROR_FULL,"KeyStoreBWDS error: storage full"),null),!1)}return r.keystore=n,r.write=function(t,n,s){i(function(){o.debug("write "+t);var i,u,l=n.length,c=t.lastIndexOf(".");if(-1==c?(i=t,u=""):(i=t.substr(0,c),u=t.substr(c+1)),a(i,n,s))if(""!=i){var d,f=i.lastIndexOf("/"),p="";-1!=f&&(p=i.substring(0,f)),d=i.substring(f);var h,g=r.keystore.getItem(p),m=e.getDateTime();null===g?(h={})[d]={type:u,created_at:m,updated_at:m,filesize:l,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1}:(h=JSON.parse(g))[d]?(h[d].type=u,h[d].updated_at=m,h[d].filesize=l,h[d].version=h[d].hasOwnProperty("version")?h[d].version+1:2,h[d].removed=!1,h[d].offline=!1):h[d]={type:u,created_at:m,updated_at:m,filesize:l,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1};var v=r.fileStat(p,d,h[d]);r.write(p+".dir",JSON.stringify(h),function(t){e.callSafe(s,t,v)})}else e.callSafe(s,null,null)},s)},r.read=function(n,a){i(function(){var i,s;o.debug("read "+n);var u=n.lastIndexOf(".");-1==u?(i=n,s=""):(i=n.substr(0,u),s=n.substr(u+1));var l,c=i.lastIndexOf("/"),d="";-1!=c&&(d=i.substring(0,c)),l=i.substring(c);var f=r.keystore.getItem(d);if(null!==f){var p=JSON.parse(f);if(p[l])if(s&&p[l].type!=s)e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"),null,null);else if(!0===p[l].removed)e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"BWKDLocal Error: removed file"),null,r.fileStat(d,l,p[l]));else{var h=r.keystore.getItem(i);e.callSafe(a,null,h,r.fileStat(d,l,p[l]))}else e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"BWKDLocal Error: unknown file"),null,null)}else e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"),null,null)},a)},r.clearDir=function(e){var t=r.keystore.getItem(e);if(null!=t){var n=JSON.parse(t);for(var i in n)"dir"==n[i].type&&""!=i&&r.clearDir(e+i),o.debug("Clearing: "+e+i),r.keystore.removeItem(e+i);r.keystore.removeItem(e)}},r.clear=function(t,n){i(function(){if(o.debug("clear "+t),t)throw Error("clear(): Unexpected parameter");r.clearDir(""),e.callSafe(n,null)},n)},r.removeDir=function(t,n){o.debug("removeDir("+t+")");var i=r.keystore.getItem(t);if(null!=i){var s=JSON.parse(i),u=e.getDateTime();for(var l in s){var c=s[l];!1===c.removed&&("dir"===c.type?""!==l&&r.removeDir(t+l,n):(o.debug("Clearing: "+t+l),r.keystore.removeItem(t+l)),s[l].version=s[l].hasOwnProperty("version")?s[l].version+1:2,s[l].removed=!0,s[l].updated_at=u)}if(!a(t,JSON.stringify(s),n))return}},r.remove=function(n,a){i(function(){if(o.debug("remove "+n),""==n||null==n||null==n)return r.removeDir("",a),void e.callSafe(a,null);var i,s,u=n.lastIndexOf("."),l=(i=-1==u?n:n.substr(0,u)).lastIndexOf("/"),c="";-1!=l&&(c=i.substring(0,l)),s=i.substring(l);var d=r.keystore.getItem(c);if(null!==d){var f=JSON.parse(d);if(!f[s])return o.error("unknown file"),void e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"));"dir"==f[s].type?r.removeDir(n,a):r.keystore.removeItem(i),f[s].removed=!0,f[s].version=f[s].hasOwnProperty("version")?f[s].version+1:2;var p=e.getDateTime();f[s].updated_at=p;var h=r.fileStat(c,s,f[s]);r.write(c+".dir",JSON.stringify(f),function(t){e.callSafe(a,t,h)})}else e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))},a)},r.dir=function(n,a){i(function(){var i,s;if(o.debug("dir "+n),""!=n){var u,l=n.lastIndexOf("/"),c="";if(-1!=l&&(c=n.substring(0,l)),u=n.substring(l),null===(i=r.keystore.getItem(c)))return void e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown directory"));if(!1===(s=JSON.parse(i)).hasOwnProperty(u)||"dir"!==s[u].type)return void e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown directory"))}i=r.keystore.getItem(n),s=JSON.parse(i);var d=[];for(var f in s)!0!==s[f].removed&&d.push(e.trimLeadingSlash(f)+("dir"==s[f].type?"":"."+s[f].type));e.callSafe(a,null,d)},a)},r.fileStat=function(e,t,n){return{name:e+t+("dir"==n.type?"":"."+n.type),size:n.hasOwnProperty("filesize")?n.filesize:null==r.keystore.getItem(e+t)?0:r.keystore.getItem(e+t).length,created:n.created_at,modified:n.updated_at,isdir:"dir"==n.type,removed:n.hasOwnProperty("removed")&&!0===n.removed,version:n.version,backup_version:n.backup_version,backup_date:n.hasOwnProperty("backup_date")?n.backup_date:null,offline:!!n.hasOwnProperty("offline")&&n.offline}},r.dirStat=function(t,n,o){var i=r.keystore.getItem(t),a=JSON.parse(i),s=[];for(var u in a)s.push(r.fileStat(t,u,a[u]));e.callSafe(n,null,o,s)},r.stat=function(n,a){i(function(){if(o.debug("stat "+n),""!=n){var i,s,u=n.lastIndexOf("."),l=(i=-1==u?n:n.substr(0,u)).lastIndexOf("/"),c="";-1!=l&&(c=i.substring(0,l)),s=i.substring(l);var d=r.keystore.getItem(c);if(null!==d&&""!==d){var f=JSON.parse(d);if(f[s])return"dir"==f[s].type?void r.dirStat(n,a,r.fileStat(c,s,f[s])):void e.callSafe(a,null,r.fileStat(c,s,f[s]));e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else r.dirStat(n,a,{isdir:!0,name:""})},a)},r.setStat=function(n,s,u){i(function(){if(o.debug("stat "+n),""!=n){var i,l,c=n.lastIndexOf("."),d=(i=-1==c?n:n.substr(0,c)).lastIndexOf("/"),f="";-1!=d&&(f=i.substring(0,d)),l=i.substring(d);var p=r.keystore.getItem(f);if(null!==p){var h=JSON.parse(p);if(h[l]){if("dir"==h[l].type)return void e.callSafe(u,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attributes for directory"));for(var g in s)if("backup_date"==g)h[l].backup_date=s.backup_date;else{if("backup_version"!=g)return void e.callSafe(u,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attribute "+g));h[l].backup_version=s.backup_version}if(!a(f,JSON.stringify(h),u))return;e.callSafe(u,null,r.fileStat(f,l,h[l]))}else e.callSafe(u,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(u,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(u,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attributes for directory"))},u)},r.executeSync=function(e,t){e(function(){})},r.clearAll=function(e){i(function(){r.clear("",e)},e)},r}}(n(87),n(46))},119:function(e,t){e.exports={GetItem:function(e){return sessionStorage.getItem(e)},RemoveItem:function(e){sessionStorage.removeItem(e)},SetItem:function(e,t){sessionStorage.setItem(e,t)},Clear:function(){sessionStorage.clear()}}},120:function(e,t,n){"use strict";function r(e){return e.firstName&&""!==e.firstName&&e.lastName&&""!==e.lastName?e.firstName+" "+e.lastName:e.firstName&&""!==e.firstName?e.firstName:e.lastName&&""!==e.lastName?e.lastName:e.providerHumanID&&""!==e.providerHumanID&&e.providerHumanID!==e.providerID?e.providerHumanID:e.email&&""!==e.email?e.email.substring(0,e.email.indexOf("@")):e.providerID}n.r(t),n.d(t,"displayName",function(){return r})},121:function(e,t,n){var r;e.exports=(r=n(22).getConfigSync(),{getAJAXHeaders:function(){return null!=r.widget_language&&r.widget_language.length>0?{"Accept-Language":r.widget_language}:{}}})},13:function(e,t,n){"use strict";n.r(t);var r=n(11),o=n.n(r),i=n(15),a=n.n(i),s=n(18),u=n.n(s),l=n(38),c=n.n(l),d=n(61),f=n.n(d),p=n(20),h=n.n(p),g=n(2),m=n.n(g),v=n(72),b=n.n(v),w=n(9),y=n(64),C=n.n(y),D=n(10),A=n.n(D),E=n(27),_=n.n(E),S=function(){function e(t,n,r,o){this.message=t,this.expected=n,this.found=r,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),{SyntaxError:e,parse:function(t){var r,o=arguments.length>1?arguments[1]:{},i={},a={Expression:z},s=z,u=function(e){return e},l=function(e){return m()(e,function(e){return e[0]})},c="^",d={type:"literal",value:"^",description:'"^"'},f=function(){return{cmd:"^"}},p="_",h={type:"literal",value:"_",description:'"_"'},g=function(){return{cmd:"_"}},v="\\",b={type:"literal",value:"\\",description:'"\\\\"'},w=/^[A-Za-z]/,y={type:"class",value:"[A-Za-z]",description:"[A-Za-z]"},C=function(e){return{cmd:"\\"+e.join("")}},D=/^[\\ {}|'."~=\^`&#]/,A={type:"class",value:"[\\\\ {}|'.\"~=^`&#]",description:"[\\\\ {}|'.\"~=^`&#]"},E=function(e){return{cmd:"\\"+e}},_="{",S={type:"literal",value:"{",description:'"{"'},k="}",x={type:"literal",value:"}",description:'"}"'},O=function(){return{grp:[]}},I=function(e){return{grp:e}},F=/^[A-Za-z0-9\xC0-\u10FFFF.*\/+\-!=><&()[\]|\xB0,;:'\uFFFD"]/,T={type:"class",value:"[A-Za-z0-9\\u00c0-\\u10FFFF.*/+\\-!=><&()\\[\\]|,;:'\"]",description:"[A-Za-z0-9\\u00c0-\\u10FFFF.*/+\\-!=><&()\\[\\]|,;:'\"]"},B=function(e){return e},N=/^[ \t\n\r]/,P={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},R=0,L=[{line:1,column:1,seenCR:!1}],M=0,W=[],U=0;if("startRule"in o){if(!(o.startRule in a))throw new Error("Can't start parsing from rule \""+o.startRule+'".');s=a[o.startRule]}function j(e){var n,r,o=L[e];if(o)return o;for(n=e-1;!L[n];)n--;for(o={line:(o=L[n]).line,column:o.column,seenCR:o.seenCR};n<e;)"\n"===(r=t.charAt(n))?(o.seenCR||o.line++,o.column=1,o.seenCR=!1):"\r"===r||"\u2028"===r||"\u2029"===r?(o.line++,o.column=1,o.seenCR=!0):(o.column++,o.seenCR=!1),n++;return L[e]=o,o}function q(e,t){var n=j(e),r=j(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:r.line,column:r.column}}}function H(e){R<M||(R>M&&(M=R,W=[]),W.push(e))}function V(t,n,r,o){return null!==n&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(n),new e(null!==t?t:function(e,t){var n,r=new Array(e.length);for(n=0;n<e.length;n++)r[n]=e[n].description;return"Expected "+(e.length>1?r.slice(0,-1).join(", ")+" or "+r[e.length-1]:r[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0100-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1000-\uFFFF]/g,function(e){return"\\u"+t(e)})}(t)+'"':"end of input")+" found."}(n,r),n,r,o)}function z(){var e,t,n,r;return e=R,(t=J())===i&&(t=null),t!==i&&(n=function(){var e,t,n,r;if(R,e=[],t=R,(n=K())!==i?((r=J())===i&&(r=null),r!==i?t=n=[n,r]:(R=t,t=i)):(R=t,t=i),t!==i)for(;t!==i;)e.push(t),t=R,(n=K())!==i?((r=J())===i&&(r=null),r!==i?t=n=[n,r]:(R=t,t=i)):(R=t,t=i);else e=i;return e!==i&&(e=l(e)),e}())!==i?((r=J())===i&&(r=null),r!==i?e=t=u(n):(R=e,e=i)):(R=e,e=i),e}function K(){var e,n;return(e=function(){var e,n,r,o;if(e=R,94===t.charCodeAt(R)?(n=c,R++):(n=i,0===U&&H(d)),n!==i&&(n=f()),(e=n)===i&&(e=R,95===t.charCodeAt(R)?(n=p,R++):(n=i,0===U&&H(h)),n!==i&&(n=g()),(e=n)===i)){if(e=R,92===t.charCodeAt(R)?(n=v,R++):(n=i,0===U&&H(b)),n!==i){if(r=[],w.test(t.charAt(R))?(o=t.charAt(R),R++):(o=i,0===U&&H(y)),o!==i)for(;o!==i;)r.push(o),w.test(t.charAt(R))?(o=t.charAt(R),R++):(o=i,0===U&&H(y));else r=i;r!==i?(n=C(r),e=n):(R=e,e=i)}else R=e,e=i;e===i&&(e=R,92===t.charCodeAt(R)?(n=v,R++):(n=i,0===U&&H(b)),n!==i?(D.test(t.charAt(R))?(r=t.charAt(R),R++):(r=i,0===U&&H(A)),r!==i?(n=E(r),e=n):(R=e,e=i)):(R=e,e=i))}return e}())===i&&(e=function(){var e,n,r,o;return e=R,123===t.charCodeAt(R)?(n=_,R++):(n=i,0===U&&H(S)),n!==i?((r=J())===i&&(r=null),r!==i?(125===t.charCodeAt(R)?(o=k,R++):(o=i,0===U&&H(x)),o!==i?(n=O(),e=n):(R=e,e=i)):(R=e,e=i)):(R=e,e=i),e}())===i&&(e=function(){var e,n,r,o;return e=R,123===t.charCodeAt(R)?(n=_,R++):(n=i,0===U&&H(S)),n!==i&&(r=z())!==i?(125===t.charCodeAt(R)?(o=k,R++):(o=i,0===U&&H(x)),o!==i?(n=I(r),e=n):(R=e,e=i)):(R=e,e=i),e}())===i&&(F.test(t.charAt(R))?(n=t.charAt(R),R++):(n=i,0===U&&H(T)),n!==i&&(n=B(n)),e=n),e}function J(){var e,n;if(e=[],N.test(t.charAt(R))?(n=t.charAt(R),R++):(n=i,0===U&&H(P)),n!==i)for(;n!==i;)e.push(n),N.test(t.charAt(R))?(n=t.charAt(R),R++):(n=i,0===U&&H(P));else e=i;return e}if(window._=n(14),(r=s())!==i&&R===t.length)return r;throw r!==i&&R<t.length&&H({type:"end",description:"end of input"}),V(null,W,M<t.length?t.charAt(M):null,M<t.length?q(M,M+1):q(M,M))}}}().parse;function k(e){return e.hasOwnProperty("grp")}function x(e){return e.hasOwnProperty("cmd")}function O(e,t){return _()(t)?e===t:!(!k(t)||1!==t.grp.length)&&O(e,t.grp[0])}function I(e,t){return x(t)?e.cmd===t.cmd&&T(e.opt,t.opt)&&T(e.params,t.params):!(!k(t)||1!==t.grp.length)&&I(e,t.grp[0])}function F(e,t){return _()(e)?O(e,t):_()(t)?O(t,e):x(e)?I(e,t):x(t)?I(t,e):k(e)?k(t)&&T(e.grp,t.grp):(console.error("Unknown latex node type",e),!1)}function T(e,t){if(null==e)return null==t;if(null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!1===F(e[n],t[n]))return!1;return!0}var B=["\\left","\\right","\\limits"],N={"\\leq":function(){return{cmd:"\\le"}},"\\geq":function(){return{cmd:"\\ge"}},"\\neq":function(){return{cmd:"\\ne"}},"\\vee":function(){return{cmd:"\\lor"}},"\\wedge":function(){return{cmd:"\\land"}},"\\":function(){return{cmd:"\\ne"}},"\\overrightarrow":function(){return{cmd:"\\vec"}},"\\dfrac":function(){return{cmd:"\\frac"}},"\\notin":function(){return[{cmd:"\\not"},{cmd:"\\in"}]}},P={"":function(){return[{cmd:"^"},{cmd:"\\circ"}]},"":function(){return[{cmd:"^"},{cmd:"\\circ"}]},'"':function(){return["'","'"]}};var R={"\\frac":2,"\\sum":2,"\\prod":2,"\\coprod":2,"\\int":2,"\\sqrt":1,"^":1,_:1,"\\bar":1,"\\dot":1,"\\hat":1,"\\tilde":1,"\\vec":1,"\\begin":1,"\\end":1};function L(e){var t=0;return u()(m()(e,function(e){return x(e)?("\\begin"===e.cmd?++t:"\\end"===e.cmd&&--t,function(e){var t={cmd:e.cmd};e.opt&&(t.opt=L(e.opt));e.params&&(t.params=m()(e.params,M));return t}(e)):k(e)?0===t?L(e.grp):M(e):e}))}function M(e){return k(e)?{grp:L(e.grp)}:e}function W(e){return L(function e(t){if(null==t)return null;for(var n=[],r=0;r<t.length;++r){var o=t[r];if(_()(o))n.push(o);else if(x(o)){if("\\sqrt"===o.cmd&&r<t.length-2&&"["===t[r+1]){for(var i=[],a=r+2;a<t.length&&"]"!==t[a];)i.push(t[a++]);"]"===t[a]&&(o.opt=e(i),r=a)}var s=R[o.cmd]||0,u=Math.min(s,t.length-r-1);if(u>0){for(var l=[],c=0;c<u;++c)l.push(t[++r]);o.params=e(l)}n.push(o)}else k(o)?n.push({grp:e(o.grp)}):(console.error("mapCommandParams simply copies",o),n.push(o))}return n}(function(e){var t=m()(e,function(e){if(_()(e))return P.hasOwnProperty(e)?P[e]():e;if(x(e))return-1!==c()(B,e.cmd)?[]:N.hasOwnProperty(e.cmd)?N[e.cmd]():e;if(k(e)){var t=W(e.grp);return 0===t.length?[]:{grp:t}}return e}),n=!1,r=o()(t,function(e,r){return n?(n=!1,!1):r===t.length-1||!x(e)||"^"!==e.cmd&&"_"!==e.cmd||!A()(t[r+1])||0!==t[r+1].length||(n=!0,!1)});return u()(r)}(e)))}var U=n(6),j=n(28);function q(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function H(e){return e?parseFloat(e.replace(",",".")):0}function V(e,t){return null==t?e:e instanceof Array?function(e,t,n){for(var r=e.length,o=[],i=0;i<r;i++)o[i]=n(e[i],t[i]);return o}(e,t,function(e,t){return null!=t?t:e}):t}function z(e){return"no"===e.needs_correction?0:H(e["scoring-weight"])}function K(e){var t=z(e);if(!e.hasOwnProperty("scoring-wrong-answer-weight")||""===e["scoring-wrong-answer-weight"])return t;var n=H(e["scoring-wrong-answer-weight"]);return isNaN(n)?t:n}function J(e,t,n){r=null===t?-1:parseInt(t)===parseInt(e.Valid)?1:0;var r,o=z(e),i=r;return{correctness:r=V(i,n),autoCorrectness:i,score:1===r?o:0,outof:o}}function Y(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1}function Q(e,t){for(var n=0,r=0;r<e.length;++r)e[r]===t&&++n;return n}function G(e,t,n){return"each"===t?Q(e,1)*n:Q(e,1)===e.length?n:0}function $(e,t,n){return"each"===t?e.length*n:n}function Z(e,t,n,r,o,i){if(i){for(var a=0,s=0;s<e.length;++s)e[s]&&1===t[s]&&++a;return a*r}if("each"===n){a=0;var u=0;for(s=0;s<e.length;++s)e[s]&&1===t[s]?++a:e[s]||0!==t[s]||++u;return Math.max(a*r-u*o,0)}return"eachcorrect"===n?Q(t,1)*r:Q(t,1)===t.length?r:0}function X(e,t,n,r,o){return o?Q(e,!0)*r:"each"===n?Q(e,!0)*r:"eachcorrect"===n?e.length*r:r}function ee(e,t,n){for(var r,o=e.policy,i="yes"===e.limited_selection,a=e.Answers||[],s=Y(t=t||h()(Array(a.length),!1),!0)||"eachcorrect"===o,u=e.hasOwnProperty("Valid")?(r=e.Valid,r.replace(/\D/g," ")).split(/\s+/):"",l=[],c=0;c<u.length;++c)l.push(parseInt(u[c],10));var d=[];for(c=0;c<a.length;++c)d.push(Y(u,c+1+""));var f=[];for(c=0;c<a.length;++c)s?!Y(u,c+1+"")^!t[c]?f.push(0):f.push(1):f.push(-1);var p=z(e),g=f;return{correctness:f=V(g,n),autoCorrectness:g,correctAnswers:l,score:Z(d,f,o,p,K(e),i),outof:X(d,0,o,p,i)}}function te(e){var t,n,r=Object(U.trimAll)(e.split(":"));r.length>=2?0===(t=r[0]).indexOf("text")||0===t.indexOf("select")?(r.shift(),n=r.join(":")):(t="text",n=e):r.length<2&&(t="text",n=e);var o=t.match(/(.+)\((.*)\)/),i=[],a=[];if(o&&3===o.length){t=o[1].trim(),i=Object(U.trimAll)(o[2].split(";")).map(function(e){return Object(U.trimAll)(e.split("="))});for(var s=0;s<i.length;++s){var u=i[s];"width"===u[0]?a.push(u.join(":")):console.error("FIT: Ignoring unsupported parameter "+u[0])}}return{type:t,typeconfig:n,style:a}}function ne(e,t,n){for(var r,o=0,i=e.indexOf("&lt;&lt;"),a="",s=0;i>=0;){var u=e.substring(o,i),l=e.indexOf("&gt;&gt;",i);if(l<0){o=e.length;break}a+=null!=(r=t(u,n(e.substring(i+8,l)),s))?u+r:e.substring(o,l+8),o=l+8,i=e.indexOf("&lt;&lt;",l),s+=1}return a+=null!=(r=t(e.substring(o),null,s))?r:e.substring(o)}function re(e,t){return ne(e,t,te)}function oe(e){return"undefined"!=typeof window&&window.$?window.$(document.createElement("div")).html(e).text():n(78).default(e)}function ie(e){return!e.hasOwnProperty("Sentence")||null==e.Sentence||""===e.Sentence.trim()}function ae(e){return ie(e)?e.Question||"":e.Sentence||""}function se(e,t){return ne(e,t,function(e){return e})}function ue(e,t){return ne(e,t,function(e){return e})}function le(e){var t=f()(e);return"Image"===e.Type?(delete t.image.sources,delete t.image.alttext):"Audio"===e.Type&&(t.audio=function(e){var t=e.lastIndexOf("/");if(-1===t)return e;var n=e.lastIndexOf("/",t-1);return-1===n?e.substr(t):e.substr(n)}(e.audio)),t}function ce(e){return JSON.stringify(m()(e,function(e){return b()(le(e))}).sort())}function de(e,t,n){for(var r="",o=0;o<e.length;++o){var i=e.charAt(o);/[\s]/.test(i)||/[~`!#$%^&*+=\-[\]\\;,./{}()|\\":<>?]/.test(i)?(r.length>0&&(t(r),r=""),n(i)):r+=i}r.length>0&&t(r)}function fe(e,t,n){for(var r=0,o=e.indexOf("<<");o>=0;){t(e.substring(r,o));var i=e.indexOf(">>",o);if(i<0){r=e.length;break}n(e.substring(o+2,i)),r=i+2,o=e.indexOf("<<",i)}t(e.substring(r))}function pe(e,t,n,r){fe(e,function(e){de(e,n,t)},function(e){var t=Object(U.trimAll)(e.split(":"));1!==t.length?""!==t[0]?""!==t[1]?r({type:t[0],word:t[1]}):n(t[0]):n(t[1]):n(t[0])})}function he(e){var t=e.hasOwnProperty("filename")?e.filename:e;return e.hasOwnProperty("origbase")?e.origbase:t}function ge(e){return e}function me(e,t){return null==e||""===e?"":t+""}function ve(e){return Q(e.correctness,1)===e.correctness.length}function be(e){return null==e||""===e}function we(e,t,n,r,o){t=t||[];for(var i=[],a=e.pairs?e.pairs:[],s=0;s<a.length;++s){var u=a[s],l=n(u.source,s);if(!be(l)){for(var c=r(u.target),d=!1,f=0;f<t.length;++f)if(t[f].source===l){t[f].target===c?i.push(1):i.push(0),d=!0;break}d||(be(c)?i.push(2):i.push(-1))}}var p=Q(i,1)>0||Q(i,0)>0?1:-1;for(s=0;s<i.length;++s)2===i[s]&&(i[s]=p);var h=z(e),g=i;return{correctness:i=V(g,o),autoCorrectness:g,score:Q(i,1)*h,outof:i.length*h}}function ye(e){return e.hasOwnProperty("name")?e.name:e}function Ce(e,t,n,r){t=t||[];for(var o=z(e),i=[],a=e.Boxes?e.Boxes:[],s=0;s<a.length;++s){var u=a[s],l=oe(u.name);if(u.Items)for(var c=0;c<u.Items.length;++c){var d=n(u.Items[c]);i.push({pair:[d,l],correct:!1,answer:null})}}var f=[];for(s=0;s<t.length;++s)f.push({pair:t[s],used:!1});for(s=0;s<i.length;++s){var p=i[s];for(c=0;c<f.length;++c){if(!(h=f[c]).used&&(ye(p.pair[0])===ye(h.pair[0])&&p.pair[1]===h.pair[1])){p.correct=!0,p.answer=h.pair[1],h.used=!0;break}}}for(s=0;s<i.length;++s){if(!(p=i[s]).correct)for(c=0;c<f.length;++c){var h;if(!(h=f[c]).used&&ye(p.pair[0])===ye(h.pair[0])){p.answer=h.pair[1],h.used=!0;break}}}var g=!1;for(s=0;s<i.length;++s){if(null!==(p=i[s]).answer){g=!0;break}}if(g)for(s=0;s<i.length;++s){null===(p=i[s]).answer&&""===p.pair[1]&&(p.correct=!0,p.answer="")}var m=[];for(s=0;s<i.length;++s){(p=i[s]).correct?m.push(1):null===p.answer?m.push(-1):m.push(0)}var v=e.policy,b=(o=z(e),m);return{correctness:m=V(b,r),autoCorrectness:b,items:i,score:G(m,v,o),outof:$(m,v,o)}}function De(e,t,n){var r=z(e),o=t?-2:-1;return{correctness:V(o,n),autoCorrectness:o,score:0,outof:r}}function Ae(e){var t=/^ *(-?[0-9.,]+([eE]-?[0-9]+)?) *(E|P|T|G|M|k|h|da|d|c|m|u|n|p|f|a)?([^\d]+) *$/.exec(e.trim());if(null===t)return null;var n,r=t[3];switch(r){case void 0:n=0;break;case"E":n=18;break;case"P":n=15;break;case"T":n=12;break;case"G":n=9;break;case"M":n=6;break;case"k":n=3;break;case"h":n=2;break;case"da":n=1;break;case"d":n=-1;break;case"c":n=-2;break;case"m":n=-3;break;case"u":n=-6;break;case"n":n=-9;break;case"p":n=-12;break;case"f":n=-15;break;case"a":n=-18}return{value:t[1],prefix:r,scale:n,unit:null!=t[3]&&t[3].normalize?t[4].normalize("NFKC"):t[4]}}function Ee(e){if(null==e)return null;for(var t=e.length,n=1,r=0;r<t;++r){var o=e[r].split(" ");n=Math.max(n,o.length)}return{rows:t,columns:n}}function _e(e,t){for(var n=[],r=0;r<e.length;++r){for(var o=0;o<e[r].length;++o){var i=e[r][o];null==i||""===i.trim()?n.push("{}"):n.push(i.trim()),o!==e[r].length-1&&n.push("&")}r!==e.length-1&&n.push("\\\\")}return"$$\\leftLEFT \\begin{array} {cc} VALUES \\end{array} \\rightRIGHT$$".replace("LEFT","parentheses"===t?"(":"[").replace("RIGHT","parentheses"===t?")":"]").replace("VALUES",n.join(" "))}function Se(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"parentheses",n=Ee(e.matrix);if(null==n)return null;for(var r=[],o=0;o<n.rows;++o){for(var i=[],a=e.matrix[o].split(" "),s=0;s<n.columns;++s)i.push(a[s]);r.push(i)}return _e(r,t)}function ke(e,t,n){var r,o,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"parentheses",a=n.answer_style;if("Single"===a)r=t?"":e.single,o="$$"+(n.unit&&""!==n.unit?n.single_number+n.unit:n.single_number)+"$$";else if("Fraction"===a)r=t?"":"$$\\frac {"+e.numerator+"}{"+e.denominator+"}$$",o="$$\\frac{"+n.numerator+"}{"+n.denominator+"}$$";else if("Mixed"===a)r=t?"":"$$"+e.wholenumber+" \\frac {"+e.numerator+"}{"+e.denominator+"}$$",o="$$"+n.whole_number+" \\frac {"+n.numerator+"}{"+n.denominator+"}$$";else if("Exponential"===a)r=t?"":"$$ {"+e.base+"} ^ {"+e.exponent+"}$$",o="$$ {"+n.base+"} ^ {"+n.exponent+"}$$";else if("Matrix"===a){var s=[],u=Ee(n.matrix);if(null!=u){for(var l=0;l<u.rows;++l){for(var c=[],d=0;d<u.columns;++d)c.push(e["c_"+l+"_"+d]);s.push(c)}r=t?"":_e(s,i),o=Se(n,i)}}return{answer:r,canonicalAnswer:o}}function xe(e,t,n,r,o){function i(e){t?o(e,e,!1):r(e,e)}fe(function(e){for(var t=[],n=e.split("<br>"),r=0;r<n.length;++r)t.push(oe(n[r]));return t.join("\n")}(e),function(e){return de(e,i,n)},function(e){var t=e.split("/");2===t.length?o(t[0],t[1],!0):o(e,e,!0)})}n.d(t,"toFloat",function(){return H}),n.d(t,"getWrongAnswerWeight",function(){return K}),n.d(t,"arrayCount",function(){return Q}),n.d(t,"scoreForValidPolicyAndWeight",function(){return Z}),n.d(t,"processFillInText",function(){return re}),n.d(t,"isLegacyFITStyle",function(){return ie}),n.d(t,"getFITText",function(){return ae}),n.d(t,"processDragWordsInSentence",function(){return se}),n.d(t,"processEquations",function(){return ue}),n.d(t,"cleanGroupElemPaths",function(){return le}),n.d(t,"processText",function(){return de}),n.d(t,"processMarkSentence",function(){return pe}),n.d(t,"pictureId",function(){return he}),n.d(t,"wordId",function(){return ge}),n.d(t,"audioId",function(){return me}),n.d(t,"allCorrect",function(){return ve}),n.d(t,"dragDropKey",function(){return ye}),n.d(t,"splitNumberAndMetric",function(){return Ae}),n.d(t,"getMatrixDimensions",function(){return Ee}),n.d(t,"canonicalMatrix",function(){return Se}),n.d(t,"createNumericQuestionAnswer",function(){return ke}),n.d(t,"processCorrectSentence",function(){return xe}),n.d(t,"check",function(){return Oe}),n.d(t,"linkifyLinks",function(){return Ie}),n.d(t,"isNotAutoCorrectingQuestionType",function(){return Fe});var Oe={TextDescription:function(){return{}},TextMultpleChoice:J,RatedMultipleChoice:function(e,t){for(var n=0,r=e.Answers?e.Answers:[],o=0;o<r.length;++o)H(r[o].value)>n&&(n=H(r[o].value));if(null===t)return{correctness:-1,autoCorrectness:-1,score:0,outof:n};var i=H(r[t].value);return{correctness:i===n?1:0,autoCorrectness:0===i?0:1,score:i,outof:n}},TextMultiSelect:ee,QuestionTable:function(e,t,n){var r=e.rows||[];function o(e,t){var n=e.rows[t].split(/##/);return n.length>1?n[1].trim():null}function i(e,t){var n=e.rows[t].split(/##/);return n.length>1?n[0]:n}t=t||h()(Array(r.length),!1);for(var a={},s=e.columns?e.columns:[],u=0;u<s.length;++u)a[s[u].trim()]=u;for(var l=[],c=[],d=[],f=0;f<t.length;++f){var p=parseInt(t[f]),g=o(e,f);d.push(i(e,f)),null!=a[g]?c.push(a[g]):c.push(null),isNaN(p)?l.push(-1):null!==g&&a.hasOwnProperty(g)?a[g]===p?l.push(1):l.push(0):l.push(-2)}var m=z(e),v=l;return{correctness:l=V(v,n),autoCorrectness:v,score:Q(l,1)*m,outof:l.length*m,correctAnswers:c,questions:d}},MultiSelectQuestionTable:function(e,t,n){var r=e.rows||[];t=t||h()(Array(r.length),!1);for(var o="yes"===e.limited_selection,i={},s=e.columns?e.columns:[],l=0;l<s.length;++l)i[s[l].trim()]=l;var c=[],d=[],f=[];a()(t,function(t,n){var r=function(e,t){for(var n=function(e,t){return e.rows[t].split(/##/)}(e,t),r=h()(Array(s.length),!1),o=1;o<n.length;++o){var a=n[o].trim();i.hasOwnProperty(a)&&(r[i[a]]=!0)}return r}(e,n);f.push(function(e,t){var n=e.rows[t].split(/##/);return n.length>1?n[0]:n}(e,n)),d.push(r),c.push(m()(t,function(e,t){return 1===e===r[t]?1:0}))});var p=z(e),g=0,v=0;if(o){var b=u()(d),w=u()(c),y=0;a()(b,function(e,t){e&&(v+=p),e&&1===w[t]&&(y+=1)}),g=y*p}else if("each"===e.policy){var C=K(e),D=u()(d),A=u()(c),E=0,_=0;a()(D,function(e,t){e&&(v+=p),e&&1===A[t]?E+=1:e||0!==A[t]||(_+=1)}),g=Math.max(0,E*p-_*C)}else a()(c,function(e){Q(e,1)===e.length&&(g+=p)}),v=c.length*p;var S=c;return{correctness:c=V(S,n),autoCorrectness:S,score:g,outof:v,correctAnswers:d,questions:f}},PictureMultpleChoice:J,PictureMultiSelect:ee,MultiLine:function(e,t,n){var r=z(e);if(t=t||"",!e.hasOwnProperty("Keywords")||0===e.Keywords.length)return{correctness:u=V(s=""===t?-1:-2,n),autoCorrectness:s,score:1===u?r:0,outof:r,keywords:[]};var i=e.Keywords,a=e["case-sensitive"];t=Object(U.prepareForCompare)(t,a),t=Object(U.replaceBadQuotes)(t);for(var s,u,l=0,c=0,d=0,f=0,p=[],h=0;h<i.length;++h){for(var g=o()(Object(U.trimAll)(i[h].split(/##/)),function(e){return""!==e}),m=[],v=g.length>1&&!1===isNaN(g[g.length-1]),b=0;b<(v?g.length-1:g.length);++b)m[b]=Object(U.prepareForCompare)(g[b],a);var w,y=function(e,t,n,r){for(var o=0;o<r;++o)if(-1!==e.indexOf(Object(U.replaceBadQuotes)(n[o])))return t[o];return null};v?(++l,null!=(w=y(t,g,m,g.length-1))?(c+=H(g[g.length-1]),++f,p.push({keyword:w,match:!0,points:g[g.length-1]})):p.push({keyword:g[0],match:!1})):(++d,null!=(w=y(t,g,m,g.length))?(++f,p.push({keyword:w,match:!0})):p.push({keyword:g[0],match:!1}))}return l>0&&d>0&&console.error("Info: multiline question with keywords with and without points, keywords without points don't contribute to score."),""===t?{correctness:u=V(s=-1,n),autoCorrectness:s,score:0,outof:r,keywords:p}:l>0?c>=r?{correctness:u=V(s=1,n),autoCorrectness:s,score:r,outof:r,keywords:p}:{correctness:u=V(s=0,n),autoCorrectness:s,score:c,outof:r,keywords:p}:f===i.length?{correctness:u=V(s=1,n),autoCorrectness:s,score:r,outof:r,keywords:p}:{correctness:u=V(s=0,n),autoCorrectness:s,score:c,outof:r,keywords:p}},RichText:function(e,t,n){var r=z(e),o=null!=t&&""!==t?-2:-1;return{correctness:V(o,n),autoCorrectness:o,score:0,outof:r}},ExtraMultiLine:function(){return null},ExtraCheckbox:function(){return null},FillInText:function(e,t,n){t=t||[];var r=e["case-sensitive"];function o(e,t){return"text"===e.type?function(e,t){if(""===t)return-1;var n=oe(e.typeconfig);return""===n?-2:Object(U.matchesOneOfAnswers)(t,n,r)?1:0}(e,t):"select"===e.type?function(e,t){return null==t||"-"===t?-1:""!==t||function(e){for(var t=e.split(/##/,1),n=0;n<t.length;++n)if(""===t[n])return!0;return!1}(e.typeconfig)?t===oe((n=e.typeconfig,(r=n.split(/##/,1)).length>0?r[0].trim():""))?1:0:-1;var n,r}(e,t):null}var i=0,a=[];re(ae(e),function(e,n){if(null!==n)if(i<t.length){var r=o(n,t[i++].trim());null!==r&&a.push(r)}else t.length>0&&console.error("Error: FIT has more input fields than answers"),a.push(-1)});var s=z(e),u=a,l=(a=V(u,n),e.policy||"each");return{correctness:a,autoCorrectness:u,score:G(a,l,s),outof:$(a,l,s)}},FillInTable:function(e,t,n){function r(e,n){for(var r=0;r<t.length;++r){var o=t[r];if(o.row===e&&o.column===n)return o.value.trim()}return null}t=t||[];for(var o=e["case-sensitive"],i=e.tabledata,a=[],s=[],u=i&&i.values?i.values:[],l=0;l<u.length;++l)for(var c=u[l],d=0;d<c.length;++d){var f=c[d];if(f.hasOwnProperty("CellRole"))if("input"===f.CellRole)null===(p=r(l,d))||""===p?(a.push(-1),s.push({row:l,column:d,answer:"",correctness:-1})):(a.push(-2),s.push({row:l,column:d,answer:p,correctness:-2}));else if("checked"===f.CellRole){var p=r(l,d),h=f.value;if(""===p&&""===h){a.push(1),s.push({row:l,column:d,answer:"",correctness:1});continue}if(null===p||""===p){a.push(-1);var g={row:l,column:d,answer:"",correctness:-1};""!==h&&(g.correct=h),s.push(g);continue}if(""===f.value){a.push(-2),s.push({row:l,column:d,answer:p,correctness:-2});continue}Object(U.matchesOneOfAnswers)(p,f.value,o)?(a.push(1),s.push({row:l,column:d,answer:p,correct:h,correctness:1})):(a.push(0),s.push({row:l,column:d,answer:p,correct:h,correctness:0}))}}var m=z(e),v=a;a=V(v,n);var b=e.policy||"each";return{correctness:a,autoCorrectness:v,correctioninfo:s,score:G(a,b,m),outof:$(a,b,m)}},AnnotatePicture:function(e,t,n){t=t||[];for(var r=[],o=e["case-sensitive"],i=e.EditFields?e.EditFields:[],a=0;a<i.length;++a){var s=i[a],u=a<t.length?t[a].trim():"";""===u?r.push(-1):s.Valid&&""!==s.Valid?Object(U.matchesOneOfAnswers)(u,s.Valid,o)?r.push(1):r.push(0):r.push(-2)}var l=z(e),c=r,d=(r=V(c,n),e.policy||"each");return{correctness:r,autoCorrectness:c,score:G(r,d,l),outof:$(r,d,l)}},SingleLine:function(e,t,n){t=(t=t||"").trim();var r,o=z(e);if(""===t)r=-1;else{var i=e.Valid;if(""===i)r=-2;else{var a=e["case-sensitive"];r=Object(U.matchesOneOfAnswers)(t,i,a)?1:0}}var s=V(r,n);return{correctness:s,autoCorrectness:r,score:1===s?o:0,outof:o}},PictureOrdering:function(e,t,n){var r=e.Pictures||[];t=t||h()(Array(r.length),null);for(var o=z(e),i=[],a=0;a<r.length;++a)a>=t.length||null===t[a]?i.push(-1):t[a]===he(r[a])?i.push(1):i.push(0);var s=i,u=(i=V(s,n),e.policy);return{correctness:i,autoCorrectness:s,score:G(i,u,o),outof:$(i,u,o)}},WordOrdering:function(e,t,n){var r=e.Words||[],o=z(e);if("each"===e.policy){for(var i=[],a=0;a<r.length;++a)null===t?i.push(-1):t[a]===r[a]?i.push(1):i.push(0);return{correctness:i=V(s=i,n),autoCorrectness:s,score:Q(i,1)*o,outof:i.length*o}}if(null===t)return{correctness:i=V(s=-1,n),autoCorrectness:s,score:0,outof:o};var s,u="Sentences"===e.order_type?"\n":" ",l=r.join(u),c=t?t.join(u):"",d=!1;if(c===l)d=!0;else if(e.AlternateAnswers){c=t.join(" ");var f=e.AlternateAnswers;for(a=0;a<f.length;++a)c.replace(/ /g,"")===f[a].replace(/ /g,"")&&(d=!0)}return{correctness:i=V(s=i=d?1:0,n),autoCorrectness:s,score:i*o,outof:o}},Match:we,WordMatch:function(e,t,n){return we(e,t,ge,ge,n)},WordPictureMatch:function(e,t,n){return we(e,t,ge,he,n)},AudioWordMatch:function(e,t,n){return we(e,t,me,ge,n)},AudioPictureMatch:function(e,t,n){return we(e,t,me,he,n)},PicturePictureMatch:function(e,t,n){return we(e,t,he,he,n)},DragDrop:Ce,TextDragDrop:function(e,t,n){return Ce(e,t,ge,n)},PictureDragDrop:function(e,t,n){return Ce(e,t,he,n)},Whiteboard:De,Photo:De,AudioRecording:De,Numeric:function(e,t,n){var r=e.answer_style;if("Single"===r){var o=(t=t||{single:""}).single;if(""===o)v=-1;else if(null!=(m=e.single_number)&&(m=m.trim()),""===m)v=-2;else if(isNaN(m)&&isNaN(m.replace(",",".")))v=function(e,t,n){try{if(void 0!==n&&""!==n){var r=Ae("0"+n);if(null!==r){if(null===(o=Ae(t)))return!1;if(o.unit!==r.unit)return!1;t=o.value*Math.pow(10,o.scale-r.scale)}}else{var o;if(null!==(o=Ae(t)))return!1}return e=(e=(e=(e=e.replace(/NOT/g,"!")).replace(/AND/g,"&&")).replace(/OR/g,"||")).replace(/X/g,t),!0===C()({},e)}catch(n){return console.log("Problem calculating expression, returning false",e,t),!1}}(m,o.replace(",","."),e.unit)?1:0;else if(void 0===e.unit||""===e.unit)v=null===(i=Ae(o))&&H(o)===H(m)?1:0;else{var i=Ae(o),a=Ae("0"+e.unit);v=null===i||null===a||i.unit!==a.unit||H(o)*Math.pow(10,i.scale-a.scale)!==H(m)?0:1}}else{var s=[],u=[];if("Fraction"===r)t=t||{numeragor:"",denominator:""},s.push(t.numerator),s.push(t.denominator),u.push(e.numerator),u.push(e.denominator);else if("Mixed"===r)t=t||{wholenumber:"",numeragor:"",denominator:""},s.push(t.wholenumber),s.push(t.numerator),s.push(t.denominator),u.push(e.whole_number),u.push(e.numerator),u.push(e.denominator);else if("Exponential"===r)t=t||{base:"",exponent:""},s.push(t.base),s.push(t.exponent),u.push(e.base),u.push(e.exponent);else{if("Matrix"!==r)return console.error("Wrong type for Numeric question type: ",r),null;t=t||{};var l=Ee(e.matrix);if(null!=l)for(var c=0;c<l.rows;++c)for(var d=e.matrix[c].trim().split(" "),f=0;f<l.columns;++f)s.push(t["c_"+c+"_"+f]),u.push(d[f])}var p=!0,h=!0,g=!1;for(c=0;c<s.length;++c){var m;""!==s[c]&&(p=!1),null!=(m=u[c])&&(m=m.trim()),""===m&&(g=!0),m!==s[c]&&(h=!1)}v=p?-1:g?-2:h?1:0}var v,b=z(e),w=v;return{correctness:v=V(w,n),autoCorrectness:w,score:1===v?b:0,outof:b}},BalanceChemicalEquation:function(e,t,n){var r=e.Equation||"",i=w.parseEquation(r),a=w.reduceReactantsAndProducts(i);t=t||("type3"===e.SubType?[]:{balanced:"",reactantsTable:"type1"===e.SubType?[]:o()(m()(a.reactants,function(e,t){return{row:t,value:""}}),function(e,t){return t%2==1}),productsTable:"type1"===e.SubType?m()(a.products,function(e,t){return{row:t,value:""}}):o()(m()(a.products,function(e,t){return{row:t,value:""}}),function(e,t){return t%2==0})});var s=[];function u(e,t){for(var n=0;n<e.length;++n){var r=e[n];""===r.value?s.push(-1):s.push(parseInt(r.value)===t[r.row].qty?1:0)}}switch(e.SubType){case"type1":case"type2":""===t.balanced?s.push(-1):w.isBalanced(r)===("yes"===t.balanced)?s.push(1):s.push(0),u(t.reactantsTable,a.reactants),u(t.productsTable,a.products);break;case"type3":for(var l=i.reactants.concat(i.products),c=0;c<l.length;++c)c<t.length?s.push(l[c].qty===parseInt(t[c])?1:0):s.push(-1)}var d=z(e),f=s;return{correctness:s=V(f,n),autoCorrectness:f,score:Q(s,1)*d,outof:s.length*d}},IonicCompoundBuilder:function(e,t,n){t=t||{posIons:[],negIons:[]};var r=w.parseFormula(e.Valid||""),o=t.posIons.concat(t.negIons),i=w.joinIonsToFormula(o),a=w.totalCharge(o);s=0===i.length?-1:0!==a?0:w.equalFormulas(i,r)?1:0;var s,u=z(e),l=s;return{correctness:s=V(l,n),autoCorrectness:l,score:1===s?u:0,outof:u}},CorrectSentence:function(e,t,n){t=t||[];var r=[],o=[],i=[],a=e["case-sensitive"],s="each"===e.policy,u="yes"===e["all-words-editable"],l=0;xe(e.Sentence||"",u,function(){},function(){},function(e,n,u){var c=l<t.length?t[l++]:"";s?(i.push(1),r.push(c),Object(U.matchesOneOfAnswers)(c,n,a)?o.push(1):c===e?o.push(-1):o.push(0)):(i.push(u?1:-1),r.push(c),Object(U.matchesOneOfAnswers)(c,n,a)?o.push(1):u?o.push(c===e?-1:0):o.push(0))});var c=z(e),d=K(e),f=o,p=(o=V(f,n),Q(i,1)),h=0,g=0;for(l=0;l<i.length;++l)1===i[l]?1===o[l]&&++h:1!==o[l]&&++g;var m=Math.max(h*c-g*d,0);return{correctness:o,autoCorrectness:f,score:m,answers:r,outof:p*c}},DragWordsInSentence:function(e,t,n){t=t||[];var r=0,o=[];se(e.Sentence||"",function(e,n){if(null!==n)if(r<t.length){var i=function(e,t){return""===t?-1:t.trim()===e.trim()?1:0}(n,t[r++].trim());null!==i&&o.push(i)}else o.push(-1),t.length>0&&console.error("Error: DWIS has more input fields than answers")});var i=z(e),a=o;return{correctness:o=V(a,n),autoCorrectness:a,score:Q(o,1)*i,outof:o.length*i}},Equations:function(e,t,n){function r(e,t){return""===(t=t.trim())?-1:""===(e=e.trim())?-2:-1===e.split("##").map(function(e){return(e=e.trim()).startsWith("$$")&&(e=e.substring(2)),e.endsWith("$$")&&(e=e.substring(0,e.length-2)),function(e,t){var n,r;try{n=S(e)}catch(e){n=null}try{r=S(t)}catch(e){r=null}return null==n?null==r&&e===t:null!=r&&T(W(n),W(r))}(t,e.trim())?1:0}).indexOf(1)?0:1}t=t||[];var o=0,i=[];ue(e.Sentence||"",function(e,n){if(null!==n)if(o<t.length){var a=t[o++].trim(),s=r(oe(n),a);null!==s&&i.push(s)}else i.push(-1),t.length>0&&console.error("Error: EQ has more input fields than answers")});var a=z(e),s=i,u=(i=V(s,n),e.policy||"each");return{correctness:i,autoCorrectness:s,score:G(i,u,a),outof:$(i,u,a)}},Group:function(e,t,n){t=t||[];var r=[],o=[],i=e.groups||[];if(Math.max.apply(0,m()(t,function(e){return e.length}))<=1)r=h()(Array(i.length),-1),o=h()(Array(t.length),-1);else{var a=m()(i,function(e){return ce(e.elements||[])}),s=m()(t,function(e){return ce(e)});r=m()(a,function(e){return-1===s.indexOf(e)?0:1}),o=m()(s,function(e){return-1===a.indexOf(e)?0:1})}var u=V(r,n),l=z(e);return{correctness:u,autoCorrectness:r,score:Q(u,1)*l,outof:u.length*l,answerCorrectness:o}},MarkSentence:function(e,t,n){var r=[],o=[],i=0,a=Q(t=t||[],"")===t.length;pe(e.Sentence||"",function(){},function(){a?(r.push(-1),o.push(-1)):""===t[i]?(r.push(1),o.push(1)):(r.push(0),o.push(0)),++i},function(n){if("yes"===e.mark_individual_words){var s=!0;de(n.word,function(){a?o.push(-1):t[i]===n.type?o.push(1):(o.push(0),s=!1),++i},function(){}),a?r.push(-1):s?r.push(1):r.push(0)}else a?(r.push(-1),o.push(-1)):t[i]===n.type?(r.push(1),o.push(1)):(r.push(0),o.push(0)),++i});var s=r;r=V(s,n);var u=0,l=0,c=0,d=null;i=0,pe(e.Sentence||"",function(){},function(){0===r[i]&&d!==t[i]?(++u,d=t[i]):d="",++i},function(){++c,1===r[i]?(++l,d=""):0===r[i]&&(d=t[i]),++i});var f=z(e),p=K(e);return{correctness:r,autoCorrectness:s,wordcorrectness:o,score:Math.max(0,l*f-u*p),outof:f*c}},CrossWord:function(e,t,n){t=t||[];var r=[],o=e["case-sensitive"],i=e.words,a=Object(j.k)([],t),s=[];if(i&&i.length>0)for(var u=0;u<i.length;u++){var l=i[u],c=Object(j.f)(a,l);s.push(c),0===c.replace(" ","").length?r.push(-1):Object(U.matchesOneOfAnswers)(l.word,c,o)?r.push(1):r.push(0)}var d=Object(j.j)(a,i,o),f=z(e),p=r;return{correctness:r=V(p,n),autoCorrectness:p,score:Q(r,1)*f,outof:r.length*f,correctedCrossword:d,answerWords:s}},Rubric:function(e,t,n){var r=e.rubric,o=0,i=[],a=0;if(r){var s=r.labels,u=r.rows;if(s&&s.length&&u&&u.length){var l=s.map(function(e){return H(e.weight)||0}),c=0;u.forEach(function(e){var t=e.cells.map(function(e,t){return"0"===e.weight?H(e.weight):H(e.weight)||l[t]||0});n&&e.cells.forEach(function(e,r){1===n[c]&&(a+=t[r]),c++});var r=Math.max.apply(Math,q(t));o+=r}),i=u.map(function(){return s.map(function(){return-2})}).reduce(function(e,t){return e.concat(t)})}}var d=i;return i=V(d,n),"no"===e.needs_correction?{correctness:i,autoCorrectness:-2,score:0,outof:0}:{correctness:i,autoCorrectness:d,score:a,outof:o}}};function Ie(e){return e.replace(/\b(?:https?):\/\/[a-z0-9-+&@#/%?=~_|!:,.;]*[a-z0-9-+&@#/%=~_|]/gim,'<a href="$&" target="_blank" class="weblink">$&</a>')}function Fe(e){return-1!==c()(["RichText","Photo","Whiteboard","AudioRecording","Rubric"],e)}},137:function(e,t,n){"use strict";n.r(t),n.d(t,"spellCheckAttribs",function(){return l}),n.d(t,"spellCheckAttribString",function(){return c});var r=n(145),o=n.n(r),i=n(2),a=n.n(i),s={spellcheck:"true",autocomplete:"new-password",autocapitalize:"none"},u={spellcheck:"false",autocorrect:"off",autocomplete:"new-password",autocapitalize:"none"};function l(e){return o()({name:Date.now()+Math.random()},e?s:u)}function c(e){var t=l(e);return a()(t,function(e,t){return t+'="'+e+'"'}).join(" ")}},143:function(e,t){e.exports=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},146:function(e,t,n){"use strict";function r(e){return"Numerical"!==e?{}:{pattern:"[0-9]*",inputmode:"numeric"}}n.r(t),n.d(t,"keyboardAttribs",function(){return r})},16:function(e,t){e.exports=function(){var e=["context_id","course_id","hide_account","lfq","lti","login_hint","no_logout","q","sso","smartschool_platform","student_class_id","submit_url","teacher_email","teacher_id"];function t(e){var t=[];if("[object Array]"===Object.prototype.toString.call(e))for(var n=0;n<e.length;++n){var r=e[n];r.length>1?t.push(encodeURIComponent(r[0])+"="+encodeURIComponent(r[1])):t.push(encodeURIComponent(r[0]))}else for(var o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")}function n(e){for(var t={},n=e.split("&"),r=0;r<n.length;r++){var o=n[r].indexOf("=");if(!(o<0)){var i=[n[r].substr(0,o),n[r].substr(o+1)],a=decodeURIComponent(i[0]);if(void 0===t[a])t[a]=decodeURIComponent(i[1]);else if("string"==typeof t[a]){var s=[t[a],decodeURIComponent(i[1])];t[a]=s}else t[a].push(decodeURIComponent(i[1]))}}return t}function r(e){for(var t=[],n=e.split("&"),r=0;r<n.length;r++){var o=n[r].indexOf("=");if(o<0)t.push([n[r]]);else{var i=[n[r].substr(0,o),n[r].substr(o+1)];t.push([decodeURIComponent(i[0]),decodeURIComponent(i[1])])}}return t}function o(e){return!e||e.length<1||"?"!==e[0]?{}:n(e.substr(1))}function i(e){return!e||e.length<1||"?"!==e[0]?[]:r(e.substr(1))}function a(e,t){return e.split("&").filter(function(e){return decodeURIComponent(e.split("=")[0])!==t}).join("&")}function s(e){return(e=e||window.location.href).indexOf("#")>=0?"#"+(e.split("#")[1]||""):""}!function(){if(!window.WidgetParams){var n=i(window.location.search),o=[],a=s();if(a.length>=1&&"#"===a[0])for(var u=r(a.substr(1)),l=0;l<u.length;++l){var c=u[l];e.indexOf(c[0])>=0?n.push(c):o.push(c)}var d=window.location.pathname;n.length>0&&(d+="?"+t(n)),o.length>0&&(d+="#"+t(o)),"undefined"!=typeof history&&history.replaceState("",document.title,d)}}();var u=s(),l=window.location.search;return{split:n,splitList:r,getUrlParams:function(e){return-1===e.indexOf("?")?{}:n(e.replace(/[^?]*\?/,"").replace(/#.*/,""))},getQueryParams:o,getParameters:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=window.WidgetParams?{}:o(l);if(e){var r=function(e){return!e||e.length<1||"#"!==e[0]?{}:n(e.substr(1))}(u);for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}if(window.WidgetParams)for(var a in window.WidgetParams)t[a]=window.WidgetParams[a];return t},removeQueryStringParameter:function(e,t){return e.length>0&&("?"===e[0]||"#"===e[0])?e[0]+a(e.substring(1),t):a(e,t)},updateWindowQueryParameter:function(e,n){for(var r=i(window.location.search),o=!1,a=0;a<r.length;++a)if(r[a][0]===e){r[a].length>1?r[a][1]=n:r[a].push(n),o=!0;break}o||r.push([e,n]),history.replaceState("",document.title,window.location.pathname+"?"+t(r)+s())},urlencode:t,getHash:s,LEGACY_HASH_PARAMETERS:e}}()},169:function(e,t,n){"use strict";function r(e){if(0===e.length)throw new Error("too little params");var t=e[0];return e.shift(),t}function o(e){if(0===e.length)throw new Error("too little params");if(isNaN(e[0]))throw new Error("wrong param type, not int");var t=parseInt(e[0]);return e.shift(),t}function i(e,t){return e.length>0&&e[0]===t&&(e.shift(),!0)}function a(e,t,n){if(""===e)return"";var r=function(e,t){var n=Math.pow(10,t||0);return String(Math.round(e*n)/n)}(e,t);return n&&(r=String(r).split("").reverse().join("").replace(/(\d{3}\B)/g,"$1,").split("").reverse().join("")),r}function s(e,t){if(isNaN(e))return e;var n,s,u,l,c=e,d=t.split(", ");try{if("number"===(n=r(d)))c=a(e,s=o(d),u=i(d,"ts"));else if("percentage"===n)c=a(100*e,s=o(d),u=i(d,"ts")),c+="%";else if("currency"===n){s=o(d),u=i(d,"ts"),l=r(d);var f=i(d,"post");c=a(e,s,u),f?c+=l:c=l+c}}catch(e){console.log("Error parsing format: "+e)}return c}function u(e,t,n){for(var r=0;r<e.length;++r){var o=e[r];if(o.row===t&&o.column===n)return o}return null}function l(e,t,n,r){for(var o='<table border="1" style="border-collapse:collapse">',i=e&&e.values?e.values:[],a=0;a<i.length;++a){o+="<tr>";for(var l=i[a],c=0;c<l.length;++c){var d,f=l[c];if(f.hasOwnProperty("CellRole"))if("checked"===f.CellRole||"input"===f.CellRole){var p=r?u(r.correctioninfo,a,c):null;f.hasOwnProperty("CellFormat")?(d=s(t[a][c],f.CellFormat),n&&p&&(0===p.correctness||-1===p.correctness&&p.hasOwnProperty("correct"))&&(d+=" ("+s(p.correct,f.CellFormat)+")")):(d=t[a][c],n&&p&&(0===p.correctness||-1===p.correctness&&p.hasOwnProperty("correct"))&&(d+=" ("+p.correct+")"))}else d="calculated"===f.CellRole?f.hasOwnProperty("CellFormat")?s(t[a][c],f.CellFormat):t[a][c]:f.value;else d=f.hasOwnProperty("CellFormat")?s(t[a][c],f.CellFormat):t[a][c];var h="padding: 5px;";if(n&&f.hasOwnProperty("CellRole")&&("checked"===f.CellRole||"input"===f.CellRole)){var g=r?u(r.correctioninfo,a,c):null,m=g&&-2===g.correctness,v=g&&1===g.correctness;m?(h+="color:black;",h+="background: #FAAE3C;"):v?(h+="color:green;",h+="background: #C0FFC0;"):(h+="color:red;",h+="background:#FFC0C0;")}else f.hasOwnProperty("BackgroundColor")&&(h+="background:"+f.BackgroundColor+";"),f.hasOwnProperty("TextColor")&&(h+="color:"+f.TextColor+";");f.hasOwnProperty("HAlign")&&(h+="text-align:"+f.HAlign+";"),f.hasOwnProperty("VAlign")&&(h+="vertical-align:"+f.VAlign+";"),f.hasOwnProperty("BorderLeft")&&(h+="border-left:"+f.BorderLeft+";"),f.hasOwnProperty("BorderRight")&&(h+="border-right:"+f.BorderRight+";"),f.hasOwnProperty("BorderTop")&&(h+="border-top:"+f.BorderTop+";"),f.hasOwnProperty("BorderBottom")&&(h+="border-bottom:"+f.BorderBottom+";"),o+='<td style="'+h+'">'+d+"</td>"}o+="</tr>"}return o+="</table>"}n.r(t),n.d(t,"realValueToDisplayValue",function(){return s}),n.d(t,"findCorrection",function(){return u}),n.d(t,"styledTableToHtml",function(){return l})},17:function(e,t,n){e.exports=(n(22),function(e){try{return window.bwlocalizationmap&&window.bwlocalizationmap[e]&&""!==window.bwlocalizationmap[e]?window.bwlocalizationmap[e]:e}catch(t){return e}})},175:function(e,t,n){var r,o,i=n(14).map,a=n(176).makeLabeledToolButton,s=n(143);e.exports=(r=n(17),o=n(1),function(e,t,n){var u=e.config,l=e.hasOwnProperty("submitName")?e.submitName:""==u.id?""==u.title?e.defaultName:u.title:u.id;function c(n){var r=t.createStudentWorkSubmitter(l,u.book_title,u.uuid2,u.WA);r.setCompanyInfo(u.company_name,u.company_address,u.company_phone,u.company_website);var o=[],i=[];function a(e){return{data:e(),mimetype:"image/png"}}e.assetFetcherCB&&e.assetUploadCompleteCB?(o=[e.assetFetcherCB],i=[e.assetUploadCompleteCB]):e.assetFetcherLister&&e.assetUploadCompleteLister&&(o=e.assetFetcherLister(),i=e.assetUploadCompleteLister());for(var s=0;s<o.length;++s)r.scheduleAssetUpload(a.bind(null,o[s]),i[s]);return r.setAnswersComposer(function(){return e.getAnswers(n)}),r}function d(t){var o=c(t);return o.on(o.EVT_SUBMIT_SUCCEEDED,function(){var t=e.submitSuccessMessage,a=o.getLastServerData();a&&a.messages&&(t+="<br><br>"+i(a.messages,function(e){return s(e.message)}).join("<br>")),n.showAlert(t,r("Sent successfully"))}),o.on(o.EVT_SUBMIT_FAILED,o.afterSubmitFailed.bind(o,e.submitFailedTitle,e.submitFailedMessage)),o}"yes"!=u.submit_answers&&"yes"!=u.send_drawing||(o("#sendbutton").show().click(function(){var t=d(!0);t.setEndpoint(u.action),t.setIncludeGrading("yes"==u.email_should_have_grading),t.showSendDialog(e.sendDialogMessage)}),a(o("#sendbutton"),r("Submit"))),"yes"==u.allow_sharing&&o("#sharebutton").show().click(function(){var t=d(!1);t.setEndpoint(u.share_action),t.setIncludeGrading(!1),t.showShareDialog(e.shareDialogMessage)}),"yes"==u.allow_download&&o("#downloadbutton").show().click(function(){var e=c(!1);e.setEndpoint(u.download_action),e.setIncludeGrading(!1),e.showDownloadDialog(r("Enter your name and click 'Generate' to generate the PDF."))})})},176:function(e,t,n){"use strict";n.r(t),n.d(t,"makeLabeledToolButton",function(){return a});var r=n(16),o=n(1),i=n.n(o);function a(e,t){"1"===Object(r.getParameters)().lsb&&(i()(document.createElement("span")).text(t).prependTo(e),e.addClass("bw-labeled-toolbutton"))}},189:function(e,t,n){var r=n(169),o=r.realValueToDisplayValue,i=r.findCorrection,a=r.styledTableToHtml;e.exports=function(e,t,n){return function(n){var r=n.tablediv,s=n.tabledata,u=n.hasOwnProperty("calculate")?n.calculate:function(){},l=!!n.hasOwnProperty("support_correction_colors")&&n.support_correction_colors;t(document.createElement("div")).addClass("styledtablehidden").css("display","none").appendTo(t(r).parent());for(var c=null,d=null,f=function(n,a,u,f,p,h,g){var m=t(a),v={},b=s.values[u][f];b.hasOwnProperty("CellFormat")&&(h=o(h,b.CellFormat),m.find(".bw-table-cell-contents").safeHtml(h));for(var w=["font-family","font-weight","font-style","font-variant","font-size"],y=0;y<w.length;++y){var C=w[y];b.hasOwnProperty(C)&&(v[C]=b[C])}if(b.hasOwnProperty("font-size")&&(v["line-height"]=Math.max(parseInt(b["font-size"]),21)+"px"),l&&b.hasOwnProperty("CellRole")&&("checked"===b.CellRole||"input"===b.CellRole)){if(c){var D=i(c.correctioninfo,u,f);if(D&&D.answer!==h&&(c=d(),D=i(c.correctioninfo,u,f)),D)if(1===D.correctness)m.addClass("cell_correct").removeClass("cell_wrong").removeClass("cell_open"),m.find(".bw-table-cell-contents").append(" &#x2713;");else if(-2!==D.correctness&&D.correct){var A=D.correct.split(/##/),E=1===A.length?D.correct:A.join(" / "),_=m.addClass("cell_wrong").removeClass("cell_correct").removeClass("cell_open").find(".bw-table-cell-contents").append(t(document.createElement("span")).addClass("cell_right_value").safeHtml(" ("+E+")"));0===D.correctness&&_.append(t(document.createElement("span")).addClass("cr-wrong").append(" &#x2718;"))}else m.addClass("cell_open")}}else b.hasOwnProperty("BackgroundColor")&&(v.background=b.BackgroundColor,v["background-clip"]="padding-box"),b.hasOwnProperty("TextColor")&&(v.color=b.TextColor);if(b.hasOwnProperty("HAlign")&&(v["text-align"]=b.HAlign),b.hasOwnProperty("VAlign")&&(v["vertical-align"]=b.VAlign),b.hasOwnProperty("BorderLeft")&&(v["border-left"]=b.BorderLeft),b.hasOwnProperty("BorderRight")&&(v["border-right"]=b.BorderRight),b.hasOwnProperty("BorderTop")&&(v["border-top"]=b.BorderTop),b.hasOwnProperty("BorderBottom")&&(v["border-bottom"]=b.BorderBottom),s.hasOwnProperty("layout")&&s.layout.hasOwnProperty("rows")&&(v.height=s.layout.rows[u].height+"px"),m.css(v),b.hasmath){var S=t(r).parent().find("#cell_"+u+"_"+f).clone();S.removeAttr("id"),m.empty().append(S),e.processMathElems(m)}},p=s&&s.values?s.values:[],h=function(n){for(var o=[],i=n||[],a=0;a<i.length;++a){for(var s=i[a],u=[],l=0;l<s.length;++l){var c=s[l];if(!c.hasOwnProperty("CellRole")||"calculated"!==c.CellRole&&"checked"!==c.CellRole)if(c.hasOwnProperty("CellRole")&&"readonly"===c.CellRole){var d=e.prepare(c.value);d!==c.value?(t(document.createElement("span")).attr("id","cell_"+a+"_"+l).safeHtml(d).appendTo(t(r).parent().find(".styledtablehidden")),c.hasmath=!0,u.push(d)):u.push(c.value)}else u.push(c.value);else u.push("")}o.push(u)}return o}(p),g=t.extend(!0,[],h),m=0,v=s&&s.layout&&s.layout.columns?s.layout.columns:[],b=0;b<v.length;++b)m+=v[b].width;for(b=0;b<p.length;++b)for(var w=p[b],y=0,C=0,D=0;D<w.length;++D){if((k=w[D]).hasOwnProperty("BorderTop")){var A=parseInt(k.BorderTop);A>y&&(y=A)}if(k.hasOwnProperty("BorderBottom")){var E=parseInt(k.BorderBottom);E>C&&(C=E)}}for(D=0;D<v.length;++D){var _=0,S=0;for(b=0;b<p.length;++b){var k;if((k=s.values[b][D]).hasOwnProperty("BorderLeft")){var x=parseInt(k.BorderLeft);x>_&&(_=x)}if(k.hasOwnProperty("BorderRight")){var O=parseInt(k.BorderRight);O>S&&(S=O)}}m+=_+S}var I={};I.data=h,I.table_change_callbacks=[],I.setChangeCallBack=function(e){this.table_change_callbacks.push(e)},I.callChangeCallbacks=function(){for(var e=0;e<this.table_change_callbacks.length;++e)this.table_change_callbacks[e]()};var F={data:h,asyncRendering:!1,stretchH:"none",onChange:function(e,n){u(),t(r).bwtable("render"),I.callChangeCallbacks()},maxColumns:s&&s.layout&&s.layout.colums?s.layout.columns.length:0,cells:function(e,t,n){var r={renderer:f};return!s.values[e][t].hasOwnProperty("CellRole")||"readonly"!==s.values[e][t].CellRole&&"calculated"!==s.values[e][t].CellRole||(r.readOnly=!0),r},width:m,spellcheck:n.spellcheck,keyboard:n.keyboard};if(s&&s.layout&&s.layout.columns){var T=[];for(v=s.layout.columns,b=0;b<v.length;++b)T.push(v[b].width);F.colWidths=T}return t(r).bwtable(F),I.setData=function(e){for(var n=s&&s.values?s.values:[],o=0;o<e.length;++o){var i=e[o];if(n[i.row]&&n[i.row][i.column]){var a=n[i.row][i.column];a.hasOwnProperty("CellRole")&&"checked"!==a.CellRole&&"input"!==a.CellRole||(h[i.row][i.column]=i.value)}}u(),t(r).bwtable("render")},I.getData=function(){for(var e=[],t=s&&s.values?s.values:[],n=0;n<t.length;++n)for(var r=t[n],o=0;o<r.length;++o){var i=r[o];i.hasOwnProperty("CellRole")&&"input"!==i.CellRole&&"checked"!==i.CellRole||(i.hasOwnProperty("CellRole")||h[n][o]!==g[n][o])&&e.push({row:n,column:o,value:h[n][o]})}return e},I.getProgress=function(){for(var e=0,t=0,n=s&&s.values?s.values:[],r=0;r<n.length;++r)for(var o=n[r],i=0;i<o.length;++i){var a=o[i];"input"!==a.CellRole&&"checked"!==a.CellRole||(++e,h[r][i]!==g[r][i]&&++t)}return{inputCellCount:e,changedCellCount:t}},I.clear=function(){for(var e=s&&s.values?s.values:[],n=0;n<e.length;++n)for(var o=e[n],i=0;i<o.length;++i){var a=o[i];a.hasOwnProperty("CellRole")&&"checked"!==a.CellRole&&"input"!==a.CellRole||(h[n][i]="checked"!==a.CellRole?a.value:"")}u(),t(r).bwtable("render"),this.callChangeCallbacks()},I.loadCorrect=function(e){for(var n=0;n<e.values.length;++n)for(var o=e.values[n],i=0;i<o.length;++i){var a=o[i];a.hasOwnProperty("CellRole")&&"checked"===a.CellRole&&(h[n][i]=a.value)}t(r).bwtable("render")},I.render=function(){t(r).bwtable("render")},I.setReadOnly=function(e){t(r).bwtable("updateSettings",{readOnly:e})},I.setCorrectionCallback=function(e){c=(d=e)?d():null,t(r).bwtable("render")},I.getCheckInput=function(){for(var e=[],t=s&&s.values?s.values:[],n=0;n<t.length;++n)for(var r=t[n],o=0;o<r.length;++o){var i=r[o];!i.hasOwnProperty("CellRole")||"input"!==i.CellRole&&"checked"!==i.CellRole||e.push({row:n,column:o,value:h[n][o]})}return e},I.getFormattedValueForCell=function(e,t){var n=s.values[e][t];return n.hasOwnProperty("CellFormat")?o(h[e][t],n.CellFormat):h[e][t]},I.getEmailTable=function(e,t){return a(s,h,e,t)},I}}(n(25),n(1),n(200))},2:function(e,t,n){var r=n(122),o=n(59),i=n(135),a=n(10);e.exports=function(e,t){return(a(e)?r:i)(e,o(t,3))}},200:function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,i=n(137).spellCheckAttribs,a=n(146).keyboardAttribs;e.exports=void(o=n(1)).fn.extend({bwtable:function(e,t){function n(e,t){var n=e.data("config");if(n){var r=e.find("tr");e.toggleClass("readonly",!0===n.readOnly);for(var i=0;i<r.length;++i)for(var a=o(r[i]),s=n.data[i],u=a.find("td"),l=0;l<u.length;++l){var c=s[l],d=o(u[l]);if(t||c!==d.attr("value")){var f=n.cells(i,l),p=o(document.createElement("div")).addClass("bw-table-cell-contents").safeHtml(c);d.find(".bw-table-cell-contents").replaceWith(p),f.hasOwnProperty("renderer")&&f.renderer(e,d[0],i,l,null,c,f),d.attr("value",c),d.find("textarea").val(c)}}}}function s(e){e.css("height",e.parent().innerHeight())}if("string"==typeof e)return c=this,f=t,void("render"===(d=e)?(n(c,!0),c.find("textarea").each(function(){s(o(this))})):"loaddata"===d?(u=c,l=f,u.data("config").data=l,n(c,!1)):"updateSettings"===d?(function(e,t){var n=e.data("config");for(var r in t)n[r]=t[r]}(c,f),n(c,!0)):console.error("Unknown bwtable command: ",d));var u,l,c,d,f;"object"===r(e)&&function(e,t){e.empty();for(var r=o(document.createElement("table")).addClass("bw-table"),u=o(document.createElement("tbody")).appendTo(r),l=0;l<t.data.length;++l)for(var c=t.data[l],d=o(document.createElement("tr")).appendTo(u),f=0;f<c.length;++f){var p=c[f],h=o(document.createElement("td")).attr("value",p).appendTo(d);t.hasOwnProperty("colWidths")&&h.css({width:t.colWidths[f]});var g=t.cells(l,f);if(o(document.createElement("div")).addClass("bw-table-cell-contents").safeHtml(p).appendTo(h),g.hasOwnProperty("renderer")&&g.renderer(e,h[0],l,f,null,p,g),!0!==g.readOnly){var m=o(document.createElement("textarea")).addClass("bw-table-cell-input").val(p).appendTo(h).attr(i(t.spellcheck)).attr(a(t.keyboard)).on("focus",function(){var e=o(this);e.parent().addClass("editing"),s(e)}).on("blur",function(t,r){return function(){var i=o(this),a=i.parent().parent().parent().parent().parent().data("config");i.parent().removeClass("editing");var s=i.val();i.parent().attr("value")!==s&&(a.data[t][r]=s,a.onChange([[t,r]]),n(e))}}(l,f));s(m)}}r.appendTo(e),e.data("config",t)}(this,e)}})},21:function(e,t,n){var r=n(12);e.exports=function(e,t){function n(n,r,o,i,a){a=a||a+" custom_alert",o=o||e("Ok"),r=r||"Alert",n=n||"No Message to Display";var s=t(document.createElement("div")),u={};return u[o]=function(){t(this).dialog("close"),t(this).remove(),i&&i()},s.safeHtml(n).dialog({title:r,dialogClass:"bw-dialog no-close "+a,resizable:!1,modal:!0,width:"auto",buttons:u}),s}return{showAlert:n,navigateAlert:function(e,r,o,i){var a=n(e,r,o,function(){});return a.parent().find("button").replaceWith(t(document.createElement("a")).safeHtml(o).attr({href:i,target:"_top"}).addClass("ui-button")),a},showCriticalAlert:function(e,r){var o={message:e,title:r};function i(){n(o.message,o.title)}0===t("#critical-alert-button").length&&t(document.createElement("div")).attr("id","critical-alert-button").addClass("bw-toolbutton").append(t(document.createElement("div")).addClass("bw-icon bw-icon-critical-error")).prependTo(t("#title-toolbar")).click(i),i()},showFatalAlert:function(e,n){t(document.createElement("div")).safeHtml(e).dialog({title:n,dialogClass:"bw-dialog no-close",resizable:!1,modal:!0,width:"auto"})},showConfirmationDialog:function(e,n,o,i,a,s,u){n||(n="Please confirm"),e||(e=""),a||(a="OK"),s||(s="Cancel"),t("#BwConfirmationDalog").remove();var l=t(document.createElement("div")).attr("id","BwConfirmationDialog"),c={};return c[a]=function(){t(this).dialog("close"),t(this).remove(),o&&o()},c[s]=function(){t(this).dialog("close"),t(this).remove(),i&&i()},l.safeHtml(e).dialog({title:n,dialogClass:r("bw-dialog BwConfirmationDialog no-close",u&&"bw-confirmation-warning"),open:function(){t(this).parent().find(".ui-dialog-buttonpane button:eq(1)").focus()},resizable:!1,modal:!0,width:500,buttons:c}),l},showInfoMessage:function(e){console.log("ShowInfoMessage");var n=t(document.createElement("div"));function r(){n.removeClass("bw-dialog-animate-in").addClass("bw-dialog-animate-out"),setTimeout(function(){n.remove()},500)}n.safeHtml(e).addClass("bw-dialog bw-info-dialog bw-dialog-animate-in").click(function(e){e.stopPropagation(),r()}).appendTo(t("body")),setTimeout(r,1e4)}}}(n(17),n(1))},22:function(e,t,n){function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(76).default,a=n(14).map;e.exports=function(e,t){var n={},s=t.Deferred();function u(){var e=".";return window.WidgetResourceBase?window.WidgetResourceBase:(0===window.location.pathname.indexOf("/_ah/gcs/bookwidgets-eu--widgets/")?e=window.location.origin+"/_ah/gcs/bookwidgets-eu--widget-assets":window.location.host.startsWith("widgets-eu.")&&(e=window.location.host.replace("widgets-eu.","//widget-assets-eu.")),e)}function l(e){return function e(n,r){if("string"==typeof n)return n.replace(/\$RESOURCEDIR/g,r);if(t.isArray(n)){for(var i=[],a=0;a<n.length;++a)i.push(e(n[a],r));return i}if("object"===o(n)){var s={};for(var u in n)n.hasOwnProperty(u)&&(s[u]=e(n[u],r));return s}return n}(e,u())}return i().then(function(r){var i=function(e){var n=function e(n){if("string"==typeof n)return function(e){for(var t="",n=0;n<e.length;++n)2*n<e.length?t+=e.charAt(2*n):t+=e.charAt(2*(e.length-n)-1);return t}(n);if(t.isArray(n)){for(var r=[],i=0;i<n.length;++i)r.push(e(n[i]));return r}if("object"===o(n)){var a={};for(var s in n)n.hasOwnProperty(s)&&(a[s]=e(n[s]));return a}return n}(e);return n=l(n)}(r);for(var a in i)n[a]=i[a];e(n),s.resolve(n)}),{fixResourcePaths:l,extractOnlineResources:function(e){if("."===u())return[];try{return function e(n,i,s){var u=[];if("string"==typeof n)n.startsWith(i)?u.push({resource:n,type:"full",path:s}):(u.push.apply(u,r(a(r(n.matchAll(new RegExp("(')("+i+"[^']+)'","g"))),function(e){return{resource:e[2],type:e[1],path:s}}))),u.push.apply(u,r(a(r(n.matchAll(new RegExp('(")('+i+'[^"]+)"',"g"))),function(e){return{resource:e[2],type:e[1],path:s}}))));else if(t.isArray(n))for(var l=0;l<n.length;++l)u.push.apply(u,r(e(n[l],i,s+"/"+l)));else if("object"===o(n))for(var c in n)n.hasOwnProperty(c)&&u.push.apply(u,r(e(n[c],i,s+"/"+c)));return u}(e,u(),"")}catch(e){return console.error("Could not extract resources: ",e),[]}},getConfig:function(){return s},getConfigSync:function(){return n}}}(n(77),n(1))},23:function(e,t,n){"use strict";n.r(t),n.d(t,"addYoutubePlayerIFrame",function(){return l}),n.d(t,"resolveYoutubePlaceholdersNew",function(){return d}),n.d(t,"loadYouTubePlayer",function(){return h}),n.d(t,"pollStartVideos",function(){return g}),n.d(t,"playYouTube",function(){return m}),n.d(t,"createHtml5VideoPlayer",function(){return v}),n.d(t,"adjustRichTextVideoSize",function(){return b}),n.d(t,"resolveYoutubePlaceholders",function(){return w});var r=n(35),o=n(8);n.d(t,"isYoutubeUrl",function(){return o.m}),n.d(t,"getVimeoId",function(){return o.e});var i=n(5),a=n(1),s=n.n(a),u=n(24);function l(e,t){var n=s()(e);if("ibw-platform-win32-preview"===i.getPlatform()||"ibw-platform-osx-preview"===i.getPlatform())return n.safeHtml("<br>Youtube videos are not supported in preview mode."),void n.css({"background-color":"black",color:"white","text-weight":"bold","text-align":"center"});var r=Object(u.default)("http://www.youtube.com/embed/")+Object(o.h)(t)+Object(o.i)(t);s()(document.createElement("iframe")).attr({seamless:"",id:"playeriframe",src:r}).appendTo(n)}var c=0;function d(e){e.find(".youtubeplaceholder").each(function(){var e=s()(this);if(void 0===e.attr("id")){var t="YTP_"+c++;e.attr("id",t),l("#"+t,e.attr("src"))}})}var f=!1,p=[];function h(e,t,n){var r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src",Object(u.default)("http://www.youtube.com/player_api")),document.getElementsByTagName("body")[0].appendChild(r)}function g(){if(void 0!==window.YT&&void 0!==window.YT.Player)for(var e=0;e<p.length;++e)p[e]();else setTimeout(g,100)}function m(e,t){var n=s()(e),a=n.attr("id");if(null==a&&(a=Object(r.randomId)(20),n.attr("id",a)),"ibw-platform-win32-preview"===i.getPlatform()||"ibw-platform-osx-preview"===i.getPlatform())return n.safeHtml("<br>Youtube videos are not supported in preview mode."),void n.css({"background-color":"black",color:"white","text-weight":"bold","text-align":"center"});function u(){var n=s()(e),r={rel:0},i=Object(o.g)(t);0!==i&&(r.start=i);var u=Object(o.f)(t);0!==u&&(r.end=u);var l=Object(o.a)(t);null!=l&&(r.cc_lang_pref=l);var c=Object(o.b)(t);null!=c&&(r.cc_load_policy=c);var d=Object(o.h)(t);new window.YT.Player(a,{height:n.height(),width:n.width(),videoId:d,playerVars:r})}void 0!==window.YT&&void 0!==window.YT.Player?u():(p.push(u),f||(f="true",h(),setTimeout(g,100)))}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"video/mp4",o=s()(document.createElement("video")).attr({controls:"",preload:"auto",poster:""});return null!=t&&o.attr("width",t),null!=n&&o.attr("height",n),s()(document.createElement("source")).attr({src:e,type:r}).appendTo(o),o}function b(e){"0px"===e.css("width")&&null==e.css("float")||"none"===e.css("float")?e.css({width:"640px",height:"400px","max-width":"90%"}):e.css({width:"320px",height:"240px"})}function w(e){function t(e,t){var n=t.width(),r=t.height(),o=s()(document.createElement("div")).addClass("videodiv").css({width:n,height:r}).appendTo(t);return s()(document.createElement("iframe")).attr({frameborder:"0",webkitAllowFullScreen:"",mozallowfullscreen:"",allowFullScreen:""}).css({width:n,height:r}).appendTo(o).attr("src",e.trim()),o}e.find(".youtubeplaceholder").each(function(){var e=s()(this);if(void 0===e.attr("id")){var n="YTP_"+c++;e.attr("id",n);var r=e.attr("src");b(e),Object(o.l)(r)?m("#"+n,r):Object(o.k)(r)?function(e,n){t(Object(u.default)("http://player.vimeo.com/video")+"/"+Object(o.e)(e),n).addClass("bw-vimeo-wrapper")}(r,s()("#"+n)):Object(o.j)(r)?function(e,n){t(Object(u.default)("http://giphy.com/embed")+"/"+Object(o.c)(e),n).addClass("bw-giphy-wrapper")}(r,s()("#"+n)):console.error("Unsupported video URL: "+r)}})}},24:function(e,t,n){"use strict";function r(e){var t="file:";window&&window.location&&window.location.protocol&&(t=window.location.protocol);var n="";return 0===e.indexOf("http://")?n="http://":0===e.indexOf("https://")?n="https://":0===e.indexOf("//")&&(n="//"),""!==n?"file:"===t?"//"===n?"http:"+e:e:"http:"===t?"//"===n?"http:"+e:e:"https:"===t&&"http://"===n?e.replace("http://","https://"):"//"===n?"https:"+e:e:e}n.r(t),n.d(t,"default",function(){return r})},25:function(e,t,n){var r,o,i,a,s,u=n(33).loadJS;e.exports=(r=n(22),o=n(5),i=n(1),a=n(42),s={},window.BWMATH=s,s.disabled=!1,s.nextUniqueId=1,s.queue=[],s.customCssClasses=[],s.initialized=!1,s.initialize=function(){if(!1===this.initialized&&-1!==o.getPlatform().indexOf("chrome")){var e=i(document.createElement("div")).attr("id","chromemathjaxhack").css({position:"absolute","pointer-events":"none"}).prependTo(i("body")),t=i(document.createElement("canvas")).attr({width:300,height:300}).appendTo(e)[0];t.getContext("2d").clearRect(0,0,t.width,t.height),this.initialized=!0}},s.prepare=function(e){if(this.disabled)return e;var t="",n=0,r=e.indexOf("$$"),o=0;for(r>=0&&this.initialize();r>=0&&!(++o>1e4);){t+=e.substring(n,r);var i=e.indexOf("$$",r+2);if(i<0){n=r;break}t+='<span class="bwmathquill" style="direction:ltr; visibility: hidden">\\('+e.substring(r+2,i)+"\\)</span>",n=i+2,r=e.indexOf("$$",n)}return t+=e.substring(n)},s._createCssClass=function(e,t){var n=document.createElement("style");n.type="text/css",document.getElementsByTagName("head")[0].appendChild(n),(n.sheet||{}).insertRule?n.sheet.insertRule("."+e+"{"+t+"}",0):(n.styleSheet||n.sheet).addRule(e,t),s.customCssClasses.push(e)},s._copyColorToStrokeAndFill=function(e){var t=e.css("color");e.find("g[stroke]").attr("stroke",null).attr("fill",null);var n="bw-math-jax-expression-"+s.nextUniqueId++,r="stroke: "+t+"; fill: "+t+";";s._createCssClass(n,r),e.addClass(n)},s.schedule=function(e){void 0!==window.MathJax&&window.MathJax.hasOwnProperty("Hub")&&window.MathJax.Hub.hasOwnProperty("Queue")?window.MathJax.Hub.Queue(e):s.queue.push({cb:e})},s.findMathElems=function(e){return e.find(".bwmathquill")},s.allMathElems=function(){return i(".bwmathquill")},s.processMathElems=function(e){var t=this.findMathElems(e);return t.length>0&&(this.process(t),!0)},s.redrawMathElems=function(e){this.redraw(this.findMathElems(e))},s.processAll=function(){this.process(this.allMathElems())},s.redrawAll=function(){this.redraw(this.allMathElems())},s.process=function(e){this.disabled||e.each(function(){if(void 0!==window.MathJax&&window.MathJax.hasOwnProperty("Hub")&&window.MathJax.Hub.hasOwnProperty("Queue")){var e=this;window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,e],function(){s._copyColorToStrokeAndFill(i(e)),i(e).css("visibility","")})}else s.queue.push({obj:i(this)})})},s.processqueue=function(){for(;s.queue.length>0;){var e=s.queue.shift();e.obj&&s.process(e.obj),e.cb&&s.schedule(e.cb)}},window.MathJax={showMathMenu:!1,skipStartupTypeset:!0},"ibw-platform-win32-preview"==o.getPlatform()&&(window.MathJax.SVG={scale:200}),s.loadMathJax=function(){u("external/MathJax24/MathJax.js?config=TeX-AMS-MML_SVG").then(s.processqueue.bind(s))},s.widgetUsesLatex=function(e){return e.hasOwnProperty("modules")&&-1!==e.modules.indexOf("MathJax24")},s.scheduleOrExecuteIfNoLatex=function(e){r.getConfig().then(function(t){s.widgetUsesLatex(t)?s.schedule(e):e()})},r.getConfig().then(function(e){s.widgetUsesLatex(e)?s.loadMathJax():s.disabled=!0}),s.redraw=function(e){},a.CssUpdateCallbacks&&a.CssUpdateCallbacks.push(function(){var e=s.customCssClasses;s.customCssClasses=[];for(var t=0;t<e.length;++t){var n=e[t],r=i("."+n);r.removeClass(n),s._copyColorToStrokeAndFill(r)}}),s.isOnlyMath=function(e){var t=e.trim();return t.startsWith("$$")&&t.endsWith("$$")&&-1===t.substring(2,e.length-4).indexOf("$$")},s)},26:function(e,t){e.exports=function(){var e={0:"debug",1:"info",2:"error"};function t(t,n,r){return n>=r?function(){!function(t,n,r){var o=Array.prototype.slice.call(r);o.unshift(t+" ("+e[n]+"):"),console.log.apply(console,o)}(t,n,arguments)}:function(){}}return{DEBUG:0,INFO:1,ERROR:2,createLogger:function(e,n){return void 0===n&&(n=1),{debug:t(e,0,n),info:t(e,1,n),error:t(e,2,n)}}}}()},28:function(e,t,n){"use strict";n.d(t,"i",function(){return l}),n.d(t,"d",function(){return p}),n.d(t,"c",function(){return h}),n.d(t,"g",function(){return m}),n.d(t,"f",function(){return b}),n.d(t,"b",function(){return _}),n.d(t,"o",function(){return k}),n.d(t,"n",function(){return x}),n.d(t,"l",function(){return I}),n.d(t,"m",function(){return F}),n.d(t,"h",function(){return T}),n.d(t,"e",function(){return B}),n.d(t,"a",function(){return N}),n.d(t,"k",function(){return P}),n.d(t,"j",function(){return R});var r=n(41),o=n.n(r),i=n(6);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var u=new o.a,l=function(e){return!!(e&&e.length>=1)},c=function(e,t){var n=s(e);return n[t]||(n[t]=[]),n},d=function(e,t,n){var r=s(e);return r=function(e,t,n){var r=s(e);return r[n]||(r=c(r,n)),r[n][t]||(r[n]=s(e[n]),r[n][t]={x:t,y:n}),r}(r=c(r,n),t,n)},f=function(e,t){return"V"===e.dir?{x:parseInt(e.x),y:parseInt(e.y)+t}:{x:parseInt(e.x)+t,y:parseInt(e.y)}},p=function(e){var t=[],n={H:[],V:[]},r=1;return e&&e.forEach(function(e,o){var i={direction:e.dir,coords:[],description:e.description,id:o},a=g(t,parseInt(e.x),parseInt(e.y));a&&a.number?i.number=a.number:(t=d(t,parseInt(e.x),parseInt(e.y)),(a=g(t,parseInt(e.x),parseInt(e.y)))&&(a.number=r,t=y(t,parseInt(e.x),parseInt(e.y),a)),i.number=r,r++),u.splitGraphemes(e.word).forEach(function(n,r){var o=f(e,r);t=d(t,o.x,o.y),i.coords.push(o)}),t=E(t,parseInt(e.x),parseInt(e.y),"firstOfWord",!0),n[e.dir].push(i)}),{wordlist:n,crosswordArray:t}},h=function(e){var t=[];return e&&e.forEach(function(e){u.splitGraphemes(e.word).forEach(function(n,r){var o=f(e,r);t=d(t,o.x,o.y),t=E(t,o.x,o.y,"letter",n)})}),t},g=function(e,t,n){return e[n]?Object.assign({},e[n][t]):void 0},m=function(e){if(e)return[].concat(s(e.V?e.V:[]),s(e.H?e.H:[])).find(function(e){return e.selected})},v=function(e,t){return function(e){return u.splitGraphemes(e.word).map(function(t,n){return f(e,n)})}(t).map(function(t){return g(e,t.x,t.y)})},b=function(e,t){return v(e,t).map(function(e){return(null==e?void 0:e.letter)||" "}).join("")},w=function(e,t){return function(e){return e?e.map(function(e,t){var n={direction:e.dir,coords:[],description:e.description,id:t};return u.splitGraphemes(e.word).forEach(function(t,r){var o=f(e,r);n.coords.push(o)}),n}):[]}(t).filter(function(t){return!t.coords.some(function(t){var n=g(e,t.x,t.y);return void 0===(null==n?void 0:n.letter)||""===n.letter})})},y=function(e,t,n,r){var o=s(e);return o[n]&&o[n][t]||(o=d(o,t,n)),o[n][t]=r,o},C=function(e,t){var n=Object.assign({},e);return Object.keys(e).forEach(function(r){e[r].forEach(function(e){n=function(e,t,n){var r=s(e[t.direction]);return r=r.map(function(e){if(e&&e.id===t.id){var r=Object.assign({},t);return delete r[n],r}return e}),Object.assign(Object.assign({},e),a({},t.direction,r))}(n,e,t)})}),n},D=function(e,t,n,r){var o=s(e[t.direction]);return o=o.map(function(e){return e&&e.id===t.id?Object.assign(Object.assign({},e),a({},n,r)):e}),Object.assign(Object.assign({},e),a({},t.direction,o))},A=function(e,t){var n=s(e);return e.forEach(function(r){r.forEach(function(r){r&&r[t]&&(n=function(e,t,n,r){var o=s(e);if(o[n]&&o[n][t]){var i=Object.assign({},o[n][t]);delete i[r],o[n][t]=i}return o}(e,r.x,r.y,t))})}),n},E=function(e,t,n,r,o){var i=s(e);return i[n]&&i[n][t]?i[n][t][r]=o:(i=d(i,t,n))[n][t][r]=o,i},_=function(e,t){var n=C(e,"selected");n=C(n,"unclear");var r=A(t,"selected");return r=A(r,"unclear"),{wordlist:n,crosswordArray:r=A(r,"hasInput")}},S=function(e,t,n){var r=s(e);return t.coords.forEach(function(e){r=E(r,e.x,e.y,n,!0)}),r},k=function(e,t,n){var r=_(e,t),o=r.wordlist,i=r.crosswordArray;return o=D(o,n,"selected",!0),i=S(i,n,"selected"),O(o,i,n)},x=function(e,t,n){var r=_(e,t),o=r.wordlist,i=r.crosswordArray,a=function(e,t){return[].concat(s(e.H),s(e.V)).filter(function(e){return e.coords.filter(function(e){return e.x===t.x&&e.y===t.y}).length>0})}(e,n);return 1===a.length?(o=D(o,a[0],"selected",!0),i=S(i,a[0],"selected"),O(o,t,a[0])):(a.length>1&&a.forEach(function(e){o=D(o,e,"unclear",!0),o=D(o,e,"selected",!0),i=S(i,e,"unclear")}),{wordlist:o,crosswordArray:i})},O=function(e,t,n){var r=A(s(t),"hasInput"),o=C(Object.assign({},e),"inputIndex"),i=n.coords[0];return r=E(r,i.x,i.y,"hasInput",!0),o=D(o,n,"selected",!0),{wordlist:o=D(o,n,"inputIndex",0),crosswordArray:r}},I=function(e,t){var n=m(e),r=s(t),o=Object.assign({},e);if(n&&n.selected&&void 0!==n.inputIndex){var i=n.inputIndex,a=n.coords[i+1];a&&(o=C(Object.assign({},o),"inputIndex"),r=A(s(r),"hasInput"),r=E(r,a.x,a.y,"hasInput",!0),o=D(o,n,"inputIndex",i+1)),i+1===n.coords.length&&(o=D(o,n,"inputIndex",i+1))}return{wordlist:o,crosswordArray:r}},F=function(e,t,n){var r=m(e),o=s(t),i=Object.assign({},e);if(r&&r.selected&&void 0!==r.inputIndex&&r.inputIndex<r.coords.length&&1===n.length){var a=r.coords[r.inputIndex];o=E(o,a.x,a.y,"letter",n)}return{wordlist:i,crosswordArray:o}},T=function(e,t){var n=function(e,t){var n=m(e),r=s(t),o=Object.assign({},e);if(n&&n.selected&&void 0!==n.inputIndex){var i=n.inputIndex;if(i>0){var a=n.coords[i-1];a&&(o=C(Object.assign({},o),"inputIndex"),r=A(s(r),"hasInput"),r=E(r,a.x,a.y,"hasInput",!0),o=D(o,n,"inputIndex",i-1))}}return{wordlist:o,crosswordArray:r}}(e,t),r=n.wordlist,o=n.crosswordArray,i=m(r);if(i&&i.selected&&void 0!==i.inputIndex){var a=i.coords[i.inputIndex];o=E(o,a.x,a.y,"letter",void 0)}return{wordlist:r,crosswordArray:o}},B=function(e){return e.map(function(e){return e.filter(function(e){return e}).map(function(e){return{x:e.x,y:e.y,letter:e.letter}}).filter(function(e){return void 0!==e.letter&&null!=e.letter})}).filter(function(e){return e}).reduce(function(e,t){return e.concat(t)})},N=function(e,t){return!e.some(function(e){var n;return void 0===(null===(n=g(t,e.x,e.y))||void 0===n?void 0:n.x)})},P=function(e,t){var n=s(e);return t.forEach(function(e){e.letter&&(n=E(n,e.x,e.y,"letter",e.letter))}),n},R=function(e,t,n){var r=h(t),o=e.map(function(e){return e?e.map(function(e){var t=Object.assign({},e);if(e&&(e.x||0===e.x)&&(e.y||0===e.y)){var o=g(r,e.x,e.y),a=Object(i.matchesOneOfAnswers)(e.letter,null==o?void 0:o.letter,n);t.isCorrect=a}return t}):e});return w(e,t).forEach(function(e){e.coords.forEach(function(e){o=E(o,e.x,e.y,"isCompleteWord",!0)})}),o}},30:function(e,t,n){"use strict";n.r(t),n.d(t,"process",function(){return c}),n.d(t,"isEmptyRichText",function(){return d});var r=n(49),o=n(50),i=n(1),a=n.n(i),s=n(44),u=(n(81),n(23)),l=n(4);function c(e){e.addClass("bw-richtext"),r.processRichTextImages(e),o.processRichTextWidgetPlayLinks(e,!0),function(e){e.find("video").each(function(){Object(u.adjustRichTextVideoSize)(a()(this))})}(e),function(e){e.find("a.rtlink").each(function(){var e=a()(this),t=e.attr("target");!1!==t&&void 0!==t||e.attr("target","_top")})}(e),function(e){e.find(".iframeplaceholder").each(function(){var e=a()(this),t=e.attr("src");e.replaceWith(a()(document.createElement("iframe")).addClass("rt-iframe").attr("src",t))})}(e),Object(s.processEmbeddedIframes)(e.find(".rt-iframe")),function(e){e.find("table").addClass("bw-richtext-table").each(function(){var e=this.parentNode,t=document.createElement("div");t.style.overflowX="scroll",e.insertBefore(t,this),t.appendChild(this)})}(e)}function d(e){return null==e||(""===e.trim()||-1===e.indexOf("img")&&-1===e.indexOf("audio")&&-1===e.indexOf("iframe")&&-1===e.indexOf("video")&&-1===e.indexOf("src=")&&""===Object(l.appSafeUnescape)(e).trim())}},31:function(e,t,n){e.exports={DialogWrapper:"_1REoWBm7O1Lv3dqYWAojMJ",Dialog:"_2dLXcKIj7-JZALkC3G3xB6",DialogBody:"_1yB6efsB9CUVFYsupNL_CE",DialogCloseButton:"_3LHyUPySjNQLuoBOX9mQae"}},32:function(e,t,n){n(82);var r,o,i,a=n(33),s=a.loadJS,u=a.loadCSS;e.exports=(r=n(22),o=n(1),i={},window.BWAUDIO=i,i.loaded=!1,i.queue=[],i.elementqueue=[],i.process=function(e){!0===i.loaded?0===e.find(".mejs-container.mejs-audio").length&&e.mediaelementplayer({enableKeyboard:!1}):i.queue.push(e)},i.createElement=function(e){var t={play:function(e){if(void 0===this.element)return!1;var t;try{return e&&(t=this.element,this.element.addEventListener("playing",function n(){t.removeEventListener("playing",n),e()})),this.element.play()}catch(e){return null}},pause:function(){if(void 0===this.element)return!1;try{return this.element.pause(),!0}catch(e){return!1}},paused:function(){return void 0!==this.element&&this.element.paused},toggle:function(){void 0!==this.paused()&&!0===this.paused()?this.play():this.pause()},rewind:function(){if(void 0===this.element)return!1;try{return this.element.setCurrentTime(0),!0}catch(e){return!1}},setVolume:function(e){if(void 0===this.element)return!1;try{return this.element.setVolume(e),!0}catch(e){return!1}},on:function(e,t){if(void 0===this.element)return!1;try{return this.element.addEventListener(e,t),!0}catch(e){return!1}},onLoaded:function(e){this.element?e():this.onLoadedCB=e}};return t.obj=e,!0===i.loaded?t.element=new window.MediaElement(e,{startVolume:1}):i.elementqueue.push(t),t},i.createPlayer=function(e,t){if(t){var n=o(document.createElement("div")).addClass("audiowrapper");return o(document.createElement("div")).addClass("audio-placeholder").attr("data-src",e).appendTo(n),n}n=o(document.createElement("div")).addClass("audiowrapper");var r=o(document.createElement("audio")).attr("controls","").append(o(document.createElement("source")).attr("src",e)).appendTo(n);return i.process(r),n},i.replaceAudioByPlaceholder=function(e){var t=this;o(e).find(":not(.audiowrapper) > audio:not(.no-audio-wrap)").each(function(){var e=o(this),n=e.find("source").attr("src");e.replaceWith(t.createPlayer(n,!0))})},i.processAudioTags=function(e){e instanceof o?i.process(e.find(":not(.mejs-mediaelement) > audio:not(.no-audio-wrap)")):i.process(o(e+" audio"))},i.replacePlaceholders=function(e){o(e).find("div.audio-placeholder").each(function(){var e=o(document.createElement("audio")).attr("controls","").append(o(document.createElement("source")).attr("src",o(this).attr("data-src"))).insertAfter(o(this));i.process(e)})},i.removeAudioElements=function(){o("audio:not(.no-audio-wrap), .mejs-container.mejs-audio").remove()},i.processqueue=function(){for(i.loaded=!0;i.queue.length>0;){var e=i.queue.shift();i.process(e)}for(;i.elementqueue.length>0;){var t=i.elementqueue.shift();t.element=new window.MediaElement(t.obj,{startVolume:1}),t.onLoadedCB&&t.onLoadedCB(t)}},i.loadMediaElement=function(){u("external/mediaelement/css/mediaelementplayer.min.css"),s("external/mediaelement/js/mediaelement-and-player.min.js").then(i.processqueue.bind(i))},i.addElement=function(e,t){var n=o(document.createElement("audio")).append(o(document.createElement("source")).attr("src",e)).appendTo(t);return i.createElement(n[0])},r.getConfig().then(function(e){e.hasOwnProperty("modules")&&-1!==e.modules.indexOf("bwaudio")&&i.loadMediaElement()}),i)},33:function(e,t,n){"use strict";n.r(t),n.d(t,"adaptWidgetLoadPath",function(){return s}),n.d(t,"loadJS",function(){return u}),n.d(t,"loadCSS",function(){return l});var r=n(1),o=n.n(r),i=n(5);function a(e){if(window.WidgetParams){if(e&&window.WidgetParams.externalRootURL)return window.WidgetParams.externalRootURL;if(window.WidgetParams.rootURL)return window.WidgetParams.rootURL}return Object(i.isWebPreview)()||window.location.protocol.startsWith("http")&&null!=window.bwshortcode?window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/",window.location.pathname.lastIndexOf("/")-1)):window.location.protocol.startsWith("http")&&null==window.bwshortcode?window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")):""}function s(e,t){return e.startsWith("../")?a(t)+e.substring(2):e.startsWith("http://")||e.startsWith("https://")?e:window.WidgetParams&&window.WidgetParams.rootURL?a(t)+"/"+e:e}function u(e,t,n){e=s(e);var r=o.a.Deferred(),i=document.createElement("script");if(i.setAttribute("type","text/javascript"),n)for(var a in n)n.hasOwnProperty(a)&&i.setAttribute(a,n[a]);return i.onload=function(){r.resolve()},i.onerror=function(){window.navigator&&window.navigator.userAgent&&-1===window.navigator.userAgent.indexOf("PhantomJS")&&-1===window.navigator.userAgent.indexOf("HeadlessChrome")&&console.error("Could not load: "+e),r.reject()},i.setAttribute("src",e),document.getElementsByTagName(t||"head")[0].appendChild(i),r}function l(e,t){e=s(e);var n=o.a.Deferred(),r=document.createElement("link");return r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.onload=function(){n.resolve(r)},r.onerror=function(){window.navigator&&window.navigator.userAgent&&-1===window.navigator.userAgent.indexOf("PhantomJS")&&-1===window.navigator.userAgent.indexOf("HeadlessChrome")&&console.error("Could not load: "+e),n.reject()},r.setAttribute("href",e),document.getElementsByTagName(t||"head")[0].appendChild(r),n}window.adaptWidgetLoadPath=s},34:function(e,t,n){"use strict";n.r(t),n.d(t,"isRTL",function(){return o}),n.d(t,"setAutoDirection",function(){return i}),n.d(t,"isRtlOrRtlMixed",function(){return a}),n.d(t,"isUseMixedTextDirection",function(){return s}),n.d(t,"setAutoDirectionIfRequired",function(){return u});var r=n(4);function o(e){for(var t=[],n=new RegExp("^[----------]|\ud802[\udf60-\udf7e]+$"),r=1,o=0;o<=r;o++)if(t[o]=e.substring(o-1,o),/\s/.test(t[o])&&r++,n.test(t[o]))return!0;return!1}function i(e,t,n){null==t?t=e.text():n&&(t=Object(r.appSafeUnescape)(t)),t.length>0?o(t)?e.css("direction","rtl"):e.css("direction","ltr"):console.log("setAutoDirection: no text")}function a(e){return null!=e&&e.startsWith("right-to-left")}function s(e){return null!=e&&e.endsWith("mixed")}function u(e,t,n,r){s(t)&&i(e,n,r)}},35:function(e,t,n){"use strict";n.r(t),n.d(t,"createRandomSeed",function(){return r}),n.d(t,"shuffleArray",function(){return i}),n.d(t,"randomIndexList",function(){return a}),n.d(t,"randomId",function(){return u}),Math.imul||(Math.imul=function(e,t){var n=(4194303&e)*(t|=0);return 4290772992
/*!== 0*/&e&&(n+=(4290772992&e)*t|0),0|n});var r=function(e){for(var t=1779033703^e.length,n=0;n<e.length;n++)t=(t=Math.imul(t^e.charCodeAt(n),3432918353))<<13|t>>>19;return function(){return t=Math.imul(t^t>>>16,2246822507),t=Math.imul(t^t>>>13,3266489909),(t^=t>>>16)>>>0}}((new Date).toLocaleString()+Math.random());function o(e){return e=e||r(),t=e,function(){var e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296};var t}function i(e,t){var n=o(t);return e.sort(function(){return.5-n()})}function a(e,t){for(var n=[],r=0;r<e;++r)n.push(r);return i(n,t)}var s={};function u(e){for(;;){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_-",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));if(!s.hasOwnProperty(t))return s[t]=!0,t}}},37:function(e,t,n){"use strict";n.d(t,"a",function(){return v});var r=n(0),o=n.n(r),i=n(1),a=n.n(i),s=n(30),u=n(34),l=n(25),c=n(23),d=n(32);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),h(this,g(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,o.a.PureComponent),n=t,(r=[{key:"setWrapperDivRef",value:function(e){if(null!=e){var t=a()(e);t.safeHtml(l.prepare(this.props.text)),c.resolveYoutubePlaceholders(t),s.process(t),l.processMathElems(t),d.processAudioTags(t),this.props.direction&&Object(u.setAutoDirectionIfRequired)(this.props.directionSelector?t.find(this.props.directionSelector):t,this.props.direction)}}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.onClick,r=e.style;return o.a.createElement("div",{className:t,onClick:n,style:r,ref:this.setWrapperDivRef.bind(this)})}}])&&p(n.prototype,r),i&&p(n,i),t}()},39:function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return d});var r=n(0),o=n.n(r),i=n(12),a=n.n(i),s=n(7),u=n(31),l=n.n(u);function c(e){var t=e.title,n=e.children,r=e.OK,i=e.onOk,u=e.Cancel,c=e.onCancel,d=e.onClose,f=e.className;return o.a.createElement("div",{className:a()("bw-centered bw-row-container ui-dialog ui-widget ui-widget-content ui-corner-all bw-dialog",l.a.Dialog,f)},o.a.createElement("div",{className:"bw-row-fixed ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"},o.a.createElement("span",{className:"i-dialog-title",id:"ui-dialog-title-1"},t)),d&&o.a.createElement("button",{className:l.a.DialogCloseButton,onClick:d,"aria-label":Object(s.b)("Cancel")},""),o.a.createElement("div",{className:a()("bw-row-expanding ui-dialog-content ui-widget-content",l.a.DialogBody)},n),o.a.createElement("div",{className:"bw-row-fixed ui-dialog-buttonpane"},o.a.createElement("div",{className:"ui-dialog-buttonset"},c&&o.a.createElement("button",{className:"ui-button ui-widget ui-state-default ui-button-text-only",onClick:c},o.a.createElement("span",{className:"ui-button-text"},u)),o.a.createElement("button",{className:"ui-button ui-widget ui-state-default ui-button-text-only",onClick:i},o.a.createElement("span",{className:"ui-button-text"},r||Object(s.b)("OK"))))))}function d(e){var t=e.children;return o.a.createElement("div",{className:a()("bw-centering-container",l.a.DialogWrapper)},t)}},4:function(e,t,n){"use strict";n.r(t),n.d(t,"MATCH_TYPE_WORD",function(){return d}),n.d(t,"MATCH_TYPE_PIC",function(){return f}),n.d(t,"MATCH_TYPE_AUDIO",function(){return p}),n.d(t,"isDefined",function(){return h}),n.d(t,"safeArray",function(){return g}),n.d(t,"safeString",function(){return m}),n.d(t,"appSafeUnescape",function(){return v}),n.d(t,"arrayContains",function(){return b}),n.d(t,"removeNonNumbers",function(){return w}),n.d(t,"isMatchDistractor",function(){return y}),n.d(t,"matchElemId",function(){return C}),n.d(t,"questionTableSplitRow",function(){return D}),n.d(t,"questionTableRowQuestion",function(){return A}),n.d(t,"questionTableRowAnswer",function(){return E}),n.d(t,"questionTableRowAnswers",function(){return _}),n.d(t,"numericGetMatrixElem",function(){return S}),n.d(t,"BCE_YES_LABEL",function(){return k}),n.d(t,"BCE_NO_LABEL",function(){return x}),n.d(t,"bceBalancedLabelToYesNo",function(){return O}),n.d(t,"bceCreateTableData",function(){return I}),n.d(t,"bceReactantsEditableFields",function(){return F}),n.d(t,"bceProductsEditableFields",function(){return T}),n.d(t,"bceFormatQuestion",function(){return N}),n.d(t,"getDateString",function(){return P});var r=n(66),o=n.n(r),i=n(27),a=n.n(i),s=n(13),u=n(9),l=n(1),c=n.n(l),d=0,f=1,p=2;function h(e){return null!=e&&((!a()(e)||""!==e.trim())&&(o()(e)&&console.log("isDefined returns true for ",e),!0))}function g(e){return null==e?[]:e}function m(e){return null==e?"":e}function v(e){return c()(document.createElement("div")).safeHtml(e).text()}function b(e,t){return-1!==e.indexOf(t)}function w(e){return e.replace(/\D/g," ")}function y(e,t){return t===f?null==e.sources||0===e.sources.length:""===e}function C(e,t,n){return e===d?t:e===f?Object(s.pictureId)(t):e===p?n+"":(console.error("Invalid element type: ",e),0)}function D(e,t){return e.rows[t].split(/##/)}function A(e,t){return D(e,t)[0].trim()}function E(e,t){var n=D(e,t);return n.length>1?n[1].trim():null}function _(e,t){for(var n=D(e,t),r=[],o=1;o<n.length;++o)r.push(n[o].trim());return r}function S(e,t,n){if(null==e)return null;if(e.length<=t)return null;var r=e[t].split(" ");return r.length<=n?null:r[n]}var k="Yes, this equation is balanced",x="No, this equation is not balanced";function O(e,t){return null==e||""===e?"":"yes"===e||"no"===e?e:e===(t=t||function(e){return e})(k)?"yes":"no"}function I(e,t){var n,r=[];switch(t){case"none":break;case"all":r=function(e,t){for(var n=[],r=e;r<=t;r++)n.push(r);return n}(0,e.length-1);break;case"odd":for(n=1;n<e.length;n+=2)r.push(n);break;case"even":for(n=0;n<e.length;n+=2)r.push(n)}var o={values:[],layout:{rows:[],columns:[{width:100},{width:100}]},answers:[]};for(n=0;n<e.length;++n){var i="readonly",a=""+e[n].qty;r.length>0&&n===r[0]&&(i="checked",r.shift()),o.values.push([{value:e[n].atom,CellRole:"readonly"},{value:a,CellRole:i}]),o.layout.rows.push({height:30}),o.answers.push(""+e[n].qty)}return o}function F(e){return"type1"===e?"none":"odd"}function T(e){return"type1"===e?"all":"even"}function B(e,t,n){for(var r=[],o=0;o<e.length;++o)n?r.push("<span class='nowrap'>_____ $$"+e[o].formula+"$$</span>"):t?r.push("<span class='nowrap bce-field empty'><input type='text' /> $$"+e[o].formula+"$$</span>"):r.push("<span class='nowrap'>$$"+e[o]+"$$</span>");return r}function N(e,t){var n=u.parseEquation(e.Equation),r="type3"===e.SubType,o=u.formatEquation(n,r||t),i="";return i+=B(o.reactants,r,t).join("$$\\, + \\,$$"),i+=" <span class='nowrap'>$$\\: \\rightarrow \\:$$</span> ",i+=B(o.products,r,t).join("$$\\, + \\,$$")}function P(){var e=new Date,t=e.getDate(),n=e.getMonth()+1,r=e.getYear();return r<1900&&(r+=1900),(1===n?"January":2===n?"February":3===n?"March":4===n?"April":5===n?"May":6===n?"June":7===n?"July":8===n?"August":9===n?"September":10===n?"October":11===n?"November":"December")+" "+t+", "+r}},40:function(e,t,n){var r=n(14).isEmpty,o=n(47).valueOrCacheValue,i=n(80),a=i.instructionsAreEmpty,s=i.prepareInfoPopup,u=i.showInfoPopupIfFirstTimeInSession;e.exports=function(e,t,n,i,l,c,d,f,p,h,g,m){function v(e){if(-1===e.indexOf("?"))return e;var t=/^([^?]*)\?/.exec(e);if(t&&2===t.length)return t[1];throw Error("Shoudln't happen")}function b(e,t){if(r(t))return e;var n=v(e),o=[];return d.each(t,function(e,t){o.push(e+"="+t)}),n+"?"+o.join("&")}function w(){var e=t.getUrlParams(window.location.href);return{backlink:e.hasOwnProperty("backlink")?o(e.backlink):null,backbutton:e.hasOwnProperty("backbutton")?o(e.backbutton):null}}function y(){var t=w().backlink,n=e.getPlatform();if("ibw-platform-osx-preview"===n||"ibw-platform-win32-preview"===n)console.log("Moving back by using history.back()"),window.history.back();else{var r=window.location.origin;t.startsWith(r)&&(t=t.substr(r.length)),console.log("Moving back by setting window.location to: "+t),window.location=t}}function C(){var e=w(),t=e.backlink,n=e.backbutton;null!=t&&(null!=n?d(document.createElement("div")).addClass("widget-backlink widget-backlink-text").safeHtml("&#9664; ").text(n).appendTo(d("body")):d(document.createElement("div")).addClass("widget-backlink widget-backlink-icon").appendTo(d("body"))).click(y)}var D=!1;function A(e){if(!D){var t=d("#top-container"),n=t.height(),r=t.width(),o=d(".closebutton-container"),i=d("#top-container .bw-toolbar");o.css("min-width",""),i.css("min-width","");var a=o.width(),s=i.width();if(i.css("min-width",a),o.css("min-width",s),d(".title-container").css("max-width",r-2*Math.max(a,s)),!0!==e&&d("#top-container").height()!==n){D=!0;try{window.onresize&&window.onresize()}catch(e){console.error("Error when calling onResize during centerWidgetTitle"),console.error(e)}D=!1}}}function E(){d("#top-container").removeClass("bw-show-popup-menu"),d("#title-toolbar").appendTo(d("#top-container .bw-toolbar")),d(".bw-menu-overlay").remove()}function _(){if(!(d("#menubutton").length>0)){var e=d("#top-container .bw-toolbar");if(e.children(":not(.outside-popup)").length>1){e.removeClass("bw-toolbar");var t=d(document.createElement("div")).addClass("bw-toolbar").appendTo(d(".titlebar-layout"));e.find(".outside-popup").each(function(){d(this).appendTo(t)}),e.appendTo(t).addClass("bw-button-group"),d(document.createElement("div")).attr("id","menubutton").addClass("bw-toolbutton").append(d(document.createElement("div")).addClass("bw-icon bw-icon-menu")).makeButton(c("Menu")).tapOrClick(function(){d("#top-container").hasClass("bw-show-popup-menu")?E():setTimeout(function(){d("#top-container").addClass("bw-show-popup-menu");var e=d(document.createElement("div")).addClass("bw-menu-overlay").appendTo("#container");setTimeout(function(){e.on("click touchend",function(){setTimeout(E,500)})},350),d("#title-toolbar").appendTo(e)},100)}).appendTo(t)}}}function S(e,t,n){var r=d(e),o=d(document.createElement("div")).attr("id","container").prependTo(r).addClass("top-bottom-layout"),i=d(document.createElement("div")).attr("id","top-container").appendTo(o).addClass("top-container"),a=d(document.createElement("div")).appendTo(i).addClass("titlebar-layout");return d(document.createElement("div")).addClass("closebutton-container").appendTo(a),d(document.createElement("div")).addClass("title-container").append(d(document.createElement("span")).attr("id","title")).appendTo(a),n?d(n).addClass("bw-toolbar").appendTo(a):d(document.createElement("div")).attr("id","title-toolbar").addClass("bw-toolbar").appendTo(a),_(),d(t).appendTo(o).addClass("bottom-container"),A(),o}function k(){var t=d(document.createElement("div")).addClass("bw-debug-window bw-row-container").appendTo("body"),n=d(document.createElement("div")).addClass("bw-debug-output bw-row-resizing").appendTo(t);function r(e){e.appendTo(n),n[0].scrollTop=n[0].scrollHeight-n[0].getBoundingClientRect().height}function o(e){for(var t=[],n=0;n<e.length;++n)t.push(JSON.stringify(e[n]));return t.join(" ")}d(document.createElement("div")).addClass("bw-debug-close").text("X").tapOrClick(function(){t.remove(),localStorage.removeItem("bw-debug-enabled")}).appendTo(t),console.log=function(){r(d(document.createElement("p")).safeHtml(o(arguments)))},console.error=function(e,t){r(d(document.createElement("p")).css("color","red").safeHtml(o(arguments)))},window.onerror=function(e,t,n){return r(d(document.createElement("p")).attr("style","color: red").safeHtml(e+" ("+t+":"+n+")")),!0},console.log(e.getPlatform(),navigator.platform,navigator.userAgent,window.innerWidth,window.innerHeight);var i=d(document.createElement("input")).addClass("bw-debug-input bw-row-fixed").appendTo(t),a=[],s=0;i.keypress(function(e){var t,n;13===(e.keyCode?e.keyCode:e.which)&&(t=i.val(),n=t.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"'),console.log((0,eval)(n)),a.push(n),s=a.length,i.val(""))}),i.keydown(function(e){var t=e.keyCode?e.keyCode:e.which;38===t?s>0&&(--s,i.val(a[s])):40===t&&s<a.length&&(++s===a.length?i.val(""):i.val(a[s]))});try{t.draggable()}catch(e){console.error("No drag support")}}function x(e){var t=0;e.clickOrHold(function(){t=0},function(){3==++t&&(function(){if(!(d(".bw-debug-window").length>0)){var e=d(document.createElement("div")).addClass("bw-debug-wrapper").appendTo("body"),t=d(document.createElement("div")).addClass("bw-debug-dialog").appendTo(e);d(document.createElement("p")).text("Enter your support key:").appendTo(t);var n=d(document.createElement("input")).attr("placeholder","key").appendTo(t);d(document.createElement("br")).appendTo(t),d(document.createElement("button")).attr("type","button").text("Cancel").tapOrClick(function(){e.remove()}).appendTo(t),d(document.createElement("button")).attr("type","button").text("OK").tapOrClick(function(){"bw-magic"===n.val()&&(k(),e.remove(),localStorage.setItem("bw-debug-enabled","true"))}).appendTo(t)}}(),t=0)},2e3);try{"true"===localStorage.getItem("bw-debug-enabled")&&k()}catch(e){}}return d(function(){var t=e.getPlatform(),n=d("html");n.hasClass("ibw-platform-custom")||n.addClass(t)}),window.custom_alert=l.showAlert,window.criticalAlert=l.showCriticalAlert,window.bw_confirmation_dialog=l.showConfirmationDialog,window.tr=c,window.getUrlParams=t.getUrlParams,window.getNakedURL=v,window.setQueryParameters=b,window.createLabeledCheckbox=f.createLabeledCheckbox,window.createProgressBar=f.createProgressBar,window.createSimpleCheckbox=f.createSimpleCheckbox,window.createNumberButtons=f.createNumberButtons,window.createSimpleRadiobutton=f.createSimpleRadiobutton,window.createLabeledRadiobutton=f.createLabeledRadiobutton,window.createProgressCircle=f.createProgressCircle,window.URIEncodeImage=p,window.BWAdaptToPageProtocol=g,window.updateConfigCSS=h.updateConfigCSS,{makeWidget:function(t){t=t||{},function(){if("ibw-platform-osx-ibooks"===e.getPlatform()){var t=["html.ibw-platform-osx-ibooks, .ibw-platform-osx-ibooks .bw-popup-zoomable-image {","width: "+window.innerWidth+"px;","height: "+window.innerHeight+"px;","}"],n=document.createElement("style");n.id="osx_ibooks_workaround",n.type="text/css",n.appendChild(document.createTextNode(t.join("\n"))),document.head.appendChild(n)}}(),s(t.instructions),a(t.instructions)||"title_layout"!==t.layout||(t.layout="title_toolbar_layout");var n=d("body");n.addClass("bw"),t.hasOwnProperty("no-user-select")&&!0===t["no-user-select"]&&n.addClass("no-user-select");var r,o=t.layout||"";if("title_layout"===o?(r=S("body","#bottom-container")).find(".top-container").addClass("title-only"):"title_overlay_layout"===o?((r=S("body","#bottom-container")).addClass("title-overlay"),r.find(".top-container").addClass("title-only")):r="title_toolbar_layout"===o?S("body","#bottom-container","#title-toolbar"):d("#container"),t.hasOwnProperty("title")&&""!==t.title){var i=r.find("#title");i.safeHtml(t.title),x(i)}else{var l=r.find(".top-container");l.addClass("title-empty"),x(l)}"ibw-platform-ipad-ibooks-epub"===e.getPlatform()&&(t.hasOwnProperty("epubBlockTouchEndCheck")||(t.epubBlockTouchEndCheck=function(e){return e.srcElement instanceof SVGElement||d(e.srcElement).hasClass("epub-block")}),document.addEventListener("touchend",function(e){var n=d(window).width();(e.layerX<50||n-e.layerX<50||t.epubBlockTouchEndCheck(e))&&e.preventDefault()},!1),t.hasOwnProperty("epubBlockTouchStartCheck")&&document.addEventListener("touchstart",function(e){t.epubBlockTouchStartCheck(e)&&e.preventDefault()},!1)),C(),u(t.instructions,t.uuid)},getNakedURL:v,setQueryParameters:b,prependToTitleToolbar:function(e){var t=d("#title-toolbar");e.prependTo(t),_(),A()},centerTitle:A,getBacklinkInfo:w,moveBackToPreviousWidget:y,ShowBacklinkIfRequired:C}}(n(5),n(16),n(83),n(67),n(21),n(17),n(1),n(55),n(57),n(42),n(24).default,n(71))},42:function(e,t){e.exports=function(){var e=[];function t(){for(var t=0;t<e.length;++t)e[t]()}return{executeCssUpdateCallbacks:t,CssUpdateCallbacks:e,updateConfigCSS:function(e){for(var n=document.getElementsByTagName("link"),r=0,o=n.length;r<o;r++){var i=n[r],a=i.rel;if("string"!=typeof a||0===a.length||"stylesheet"===a){var s=i.getAttribute("href");0===s.indexOf("config")&&-1!==s.indexOf(".css")&&(i.setAttribute("href","config"+e+".css"),setTimeout(t,100))}}},addAllDesignInfo:function(){void 0!==window.addAllDesignInfo&&window.addAllDesignInfo()},addCSSUpdateCallback:function(t){e.push(t)}}}()},44:function(e,t,n){"use strict";n.r(t),n.d(t,"processEmbeddedIframes",function(){return d}),n.d(t,"hasIframeConfiguration",function(){return f}),n.d(t,"createIframe",function(){return p});var r=n(23),o=n(1),i=n.n(o),a=n(24),s=n(4),u=n(52);function l(e){var t=["allow-downloads","allow-forms","allow-modals","allow-pointer-lock","allow-popups","allow-popups-to-escape-sandbox","allow-same-origin","allow-scripts","allow-top-navigation-by-user-activation"];null!=document.hasStorageAccess&&t.push("allow-storage-access-by-user-activation");try{e.attr({allow:"microphone; camera",sandbox:t.join(" ")})}catch(e){console.log()}}function c(e){e.attr("src").toLowerCase().endsWith("mp4")?function(e){e.replaceWith(r.createHtml5VideoPlayer(e.attr("src")))}(e):(l(e),e.attr("src",e.attr("src")))}function d(e){e.each(function(){c(i()(this))})}function f(e){return null!=e.url&&""!==e.url&&"I have a URL"===e.linktype||null!=e.iframe_embed_code&&""!==e.iframe_embed_code&&"I have an iframe embed code"===e.linktype}function p(e,t){var n;if(null==(n="I have a URL"===e.linktype?e.url:Object(u.default)(Object(s.appSafeUnescape)(e.iframe_embed_code)))||""===n)return null;var r={};null!=e.width&&""!==e.width&&(r.width=e.width),null!=e.height&&""!==e.height&&(r.height=e.height);var o=i()(document.createElement("iframe")).attr(r).appendTo(t);return l(o),o.safeAttr("src",Object(a.default)(n)),d(o),o}},45:function(e,t,n){var r,o,i;e.exports=(r=n(16),o=r.getParameters(),i=!!o.lti_authenticated,{isLTI:function(){return!!o.lti||!!o.lti_version},isEmbeddedLTI:function(){return!!o.lti_version},isEmbeddedLTIAuthenticated:function(){return i},setEmbeddedLTIAuthenticated:function(){i=!0,null==window.WidgetParams&&r.updateWindowQueryParameter("lti_authenticated","1")}})},46:function(e,t){e.exports={BWDS_ERROR_INTERNAL:0,BWDS_ERROR_UNKNOWN:1,BWDS_ERROR_UNAVAILABLE:2,BWDS_ERROR_WRONG_ATTRIB:3,BWDS_ERROR_FULL:4,BWDS_ERROR_SECURITY:5}},47:function(e,t,n){"use strict";n.r(t),n.d(t,"replaceParamsBySessionLink",function(){return a}),n.d(t,"valueOrCacheValue",function(){return s});var r=n(2),o=n.n(r),i=["backbutton","backlink","q"];function a(e){if(""===e)return e;if("undefined"==typeof sessionStorage)return e;var t=e.substring(1).split("&"),n="cache_"+(new Date).getTime()+"_";return"?"+o()(t,function(e){for(var t=0;t<i.length;++t)if(e.startsWith(i[t]+"=")&&!e.startsWith(i[t]+"=cache_")){var r=n+t;return sessionStorage.setItem(r,decodeURIComponent(e.substring(i[t].length+1))),i[t]+"="+r}return e}).join("&")}function s(e){return null==e?e:e.startsWith("cache_")?sessionStorage.getItem(e):e}},49:function(e,t,n){e.exports=function(e){return{getImageSize:function(e,t){var n=new window.Image;n.onload=function(){var e=this.width,n=this.height;t(e,n)},n.onerror=function(){t()},n.src=e},processRichTextImages:function(t){t.find("img").attr({height:"",draggable:"false"}).css("max-width","100%").each(function(){var t=e(this),n=t.css("float");"left"===n?t.css({"margin-right":"10px","margin-bottom":"10px"}):"right"===n&&t.css({"margin-left":"10px","margin-bottom":"10px"})})},calculateScaleAndOffset:function(e,t,n,r,o){var i,a,s,u,l,c;return"Cover entire area, keep aspect ratio"===e?((l=t/r)<(c=n/o)?(i=c,a=c):(i=l,a=l),s=(t-r*i)/2,u=(n-o*a)/2):"Contain entire picture, keep aspect ratio"===e?((l=t/r)>(c=n/o)?(i=c,a=c):(i=l,a=l),s=(t-r*i)/2,u=(n-o*a)/2):"Cover entire area with entire picture"===e?(s=0,u=0,i=t/r,a=n/o):(i=1,a=1,s=(t-r)/2,u=(n-o)/2),{scale_x:i,scale_y:a,offset_x:s,offset_y:u}}}}(n(1))},5:function(e,t,n){e.exports=function(e){function t(){var e=window.navigator.userAgent,t=e.indexOf("OS ");return(e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1)&&t>-1?window.Number(e.substr(t+3,3).replace("_",".")):0}function n(){return window.BW_PLATFORM_HACK?window.BW_PLATFORM_HACK:"iPad"===navigator.platform||"iPhone"===navigator.platform?void 0!==navigator.epubReadingSystem&&"iBooks"===navigator.epubReadingSystem.name?"ibw-platform-ipad-ibooks-epub":-1!==navigator.userAgent.indexOf("SEB")?"ibw-platform-ipad-seb":-1!==navigator.userAgent.indexOf("Safari")?"ibw-platform-ipad-safari":-1!==navigator.userAgent.indexOf("BookWidgets")?"ibw-platform-ipad-bookwidgets":"http:"!==window.location.protocol&&"https:"!==window.location.protocol?"ibw-platform-ipad-ibooks":"ibw-platform-ipad":"MacIntel"===navigator.platform?void 0!==navigator.epubReadingSystem&&"iBooks"===navigator.epubReadingSystem.name?"ibw-platform-osx-ibooks-epub":-1!==navigator.userAgent.indexOf("PhantomJS")?"ibw-platform-osx-phantomjs":-1!==navigator.userAgent.indexOf("HeadlessChrome")?"ibw-platform-osx-headlesschrome":-1!==navigator.userAgent.indexOf("ibookwidgets")?"ibw-platform-osx-preview":-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-osx-chrome":-1!==navigator.userAgent.indexOf("Safari")?"ibw-platform-osx-safari":-1!==navigator.userAgent.indexOf("Firefox")?"ibw-platform-osx-firefox":"http:"!==window.location.protocol&&"https:"!==window.location.protocol?"ibw-platform-osx-ibooks":"ibw-platform-osx":"Win32"===navigator.platform?-1!==navigator.userAgent.indexOf("BookWidgets")?"ibw-platform-win32-preview":"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&-1!==navigator.userAgent.indexOf("Trident")||"Netscape"===navigator.appName&&-1!==navigator.userAgent.indexOf("Edge")?"ibw-platform-win32-ie":-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-win32-chrome":-1!==navigator.userAgent.indexOf("Firefox")?"ibw-platform-win32-firefox":"ibw-platform-win32":"iPad Simulator"===navigator.platform||"iPhone Simulator"===navigator.platform?"ibw-platform-ipad-bookwidgets":-1!==navigator.userAgent.indexOf("Android")?-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-android-chrome":"ibw-platform-android":-1!==navigator.userAgent.indexOf("CrOS")?-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-chromebook-chrome":"ibw-platform-chromebook":"ibw-platform-unknown"}function r(){return-1!==n().indexOf("preview")}function o(){return"1"===e.getUrlParams(window.location.href).preview||window.WidgetParams&&window.WidgetParams.preview}function i(){var e=n();return 0===e.indexOf("ibw-platform-ipad")||0===e.indexOf("ibw-platform-android")}return{getPlatform:n,supportsAppFeature:function(e){var t=/BookWidgets\/([0-9]+)\.([0-9]+)\.([0-9]+)/g.exec(navigator.userAgent),n=t&&4===t.length?1e4*parseInt(t[1])+100*parseInt(t[2])+parseInt(t[3]):0;return console.log(e+" "+n),"audiorecording"===e&&n>=20800},isToolPreview:r,isWebPreview:o,isPreview:function(){return r()||o()},isTopLevelPlay:function(){return"1"===e.getUrlParams(window.location.href).toplevel},isAndroidIosDevice:i,isTouchDevice:function(){return i()||(t=" -webkit- -moz- -o- -ms- ".split(" "),"ontouchstart"in window||(e=["(",t.join("touch-enabled),("),"heartz",")"].join(""),window.matchMedia(e).matches));var e,t},isIOS:function(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)},isInternetExplorer:function(){return-1!==window.navigator.userAgent.indexOf("MSIE ")||/rv:11.0/i.test(window.navigator.userAgent)},getIOSIBooksRestartInfo:function(){return t()>=7?'To close iBooks:<ol style="text-align: left;"><li>Double-click the Home button.</li><li>Swipe left or right until you have located iBooks.</li><li>Swipe the app\'s preview up to close it.</li></ol>':t()>=5?"To close iBooks:<ol style=\"text-align: left;\"><li>Double-click the Home button.</li><li>Touch-and-hold the iBooks icon to put it into 'jiggly mode'.</li><li>Tap the red minus-sign icon that appears at the top left corner of iBooks.</li><li>Click the Home button to exit 'jiggly mode'.</li></ol>":""},inIframe:function(){try{return window.self!==window.parent}catch(e){return!0}}}}(n(16))},50:function(e,t,n){var r=n(47),o=r.valueOrCacheValue,i=r.replaceParamsBySessionLink,a=n(14);e.exports=function(e,t,n,r,s){function u(r,u){var l=e.getParameters();delete l.design,delete l.content,delete l.translation,delete l.sig,s.isEmbeddedLTIAuthenticated()&&(l.lti_authenticated=1);var c=n.getProviderId(),d=window.location.protocol+"//"+window.location.host+window.location.pathname+i(window.location.search);if(null==l.login_hint&&c&&""!==c&&(window.location.search.length>1?d+="&":d+="?",d+="login_hint="+encodeURIComponent(c)),d+=e.getHash(),""===r||"?"===r.charAt(0))return t.showAlert("The widget is not included.","Broken link"),r;function f(e){return-1===e.indexOf("?")?"?":"&"}if(u&&(r+=f(r)+"backlink="+encodeURIComponent(d),window.bwbackbuttonlabel&&(r+="&backbutton="+encodeURIComponent(window.bwbackbuttonlabel))),r.indexOf("/play/")>=0)l.q&&""!==l.q&&(r+=f(r)+function(e,t){if(null==e)return"";var n=a.isArray(t)?t:[t];return a.filter(e.split("&"),function(e){for(var t=0;t<n.length;++t)if(e.startsWith(n[t]+"="))return!1;return!0}).join("&")}(o(l.q),["context_id","backlink","backbutton"])),null!=l.toplevel&&(r+=f(r)+"toplevel="+encodeURIComponent(l.toplevel)),c&&""!==c&&(r+=f(r)+"login_hint="+encodeURIComponent(c));else{var p={},h={};for(var g in l)"sid"!==g&&l.hasOwnProperty(g)&&(e.LEGACY_HASH_PARAMETERS.indexOf(g)>=0?p[g]=l[g]:h[g]=l[g]);c&&""!==c&&(p.login_hint=c),Object.keys(h).length>0&&(r+=f(r)+e.urlencode(h)),Object.keys(p).length>0&&(r+="#"+e.urlencode(p))}return r}function l(e,t,n){if(console.log("Widget link: "+e),e=u(e,t),n){var o=r(n.target),i=0===o.length?{left:0,top:0}:o.offset(),a=o.clone();r("body").append(a),a.css({position:"absolute",left:i.left+"px",top:i.top+"px",width:o.width()+"px",height:o.height()+"px","border-left":o.css("border-left"),"border-right":o.css("border-right"),"border-top":o.css("border-top"),"border-bottom":o.css("border-bottom"),"border-top-left-radius":o.css("border-top-left-radius"),"border-top-right-radius":o.css("border-top-right-radius"),"border-bottom-left-radius":o.css("border-bottom-left-radius"),"border-bottom-right-radius":o.css("border-bottom-right-radius"),"-webkit-border-top-left-radius":o.css("-webkit-border-top-left-radius"),"-webkit-border-top-right-radius":o.css("-webkit-border-top-right-radius"),"-webkit-border-bottom-left-radius":o.css("-webkit-border-bottom-left-radius"),"-webkit-border-bottom-right-radius":o.css("-webkit-border-bottom-right-radius"),"box-shadow":o.css("box-shadow"),"-webkit-box-shadow":o.css("-webkit-box-shadow")});a.css({"-webkit-transition":"all .5s linear","-moz-transition":"all .5s linear","-o-transition":"all .5s linear",transition:"all .5s linear","box-sizing":"border-box"});var s=r(document).width(),l=r(document).height(),c=s/o.width(),d=l/o.height(),f=c>d?d:c,p="translate("+(s/2-i.left-o.width()/2)+"px, "+(l/2-i.top-o.height()/2)+"px) scale("+f+")";a.css({"-webkit-transform":p,"-moz-transform":p,"-o-transform":p,transform:p,opacity:.1}),setTimeout(function(){window.location=e,a.remove()},500)}else window.location=e}function c(e){return null!=e&&-1!==e.indexOf("bookwidgets.com/play/")}return{isWidgetPlayLink:c,openLinkOrWidgetLink:function(e,t,n){if(c(e)){var o=-1===e.indexOf("?")?"?":"&";l(e+=o+"noiframe=1",t)}else r().isSafeURLForNavigation(e)&&(n?(console.log("open link in new tab ",e),window.open(e,"_blank")):(console.log("open link in same tab ",e),top.location.href=e))},processRichTextWidgetPlayLinks:function(e,t){e.find("a").filter(function(){return c(r(this).attr("href"))}).each(function(){var e=r(this),n=e.attr("href");console.log("make link widget play link",n);var o=-1===n.indexOf("?")?"?":"&";n+=o+"noiframe=1",e.before(r(document.createElement("div")).css("display","inline-block").tapOrClick(function(){return l(n,t),!1}).safeHtml(e.html())),e.after("&nbsp;"),e.hide()})},openWidget:l,addLinkIcon:function(e){r(document.createElement("div")).addClass("link-icon").css({width:"24px",height:"24px",position:"absolute",top:"10px",right:"10px",opacity:"0.6",background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAA+JJREFUeAHlm8tLIzEcx2Nb67M3wZsXb7uw91UPHv0f/AdEEEEEUUQQRBBE0a4PfKJWEV+IiIgUEfHmraxXBa/e3NvCbjbf2oiPTZv5zWRm0gn8GoyTmXw+ySTttGHsc/oqiqZF3Il4FsEtDzCABUxgU6ak+E9axB8RtkOr2g82MIL1XUJBVoSqYrmVg/WdhB8RgpediZHAKkTgvsiJiImIUvorYL/FxcuQiO9RIi+wovN/4wUz5JdCYdSyOwjAMpGKGnmB9xcEYFKIbEpQyJubm1ljY6NW1YoKOKYnav1cLseenzG4Sye5LGjnTU1N/P7+noc5tbW1afGQlr7Hx0fW3t7OHh4eSusN+REkAWAqFwlkAeUiwZWAcpDgWoDtEjwRYLMEzwTYKsFTATZK8FyAbRKMCLBJgjEBtkgwKsAGCcYFhF2CLwLeSnh6esKfxpP4pKp1Dd8EoDUdHR2soaFBq2F+HeSbgK6uLra4uMioDzhMCfFFQHd3N5ufnw8dPKQaF9DT08Pm5uZCCW9cQG9vL5udnTU1ej07r9azM3E1R8f19fUF+siwtbVVt73OwHRE9Pf3BwqPiwcmYGBgIHD4wAQMDg6GAj4QAcPDw6GB913AyMiI5/C3t7dcfO9APq9vc8Do6Ci5kaqKNzc3PJVKcTffQPkiYGxsTMVALr++vub19fWvSxhVgnEB4+PjZEhVxaurK15XV/cKL5dcigSjAiYmJlQM5PLLy0teW1v7CZ4qwZiAyclJMqSqYjabLQpPkdDS0qKUKc9XyPXfCU5NTakYyOUXFxe8pqZGt7HaE6PnAmZmZsiQqorn5+e8urpaG172nM6c4KmAdDqtYiCXn52d8aqqKsfwuhI8ESCe3nDxWZ4Mqap4enrqCl5HgmsBgBePsFQM5PKTkxOeTCbJPS/hZa66HVwJAPzS0hIZUlXx+PjYU/hiElwJ6OzsVDGQy4+OjnhlZaVnPS/hZf5xJLgS4PXwPzg44IlEwhj8/yS4EoATQsLy8jK5x2XFvb09X+A/SnAtQEpYXV2VLI7z3d1dHo/Hjfe8hJc5bgfxY07d6xZ/JxiLxfj6+rpj+O3t7UDgpQQHeXEBOBEkbG5uakvY2tqyBR6jpLQAKSGTyZSUsLGxkReme94QHKcnAA3F/byzs6OUsLa2Zhu8/giQPQUJmNw+ppWVlfzKIY+zKHe+NxBr+v7+/qsDvGvEsmkRtGxr/vf02DIjC7RzSDg8POQLCwu2woP1p4j8jkpt8LeyIMHSnpe809jOEeltcxgBSJHdOPmC/7KNNNJbZyECe2kxEiK5eRoCZMKcEJnt8/8AtqIJGXRoCukAAAAASUVORK5CYII=)","background-size":"cover"}).appendTo(e)},widgetCoverImage:function(e){return e?e.replace("/play/","/cover/"):null}}}(n(16),n(21),n(60),n(1),n(45))},51:function(e,t,n){"use strict";n.r(t),n.d(t,"isLetterRegexp",function(){return r}),n.d(t,"isLetter",function(){return o});var r=function(){try{return RegExp(/^\p{L}/,"u")}catch(e){return/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D])/}}();function o(e){return null!=e.match(r)}},52:function(e,t,n){"use strict";n.r(t),t.default=function(e){if("undefined"==typeof window||window.navigator&&window.navigator.userAgent&&(window.navigator.userAgent.indexOf("PhantomJS")>=0||window.navigator.userAgent.indexOf("ibookwidgets")>=0)){e=e.replace(/&quot;/g,'"');var t=/src='([^']+)'/.exec(e);return t?t[1]:(t=/src="([^"]+)"/.exec(e))?t[1]:null}var n=(new window.DOMParser).parseFromString("<html>"+e+"</html>","text/html").getElementsByTagName("iframe");return n.length>0?n[0].src:null}},520:function(e,t,n){e.exports=function(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.startsWith=function(e){return 0===this.indexOf(e)},String.prototype.endsWith=function(e){var t=this.lastIndexOf(e);return-1!=t&&this.length-e.length==t},Array.slice||(Array.slice=function(e,t,n){switch(arguments.length){default:return Array.prototype.slice.call(e,t,n);case 2:return Array.prototype.slice.call(e,t);case 1:return Array.prototype.slice.call(e);case 0:return null}}),Array.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0;n<this.length;n++)if(this[n]===e)return n;return-1});var e={colToAlphabet:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZ";return e>26?t[e/26]+t[e%26]:t[e]},parseCell:function(e){var t;result={column:0,row:0};var n=e.split("!");for(2==n.length?(e=n[1],result.worksheet=n[0]):result.worksheet="",t=0;t<e.length;t++){if((r=e.charCodeAt(t))<65||r>90)break;result.column=26*result.column+(r-65)}for(;t<e.length;t++){var r;if((r=e.charCodeAt(t))<48||r>57)break;result.row=10*result.row+(r-48)}return result},isRange:function(e){return new RegExp("^([A-Za-z0-9_]+!)[A-Z]+[1-9][0-9]*:[A-Z]+[1-9][0-9]*$").test(e)},range:function(e,t){var n=t.split("!");return e+":"+(2==n.length?n[1]:t)},genCellName:function(t,n,r){return t+"!"+e.colToAlphabet(n)+r},expandRange:function(t,n){for(var r=t.split(":"),o=e.parseCell(r[0]),i=e.parseCell(r[1]),a=[],s=o.row;s<=i.row;++s)for(var u=o.column;u<=i.column;++u){var l=e.genCellName(o.worksheet,u,s);a.push(n[l])}return a},flatten:function(t,n){var r=[],o=Object.prototype.toString.call(t);if("[object Array]"===o)for(var i=0;i<t.length;++i)"[object Array]"===Object.prototype.toString.call(t[i])?r=r.concat(e.flatten(t[i]),n):e.isRange(t[i])?r=r.concat(e.expandRange(t[i],n)):r.push(t[i]);else"[object String]"==o&&e.isRange(t)?r=r.concat(e.expandRange(t,n)):r.push(t);return r},sum:function(t,n){for(var r=e.flatten(t,n),o=0,i=0;i<r.length;++i)o+=Number(r[i]);return o},product:function(t,n){for(var r=e.flatten(t,n),o=1,i=0;i<r.length;++i)o*=Number(r[i]);return o},min:function(t,n){var r=e.flatten(t,n);if(0==r.length)return 0;for(var o=Number(r[0]),i=1;i<r.length;++i){var a=Number(r[i]);a<o&&(o=a)}return o},max:function(t,n){var r=e.flatten(t,n);if(0==r.length)return 0;for(var o=Number(r[0]),i=1;i<r.length;++i){var a=Number(r[i]);a>o&&(o=a)}return o},avg:function(t,n){for(var r=e.flatten(t,n),o=0,i=0;i<r.length;++i)o+=Number(r[i]);return o/r.length},count:function(t,n){return e.flatten(t,n).length},IF:function(e,t){if("[object Array]"!=Object.prototype.toString.call(e)||3!=e.length)throw new Error("if needs (condition, true_value, false_value) parameters");var n=e[0],r=e[1],o=e[2];return n?r:o},vlookup:function(t,n){if("[object Array]"!=Object.prototype.toString.call(t)||t.length<3||t.length>4||0==e.isRange(t[1]))throw new Error("vlookup needs (lookup_value,table_array,col_index_num,range_lookup) parameters");var r=t[0],o=Number(r),i=t[1],a=t[2],s=!(t.length>3)||1==t[3],u=i.split(":"),l=e.parseCell(u[0]),c=e.parseCell(u[1]),d=c.column-l.column+1;if(d<2)throw new Error("You need at least 2 columns.");if(a<1)throw new Error("Column index should be larger than 1");if(a>d)throw new Error("You specify column "+a+" but your range has only "+d+" columns");for(var f,p=-1,h=l.row;h<=c.row;++h){var g=n[e.genCellName(l.worksheet,l.column,h)];if(g==r)return n[e.genCellName(l.worksheet,l.column+a-1,h)];var m=Number(g);m<o&&(-1==p||f<m)&&(p=h,f=m)}if(s)return-1==p?(console.log("Range lookup: not found..."),""):n[e.genCellName(l.worksheet,l.column+a-1,p)]}},n=function(t){function n(e){function t(){}return t.prototype=e,new t}var r=0,o=1,i=2,a=3,s=4,u=5,l=6;function c(e,t,n,c){this.type_=e,this.index_=t||0,this.prio_=n||0,this.number_=null!=c?c:0,this.toString=function(){switch(this.type_){case r:return this.number_;case o:case i:case a:case u:case l:return this.index_;case s:return"CALL";default:return"Invalid Token"}}}function d(e,t,n,r){this.tokens=e,this.ops1=t,this.ops2=n,this.functions=r}var f=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,p={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function h(e,t){return Number(e)+Number(t)}function g(e,t){return e-t}function m(e,t){return e*t}function v(e,t){return e/t}function b(e,t){return e%t}function w(e,t){return""+e+t}function y(e,t){return Number(e)<Number(t)}function C(e,t){return Number(e)<=Number(t)}function D(e,t){return Number(e)>Number(t)}function A(e,t){return Number(e)>=Number(t)}function E(e,t){return e==t}function _(e,t){return e!=t}function S(e){return-e}function k(e){return Math.random()*(e||1)}function x(e){for(var t=e=Math.floor(e);e>1;)t*=--e;return t}function O(e,t){return Math.sqrt(e*e+t*t)}function I(e){return Math.log(e)/Math.log(10)}function F(e){return Math.log(e)/Math.log(2)}function T(e,t){return Math.log(e)/Math.log(t)}function B(e,t){return"[object Array]"!=Object.prototype.toString.call(e)?[e,t]:((e=e.slice()).push(t),e)}function N(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,cotan:Math.tan,asin:Math.asin,arcsin:Math.asin,acos:Math.acos,arccos:Math.acos,atan:Math.atan,arctan:Math.atan,sqrt:Math.sqrt,log:I,log2:F,log10:I,ln:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,"-":S,exp:Math.exp,SUM:e.sum,PRODUCT:e.product,COUNT:e.count,AVG:e.avg,MIN:e.min,MAX:e.max,AVERAGE:e.avg,IF:e.IF,VLOOKUP:e.vlookup},this.ops2={"+":h,"-":g,"*":m,"/":v,"%":b,"^":Math.pow,",":B,"||":w,":":e.range,"<":y,"<=":C,">":D,">=":A,"=":E,"<>":_},this.functions={random:k,fac:x,min:Math.min,max:Math.max,pyt:O,pow:Math.pow,atan2:Math.atan2,arctan2:Math.atan2,logn:T},this.consts={E:Math.E,PI:Math.PI,FALSE:0,TRUE:1}}d.prototype={simplify:function(e){e=e||{};var t,s,f,p,h=[],g=[],m=this.tokens.length,v=0;for(v=0;v<m;v++){var b=(p=this.tokens[v]).type_;if(b===r)h.push(p);else if(b===u||b===l)h.push(p);else if(b===a&&p.index_ in e)p=new c(r,0,0,e[p.index_]),h.push(p);else if(b===i&&h.length>1)s=h.pop(),t=h.pop(),f=this.ops2[p.index_],p=new c(r,0,0,f(t.number_,s.number_)),h.push(p);else if(b===o&&h.length>0)t=h.pop(),f=this.ops1[p.index_],p=new c(r,0,0,f(t.number_)),h.push(p);else{for(;h.length>0;)g.push(h.shift());g.push(p)}}for(;h.length>0;)g.push(h.shift());return new d(g,n(this.ops1),n(this.ops2),n(this.functions))},substitute:function(e,t){t instanceof d||(t=(new N).parse(String(t)));var r,o=[],i=this.tokens.length,s=0;for(s=0;s<i;s++){if((r=this.tokens[s]).type_===a&&r.index_===e)for(var u=0;u<t.tokens.length;u++){var l=t.tokens[u],f=new c(l.type_,l.index_,l.prio_,l.number_);o.push(f)}else o.push(r)}return new d(o,n(this.ops1),n(this.ops2),n(this.functions))},expandranges:function(){var t,r=[],o=this.tokens.length,a=0;for(a=0;a<o;a++){if((t=this.tokens[a]).type_===i&&":"===t.index_)if(r.length>=2){var s=r[r.length-2],l=r[r.length-1];if(s.type_==u&&l.type_==u){r.pop(),r.pop();for(var f=e.parseCell(s.index_),p=e.parseCell(l.index_),h=!0,g=f.row;g<=p.row;++g)for(var m=f.column;m<=p.column;++m){var v=e.genCellName(f.worksheet,m,g);r.push(new c(u,v,0,0)),h?h=!1:r.push(new c(i,",",-1,0))}}else console.log("Error: wrong types for range operator"),r.push(t)}else console.log("Error: range without sufficient params"),r.push(t);else r.push(t)}return new d(r,n(this.ops1),n(this.ops2),n(this.functions))},collapseranges:function(){var t,r=[],o=this.tokens.length,a=0;for(a=0;a<o;a++){if((t=this.tokens[a]).type_===i&&":"===t.index_)if(r.length>=2){var s=r[r.length-2],f=r[r.length-1];s.type_==u&&f.type_==u?(r.pop(),r.pop(),r.push(new c(l,e.range(s.index_,f.index_),0,0))):(console.log("Error: wrong types for range operator"),r.push(t))}else console.log("Error: range without sufficient params"),r.push(t);else r.push(t)}return new d(r,n(this.ops1),n(this.ops2),n(this.functions))},evaluate:function(e){e=e||{};var t,n,c,d,f=[],p=this.tokens.length,h=0;for(h=0;h<p;h++){var g=(d=this.tokens[h]).type_;if(g===r)f.push(d.number_);else if(g===i)n=f.pop(),t=f.pop(),c=this.ops2[d.index_],f.push(c(t,n));else if(g===u){if(!(d.index_ in e))throw new Error("undefined variable: "+d.index_);f.push(e[d.index_])}else if(g===l)f.push(d.index_);else if(g===a)if(d.index_ in e)f.push(e[d.index_]);else{if(!(d.index_ in this.functions))throw new Error("undefined variable: "+d.index_);f.push(this.functions[d.index_])}else if(g===o)t=f.pop(),c=this.ops1[d.index_],f.push(c(t,e));else{if(g!==s)throw new Error("invalid Expression");if(t=f.pop(),!(c=f.pop()).apply||!c.call)throw new Error(c+" is not a function");"[object Array]"==Object.prototype.toString.call(t)?f.push(c.apply(void 0,t)):f.push(c.call(void 0,t))}}if(f.length>1)throw new Error("invalid Expression (parity)");return f[0]},toString:function(e){var t,n,u,l,c,d=[],h=this.tokens.length,g=0;for(g=0;g<h;g++){var m=(l=this.tokens[g]).type_;if(m===r)d.push("string"==typeof(c=l.number_)?(f.lastIndex=0,f.test(c)?"'"+c.replace(f,function(e){var t=p[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+c+"'"):c);else if(m===i)n=d.pop(),t=d.pop(),u=l.index_,e&&"^"==u?d.push("Math.pow("+t+","+n+")"):d.push("("+t+u+n+")");else if(m===a)d.push(l.index_);else if(m===o)t=d.pop(),"-"===(u=l.index_)?d.push("("+u+t+")"):d.push(u+"("+t+")");else{if(m!==s)throw new Error("invalid Expression");t=d.pop(),u=d.pop(),d.push(u+"("+t+")")}}if(d.length>1)throw new Error("invalid Expression (parity)");return d[0]},variables:function(){for(var t=this.tokens.length,n=[],r=0;r<t;r++){var o=this.tokens[r];if(o.type_!==a&&o.type_!==u||-1!=n.indexOf(o.index_)){if(o.type===l)for(var i=o.index_.split(":"),s=e.parseCell(i[0]),c=e.parseCell(i[1]),d=s.row;d<=c.row;++d)for(var f=s.column;f<=c.column;++f){var p=e.colToAlphabet(f)+d;-1==n.indexOf(p)&&n.push(p)}}else n.push(o.index_)}return n},toJSFunction:function(e,t){var n=this.simplify(t).toString(!0);return n=n.replace("--","+"),new Function(e,"with(Parser.values) { return "+n+"; }")}},N.parse=function(e){return(new N).parse(e)},N.evaluate=function(e,t){return N.parse(e).evaluate(t)},N.evaluate2=function(e,t){return N.parse(e).collapseranges().evaluate(t)},N.Expression=d,N.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:k,fac:x,exp:Math.exp,min:Math.min,max:Math.max,pyt:O,pow:Math.pow,atan2:Math.atan2,E:Math.E,PI:Math.PI,FALSE:0,TRUE:1};return N.prototype={parse:function(e,t){this.errormsg="",this.success=!0;var l=[],f=[];this.tmpprio=0;var p=77,h=0;for(this.expression=e,this.pos=0;this.pos<this.expression.length;)if(this.isOperator())this.isSign()&&64&p?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",h++,this.addfunc(f,l,o)),p=77):this.isComment()||(0==(2&p)&&this.error_parsing(this.pos,"unexpected operator"),h+=2,this.addfunc(f,l,i),p=77);else if(this.isNumber()){0==(1&p)&&this.error_parsing(this.pos,"unexpected number");var g=new c(r,0,0,this.tokennumber);f.push(g),p=50}else if(this.isString()){0==(1&p)&&this.error_parsing(this.pos,"unexpected string");g=new c(r,0,0,this.tokennumber);f.push(g),p=50}else if(this.isLeftParenth())0==(8&p)&&this.error_parsing(this.pos,'unexpected "("'),128&p&&(h+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(f,l,s)),p=333;else if(this.isRightParenth()){if(256&p){g=new c(r,0,0,[]);f.push(g)}else 0==(16&p)&&this.error_parsing(this.pos,'unexpected ")"');p=186}else if(this.isComma())0==(32&p)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(f,l,i),h+=2,p=77;else if(this.isConst()){0==(1&p)&&this.error_parsing(this.pos,"unexpected constant");var m=new c(r,0,0,this.tokennumber);f.push(m),p=50}else if(this.isOp2())0==(4&p)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(f,l,i),h+=2,p=8;else if(this.isOp1())0==(4&p)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(f,l,o),h++,p=8;else if(this.isCellRef(t)){0==(1&p)&&this.error_parsing(this.pos,"unexpected cellref");var v=new c(u,this.tokenindex,0,0);f.push(v),p=186}else if(this.isVar()){0==(1&p)&&this.error_parsing(this.pos,"unexpected variable");v=new c(a,this.tokenindex,0,0);f.push(v),p=186}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg));for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');l.length>0;){var b=l.pop();f.push(b)}return h+1!==f.length&&this.error_parsing(this.pos,"parity"),new d(f,n(this.ops1),n(this.ops2),n(this.functions))},evaluate:function(e,t){return this.parse(e).evaluate(t)},error_parsing:function(e,t){throw this.success=!1,this.errormsg="parse error [column "+e+"]: "+t,new Error(this.errormsg)},addfunc:function(e,t,n){for(var r=new c(n,this.tokenindex,this.tokenprio+this.tmpprio,0);t.length>0&&r.prio_<=t[t.length-1].prio_;)e.push(t.pop());t.push(r)},isNumber:function(){for(var e=!1,t="";this.pos<this.expression.length;){var n=this.expression.charCodeAt(this.pos);if(!(n>=48&&n<=57||46===n))break;t+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(t),e=!0}return e},unescape:function(e,t){for(var n=[],r=!1,o=0;o<e.length;o++){var i=e.charAt(o);if(r){switch(i){case"'":n.push("'");break;case"\\":n.push("\\");break;case"/":n.push("/");break;case"b":n.push("\b");break;case"f":n.push("\f");break;case"n":n.push("\n");break;case"r":n.push("\r");break;case"t":n.push("\t");break;case"u":var a=parseInt(e.substring(o+1,o+5),16);n.push(String.fromCharCode(a)),o+=4;break;default:throw this.error_parsing(t+o,"Illegal escape sequence: '\\"+i+"'")}r=!1}else"\\"==i?r=!0:n.push(i)}return n.join("")},isString:function(){var e=!1,t="",n=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){if("'"==this.expression.charAt(this.pos)&&"\\"!=t.slice(-1)){this.pos++,this.tokennumber=this.unescape(t,n),e=!0;break}t+=this.expression.charAt(this.pos),this.pos++}return e},isConst:function(){for(var e in this.consts){var t=e.length;if(e===this.expression.substr(this.pos,t))return this.tokennumber=this.consts[e],this.pos+=t,!0}return!1},isOperator:function(){var e=this.expression.charCodeAt(this.pos);if(43===e)this.tokenprio=0,this.tokenindex="+";else if(45===e)this.tokenprio=0,this.tokenindex="-";else if(124===e){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="||"}else if(42===e)this.tokenprio=1,this.tokenindex="*";else if(47===e)this.tokenprio=2,this.tokenindex="/";else if(37===e)this.tokenprio=2,this.tokenindex="%";else if(94===e)this.tokenprio=3,this.tokenindex="^";else if(58===e)this.tokenprio=0,this.tokenindex=":";else if(60===e)this.tokenprio=0,this.pos+1<this.expression.length&&61==this.expression.charCodeAt(this.pos+1)?(this.pos++,this.tokenindex="<="):this.pos+1<this.expression.length&&62==this.expression.charCodeAt(this.pos+1)?(this.pos++,this.tokenindex="<>"):this.tokenindex="<";else if(61===e)this.tokenprio=0,this.tokenindex="=";else{if(62!==e)return!1;this.tokenprio=0,this.pos+1<this.expression.length&&61==this.expression.charCodeAt(this.pos+1)?(this.tokenindex=">=",this.pos++):this.tokenindex=">"}return this.pos++,!0},isSign:function(){var e=this.expression.charCodeAt(this.pos-1);return 45===e||43===e},isColon:function(){return 58===this.expression.charCodeAt(this.pos-1)},isPositiveSign:function(){return 43===this.expression.charCodeAt(this.pos-1)},isNegativeSign:function(){return 45===this.expression.charCodeAt(this.pos-1)},isLeftParenth:function(){return 40===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio+=10,!0)},isRightParenth:function(){return 41===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio-=10,!0)},isComma:function(){return 44===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0)},isWhite:function(){var e=this.expression.charCodeAt(this.pos);return(32===e||9===e||10===e||13===e)&&(this.pos++,!0)},isOp1:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase()&&(t===this.pos||"_"!=n&&(n<"0"||n>"9")))break;e+=n}return e.length>0&&e in this.ops1&&(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0)},isOp2:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase()&&(t===this.pos||"_"!=n&&(n<"0"||n>"9")))break;e+=n}return e.length>0&&e in this.ops2&&(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0)},isCellRef:function(e){var t,n="",r=!1,o=!1,i="",a=!1;for(t=this.pos;t<this.expression.length;t++){if(i+=s=this.expression.charAt(t),!(s>="a"&&s<="z"||s>="A"&&s<="Z"||s>="0"&&s<="9"||"_"==s)){if("!"==s){if(1==a){++t;break}return!1}t=this.pos,i="";break}a=!0}for(t==this.expression.length&&(t=this.pos,i="");t<this.expression.length;t++){if((s=this.expression.charAt(t))<"A"||s>"Z")break;r=!0,n+=s}for(;t<this.expression.length;t++){var s;if((s=this.expression.charAt(t))<"0"||s>"9")break;o=!0,n+=s}return!(!r||!o)&&(""==i?(i=e+"!",this.pos+=n.length):this.pos+=i.length+n.length,this.tokenindex=i+n,this.tokenprio=4,!0)},isVar:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase()&&(t===this.pos||"_"!=n&&(n<"0"||n>"9")))break;e+=n}return e.length>0&&(this.tokenindex=e,this.tokenprio=4,this.pos+=e.length,!0)},isComment:function(){return 47===this.expression.charCodeAt(this.pos-1)&&42===this.expression.charCodeAt(this.pos)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)}},t.Parser=N,N}(t);return window.Parser=n,n}()},521:function(e,t){e.exports=function(){return function(e){var t=e.length,n=[],r=[],o=[];function i(e,t){var n;for(n=0;n<e.length;n++)t(e[n],n)}return i(e,function(t,n){r.push(n),t.hasOwnProperty("indegrees")||(t.indegrees=0),i(t.edges,function(t){e[t].hasOwnProperty("indegrees")?e[t].indegrees=e[t].indegrees+1:e[t].indegrees=1})}),function a(){for(var s=0;s<r.length;s++){var u=r[s];0===e[u].indegrees&&(o.push(u),r.splice(s,1),s--)}!function(t){if(null==t)throw console.log("Cycle! ",n),"You have a cycle in your expressions.";i(e[t].edges,function(t){e[t].indegrees--}),n.push(t)}(o.shift()),n.length<t&&a()}(),n}}()},54:function(e,t,n){e.exports={InstructionsDialog:"ATif7bfHOw26idmP24THn"}},55:function(e,t,n){e.exports=function(e,t){return{createLabeledCheckbox:function(t,n,r,o){var i=e(document.createElement("table")).addClass("bw-checkbox").appendTo(t),a=e(document.createElement("tr")).appendTo(i),s=e(document.createElement("td")).addClass("bw-checkbox-cell").appendTo(a);function u(){return null!=o&&o>0&&e(t).find("[role=checkbox][checked=checked]").length>=o}function l(){e(t).toggleClass("bw-check-limit-reached",u())}return e(document.createElement("div")).addClass("bw-checkbox-checkbox bw-icon bw-icon-accept").appendTo(s),e(document.createElement("td")).addClass("bw-button-label-cell").append(e(document.createElement("div")).addClass("bw-button-label").safeHtml(n)).appendTo(a),i.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"}),l()}),i.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"}),l()}),i.makeButton({role:"checkbox"}).tapOrClick(function(){var t=e(this);if("disabled"!==t.attr("disabled"))if("checked"===t.attr("checked"))t.trigger("clear"),r&&r.call(t[0],!1);else{if(u())return;t.trigger("check"),r&&r.call(t[0],!0)}}),i.trigger("clear"),i},createProgressBar:function(t,n){var r={};r.parent=t,r.max=n,e(document.createElement("div")).addClass("bw-progress-bar").css("left","-100%").appendTo(e(t));var o=100/n;return e(document.createElement("div")).addClass("bw-progress-bar-marker").css({left:"-100%",width:o+"%"}).appendTo(e(t)),r.setProgress=function(n,r,o){r=r||400;var i=100*-(this.max-parseFloat(n))/this.max,a=e(this.parent+"> .bw-progress-bar"),s=e(t).width(),u=-(this.max-parseFloat(n))*s/this.max;a.css("left",a.css("left")),a.animate({left:u},r,"swing",function(){a.css("left",i+"%"),o&&o()})},r.setPosition=function(n,r){r=r||400;var o=e(this.parent+"> .bw-progress-bar-marker"),i=100*parseFloat(n)/this.max,a=e(t).width()*n/this.max;o.css("left",o.css("left")),o.animate({left:a},r,"swing",function(){o.css("left",i+"%")})},r.clear=function(){e(this.parent+" .bw-progress-bar").css("left","-100%"),e(this.parent+" .bw-progress-bar-marker").css("left","-100%")},r},createSimpleCheckbox:function(t,n,r,o,i){var a=e(document.createElement("div")).addClass("bw-simple-checkbox bw-icon bw-icon-accept").appendTo(e(t)),s={role:"checkbox"};function u(){return null!=i&&i>0&&e(o).find("[role=checkbox][checked=checked]").length>=i}function l(){e(o).toggleClass("bw-check-limit-reached",u())}return r&&(s.labelledby=r),a.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"}),l()}),a.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"}),l()}),a.makeButton(s).tapOrClick(function(){var t=e(this);if("disabled"!==t.attr("disabled"))if("checked"===t.attr("checked"))t.trigger("clear"),n&&n.call(t[0],!1);else{if(u())return;t.trigger("check"),n&&n.call(t[0],!0)}}),a.trigger("clear"),a},createNumberButtons:function(n,r,o,i,a){function s(t){if(e(".buttonslot").removeClass("selected"),r<=9)e("#BS_"+t).addClass("selected");else if(t<5){e("#BS_1").removeClass("hide_number"),e("#BS_7").addClass("hide_number");for(var n=1;n<8;++n)e("#BS_"+n).find(".number-button").safeHtml(n+1);e("#BS_"+t).addClass("selected")}else if(r-t<6){e("#BS_1").addClass("hide_number"),e("#BS_7").removeClass("hide_number");for(var o=2;o<8;++o)e("#BS_"+o).find(".number-button").safeHtml(r-8+o);e("#BS_"+(9-(r-t))).addClass("selected")}else{e("#BS_1").addClass("hide_number"),e("#BS_7").addClass("hide_number");for(var s=1;s<8;++s)e("#BS_"+s).find(".number-button").safeHtml(s+t-3);e("#BS_4").addClass("selected")}0===t?e(i).addClass("hidden"):e(i).removeClass("hidden"),t===r-1?e(a).addClass("hidden"):e(a).removeClass("hidden")}e(n).addClass("bw-column-container");for(var u=0,l=Math.min(r,9),c=e(n),d=0;d<l;++d)e(document.createElement("div")).addClass("buttonslot bw-column-resizing").attr("id","BS_"+d).append(e(document.createElement("div")).addClass("number-button bw-button").text(d+1)).appendTo(c).find(".number-button").makeButton().tapOrClick(function(){s(u=parseInt(e(this).safeHtml())-1),o(u)});function f(){--u<0&&(u=0),s(u),o(u)}function p(){++u>=r&&(u=r-1),s(u),o(u)}return r>9&&(e(document.createElement("div")).addClass("ellipsis").appendTo(e("#BS_1")),e(document.createElement("div")).addClass("ellipsis").appendTo(e("#BS_7")),e("#BS_7").addClass("hide_number"),e("#BS_7").find(".number-button").safeHtml(r-1),e("#BS_8").find(".number-button").safeHtml(r)),e("#BS_0").addClass("selected"),e(i).addClass("hidden"),e(i).makeButton(t("previous")).tapOrClick(f),e(a).makeButton(t("next")).tapOrClick(p),{updateButtons:s,next:p,prev:f}},createSimpleRadiobutton:function(t,n,r){var o=e(document.createElement("div")).addClass("bw-simple-radiobutton bw-icon").appendTo(e(t));o.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})});var i={role:"radio"};return r&&(i.labelledby=r),o.makeButton(i).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),n&&n.call(t[0],!1)):(t.trigger("check"),n&&n.call(t[0],!0)))}),o.trigger("clear"),o},createLabeledRadiobutton:function(t,n,r){var o=e(document.createElement("table")).addClass("bw-radiobutton").appendTo(t),i=e(document.createElement("tr")).appendTo(o),a=e(document.createElement("td")).addClass("bw-radiobutton-cell").appendTo(i);return e(document.createElement("div")).addClass("bw-radiobutton-radiobutton bw-icon bw-icon-largedot").appendTo(a),e(document.createElement("td")).addClass("bw-button-label-cell").append(e(document.createElement("div")).addClass("bw-button-label").safeHtml(n)).appendTo(i),o.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})}),o.makeButton({role:"radio"}).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),r&&r.call(t[0],!1)):(t.trigger("check"),r&&r.call(t[0],!0)))}),o.trigger("clear"),o},createProgressCircle:function(t,n,r){var o={},i=30,a=40,s=40;o.id=n,o.progress=Array(r);var u=e(document.createElement("div")).addClass("bw-progress-circle bw-centering-container").attr("id",n).appendTo(e(t));e(document.createElement("div")).addClass("bw-progress-circle-text bw-centered").appendTo(u);var l=[];function c(e,t){if(-1===e)return"";var n=2*Math.PI*e/r,o=2*Math.PI*(e+1)/r,i=a+Math.sin(n)*t,u=s-Math.cos(n)*t,l=a+Math.sin(o)*t,c=s-Math.cos(o)*t;return"M X1 Y1 A R R 0 0 1 X2 Y2".replace("X1",i).replace("Y1",u).replace("X2",l).replace("Y2",c).replace("D",n).replace("R",t).replace("R",t)}function d(e){return'<path d="'+c(e,i)+'"/>'}for(var f=0;f<r;++f)l.push(d(f));return e('<svg class="bw-progress-circle-drawing" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 80 80">'+l.join("")+'<path class="the marker"/></svg>').appendTo(u),o.setProgress=function(t,n){e("#"+this.id+" path:nth-child("+(t+1)+")").attr("class",n)},o.setTextAndPosition=function(t,n){var r=e("#"+this.id+" .bw-progress-circle-text");r.animate({opacity:0},200,"swing",function(){r.empty().append(t).animate({opacity:1},200)});var o=e("#"+this.id+" path.the.marker");o.animate({opacity:0},200,"swing",function(){o.attr("d",c(n,i)).animate({opacity:1},200)})},o}}}(n(1),n(17))},56:function(e,t){e.exports=window.$},57:function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){return"string"==typeof(t=e)||"object"===n(t)&&t.constructor===String?0===e.indexOf("http://")||0===e.indexOf("https://")||0===e.indexOf("//")?e.replace(/\(/g,"_").replace(/\)/g,"_").replace(/'/g,"%27"):encodeURIComponent(e).replace(/%2F/g,"/").replace(/'/g,"%27"):"";var t}},58:function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,i,a;e.exports=(o=n(26).createLogger("CallbackBridge"),i=1,(a=function(){this.id=i++,this.listening=!1,this.nextCallbackID=1,this.callbacks={},this.handleMessage=this._handleMessage.bind(this)}).prototype.getMessagePrefix=function(){return"bw-CBBridge-"+this.id+"-"},a.prototype.startListening=function(){window.addEventListener("message",this.handleMessage)},a.prototype.stopListening=function(){window.removeEventListener("message",this.handleMessage)},a.prototype._handleMessage=function(e){var t=this.getMessagePrefix();"object"===r(e.data)&&"string"==typeof e.data.command&&e.data.command.substr(0,t.length)===t&&(e.data.hasOwnProperty("err")?this.processCallback(e.data.command,e.data.err,e.data.data):this.processCallback(e.data.command,e.data.arg))},a.prototype.registerCallbacks=function(e,t){var n=""+this.nextCallbackID++;return this.callbacks[n]={ok:e,error:t},{ok:this.getMessagePrefix()+n+"-ok",error:this.getMessagePrefix()+n+"-error"}},a.prototype.registerCallback=function(e,t){var n=""+this.nextCallbackID++;return this.callbacks[n]={cb:e,singleshot:!t},this.getMessagePrefix()+n+"-cb"},a.prototype.processCallback=function(e,t,n){try{var r=e.match(/bw-CBBridge-.*-(.*)-(ok|error|cb)$/);if(r){var i,a=r[1],s=this.callbacks[a];return s?"cb"===r[2]?((i=s.cb)(t,n),void(s.singleshot&&delete this.callbacks[a])):(i="ok"===r[2]?s.ok:s.error,delete this.callbacks[a],void i(t)):void o.error("Cannot find callback with ID "+a+" Bridge "+this.id+this.callbacks)}o.error("Malformed callback: "+e)}catch(e){o.error(e)}},a)},6:function(e,t,n){"use strict";n.r(t),n.d(t,"replaceBadQuotes",function(){return c}),n.d(t,"removeDiacritics",function(){return h}),n.d(t,"removePunctuationMarks",function(){return v}),n.d(t,"simplifyWhitespace",function(){return D}),n.d(t,"prepareForCompare",function(){return _}),n.d(t,"trimAll",function(){return k}),n.d(t,"matchesOneOfAnswers",function(){return x}),n.d(t,"createCaseSensitiveKeywordListMatchRegexpForNFKC",function(){return N});var r=n(2),o=n.n(r),i=n(11),a=n.n(i),s=n(51),u=n(41),l=n.n(u);function c(e){return e.replace(/[\u2018\u2019]/g,"'")}var d=[{base:"A",letters:"A"},{base:"AA",letters:""},{base:"AE",letters:""},{base:"AO",letters:""},{base:"AU",letters:""},{base:"AV",letters:""},{base:"AY",letters:""},{base:"B",letters:"B"},{base:"C",letters:"C"},{base:"D",letters:"D"},{base:"DZ",letters:""},{base:"Dz",letters:""},{base:"E",letters:"E"},{base:"F",letters:"F"},{base:"G",letters:"G"},{base:"H",letters:"H"},{base:"I",letters:"I"},{base:"J",letters:"J"},{base:"K",letters:"K"},{base:"L",letters:"L"},{base:"LJ",letters:""},{base:"Lj",letters:""},{base:"M",letters:"M"},{base:"N",letters:"N"},{base:"NJ",letters:""},{base:"Nj",letters:""},{base:"O",letters:"O"},{base:"OI",letters:""},{base:"OO",letters:""},{base:"OU",letters:""},{base:"OE",letters:""},{base:"oe",letters:""},{base:"P",letters:"P"},{base:"Q",letters:"Q"},{base:"R",letters:"R"},{base:"S",letters:"S"},{base:"T",letters:"T"},{base:"TZ",letters:""},{base:"U",letters:"U"},{base:"V",letters:"V"},{base:"VY",letters:""},{base:"W",letters:"W"},{base:"X",letters:"X"},{base:"Y",letters:"Y"},{base:"Z",letters:"Z"},{base:"a",letters:"a"},{base:"aa",letters:""},{base:"ae",letters:""},{base:"ao",letters:""},{base:"au",letters:""},{base:"av",letters:""},{base:"ay",letters:""},{base:"b",letters:"b"},{base:"c",letters:"c"},{base:"d",letters:"d"},{base:"dz",letters:""},{base:"e",letters:"e"},{base:"f",letters:"f"},{base:"g",letters:"g"},{base:"h",letters:"h"},{base:"hv",letters:""},{base:"i",letters:"i"},{base:"j",letters:"j"},{base:"k",letters:"k"},{base:"l",letters:"l"},{base:"lj",letters:""},{base:"m",letters:"m"},{base:"n",letters:"n"},{base:"nj",letters:""},{base:"o",letters:"o"},{base:"oi",letters:""},{base:"ou",letters:""},{base:"oo",letters:""},{base:"p",letters:"p"},{base:"q",letters:"q"},{base:"r",letters:"r"},{base:"s",letters:"s"},{base:"t",letters:"t"},{base:"tz",letters:""},{base:"u",letters:"u"},{base:"v",letters:"v"},{base:"vy",letters:""},{base:"w",letters:"w"},{base:"x",letters:"x"},{base:"y",letters:"y"},{base:"z",letters:"z"}],f=null;var p=null;function h(e){return null==f&&(f=function(){for(var e={},t=0;t<d.length;t++)for(var n=d[t].letters,r=0;r<n.length;r++)e[n[r]]=d[t].base;return e}()),e.replace(/[\u0301\u0060]/gi,"").replace(/[^\u0000-\u007E]/g,function(e){return f[e]||e})}var g=/[!,-.:;?"'`()[\]{}\u2026\u2014]/g,m="[!,-.:;?\"'`()[\\]{}\\u2026\\u2014]*";function v(e){return e.replace(g,"")}var b=/\s+/g,w="\\s+",y=/ ([!,-.:;?"'`()[\]{}\u2026\u2014])/g,C=/([!,-.:;?"'`()[\]{}\u2026\u2014]) /g;function D(e){return e.replace(b," ").replace(y,"$1").replace(C,"$1")}var A="\\s+[!,-.:;?\"'`()[\\]{}\\u2026\\u2014\\s]*";function E(e){if("string"==typeof e||e instanceof String)switch(e){case"no":e={case:"1",accent:"0",white:"0",punct:"0"};break;case"yes_ignore_accents":e={case:"0",accent:"1",white:"0",punct:"0"};break;case"no_ignore_accents":e={case:"1",accent:"1",white:"0",punct:"0"};break;case"yes":default:e={case:"0",accent:"0",white:"0",punct:"0"}}return e}function _(e,t){return e?(t=E(t),e.normalize&&(e=e.normalize("NFKC")),t&&("1"===t.case&&(e=e.toLowerCase()),"1"===t.accent&&(e=h(e)),"1"===t.punct&&(e=v(e)),"1"===t.white&&(e=D(e))),e):""}function S(e){return e.replace(/[\x00-\x09\x0B-\x0C\x0E-\x1F\x7F-\x9F\u200B]/g,"")}function k(e){for(var t=0;t<e.length;++t)e[t]=e[t].trim();return e}function x(e,t,n){e=_(e,n),t=_(t,n),e=c(e);var r=k((t=c(t)).split(/##/));r.length>1&&(r=a()(r));for(var o=0;o<r.length;++o)if(S(e.trim())===S(r[o].trim()))return!0;return!1}var O=function(e){return(e+"").replace(/([\\.+*?[^\]$(){}=!<>|:])/g,"\\$1")},I=/\s/g,F=null;function T(e){return!(null==e.match(I))}function B(e){return!(null==e.match(g))}function N(e,t){var n=(t=E(t))&&"1"===t.case?"gi":"g",r=t&&"1"===t.punct,i=t&&"1"===t.white,a=t&&"1"===t.accent;if(e=o()(e,function(e){return e.normalize?e.normalize("NFKC"):e}),!r&&!i&&!a){var u=o()(e,O).join("|");return new RegExp("("+u+")",n)}null==F&&(F=new l.a),a&&null==p&&(p=function(){for(var e={},t=0;t<d.length;t++)if(1===d[t].base.length)for(var n=d[t].letters+d[t].base,r="["+n+"]",o=0;o<n.length;o++)e[n[o]]=r;return e}());var c=o()(e,function(e){for(var t=F.splitGraphemes(e),n=[],o=0;o<t.length;++o){var u=t[o];if(Object(s.isLetter)(u)){var l;if(a)n.push(null!==(l=p[u])&&void 0!==l?l:u);else n.push(u);r&&o!==t.length-1&&n.push(m)}else if(T(u))if(i)if(r){for(;o+1<t.length&&(T(t[o+1])||B(t[o+1]));)++o;n.push(A)}else{for(;o+1<t.length&&T(t[o+1]);)++o;n.push(w)}else n.push(u),r&&n.push(m);else B(u)&&r||n.push(O(u))}return n.join("")}).join("|");return new RegExp("("+c+")",n)}},60:function(e,t){var n;e.exports={_creds:n={username:null,userid:null,email:null,providerid:null,providerhumanid:null,provider:null,school:null,token:null,sid:null,coaccount:null},credentials:function(){return this._creds},clear:function(){this._creds=n},setCredentials:function(e){this._creds=e},getUserToken:function(){return this._creds.token},getUserSid:function(){return this._creds.sid},getUserName:function(){return this._creds.username},getUserClassName:function(){return this._creds.className},getUserId:function(){return this._creds.userid},getEmail:function(){return this._creds.email},getProviderId:function(){return this._creds.providerid},getProviderHumanId:function(){return this._creds.providerhumanid},isCoAccount:function(){return this._creds.coaccount}}},63:function(e,t,n){var r=n(14).filter;e.exports=function(e){var t={},n=null,o=[];return t.pushAsyncFunc=function(t,r,i,a){if(i&&o.length&&o[o.length-1].cb===t){var s=o[o.length-1];return s.data=i(s.data,r),s.deferred}var u=e.Deferred(),l={cb:t,data:r,deferred:u};return a?o.unshift(l):o.push(l),null===n&&function e(){0!=o.length?(n=o.shift()).cb(n.data).always(function(){n.deferred.resolve.apply(null,arguments),e()}):n=null}(),u},t.pushSyncFunc=function(t){this.pushAsyncFunc(function(){return t(),e.when()})},t.remove=function(e){o=r(o,function(t){return t.cb!==e})},t}(n(1))},65:function(e,t){e.exports={GetItem:function(e){return window.localStorage.getItem(e)},RemoveItem:function(e){window.localStorage.removeItem(e)},SetItem:function(e,t){window.localStorage.setItem(e,t)},Clear:function(){window.localStorage.clear()}}},67:function(e,t,n){"use strict";n.r(t),n.d(t,"setPreparePrint",function(){return c});var r=n(5);function o(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function i(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var a=i(function(){return function(e){if(e&&e.then)return e.then(l)}(function(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then)return n.then(void 0,t);return n}(function(){return u(s,function(){window.print()})},l))}),s=function(){return o(!0)};function u(e,t,n){if(n)return t?t(e()):e();try{var r=Promise.resolve(e());return t?r.then(t):r}catch(e){return Promise.reject(e)}}function l(){}function c(e){s=e}window.addEventListener("message",i(function(e){return"print"===e.data.command&&a(),o()})),Object(r.isToolPreview)()&&(window.doPrint=function(){return u(s,function(){window.clientApp&&window.clientApp.doPrint&&window.clientApp.doPrint()})})},7:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return i});n(1);var r=[];function o(e){r=e}function i(e){return r[e]&&""!==r[e]?r[e]:e}},70:function(e,t,n){"use strict";n.r(t),n.d(t,"addWeblinkIframe",function(){return i});var r=n(1),o=n.n(r);function i(e,t,n,r){var i=r&&""!==r?"onclick=\"setTimeout(function() { parent.postMessage({ msg:'"+r+"'}, '*');}, 1000);\" ":"",a=document.createElement("iframe");a.className="bwexternallink";var s='<body style="margin: 0px"><a style="display: block; width: 100%; height: 100%; background:red;" '+i+'href="'+t+'" target="_blank">&nbsp;</a></body>';e.appendChild(a),a.contentWindow.document.open(),a.contentWindow.document.write(s),a.contentWindow.document.close(),o()(a).css({position:"absolute",left:0,top:0,width:"100%",height:"100%"})}},71:function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,i,a;e.exports=(o=n(5),i=n(1),-1!==(a=o.getPlatform()).indexOf("android")?i.fn.extend({clickOnDraggable:function(e){return this.each(function(){var t=!1;this.ClickOnDraggableCallback=e,i(this).on("touchstart",function(e){var n=e.originalEvent?e.originalEvent:e;1===n.changedTouches.length&&1===n.touches.length&&n.changedTouches[1]===n.touches[1]?(t=!0,setTimeout(function(){t&&(console.error("touch takes too long"),t=!1)},100)):t=!1}),i(this).on("touchend",function(e){if(t){var n=e.originalEvent?e.originalEvent:e;1===n.changedTouches.length&&0===n.touches.length?(t=!1,this.ClickOnDraggableCallback()):t=!1}})})}}):i.fn.extend({clickOnDraggable:function(e){return this.each(function(){i(this).click(e)})}}),-1!==a.indexOf("android")||-1!==a.indexOf("preview")||-1!==a.indexOf("phantomjs")||-1!==a.indexOf("headlesschrome")||-1!==a.indexOf("chrome")||"ibw-platform-osx-safari"===a||"ibw-platform-osx-ibooks"===a||"ibw-platform-osx-ibooks-epub"===a||"ibw-platform-unknown"===a?i.fn.extend({tapOrClick:function(e){return this.each(function(){i(this).click(e);var t=this,n=i(this);n.is("button")||n.is("a")||n.on("keydown",function(n){var r=n.which;13!==r&&32!==r||e.bind(t)({preventDefault:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})})})},tapOrClickOff:function(){return this.each(function(){i(this).unbind("click");var e=i(this);e.is("button")||e.is("a")||e.off("keydown")})},triggerTapOrClick:function(e){return this.each(function(){i(this).trigger("click",e)})}}):i.fn.extend({tapOrClick:function(e){return this.each(function(){var t=this,n=i(this);n.addClass("epub-block"),n.find("*").each(function(){this instanceof SVGElement&&i(this).addClass("epub-block")});var r=!1;n.hammer?"ibw-platform-ipad-bookwidgets"===a||"ibw-platform-ipad-seb"===a||"ibw-platform-ipad-ibooks-epub"===a||"ibw-platform-ipad-ibooks"===a?n.hammer().on("tap",function(o){!1===r&&(e.bind(t)(o),r=!0,setTimeout(function(){r=!1},500)),n.blur(),o.stopImmediatePropagation()}):n.hammer().on("tap",function(r){e.bind(t)(r),n.blur(),r.stopImmediatePropagation()}):n.click(function(r){e.bind(t)(r),n.blur()}),(n.hammer||!n.is("button")&&!n.is("a"))&&n.on("keydown",function(n){var r=n.which;13!==r&&32!==r||e.bind(t)({preventDefault:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})})})},tapOrClickOff:function(){return this.each(function(){var e=i(this);e.hammer?e.hammer().off("tap"):e.unbind("click"),(e.hammer||!e.is("button")&&!e.is("a"))&&e.off("keydown")})},triggerTapOrClick:function(e){return this.each(function(){var t=i(this);t.hammer?t.hammer().trigger("tap",e):t.trigger("click",e)})}}),i.fn.extend({clickOrHold:function(e,t,n){return n=n||3e3,this.each(function(){var r=!1,o=null;i(this).click(function(t){r||e.bind(this)(t),r=!1}),i(this).on("keydown",function(t){var n=t.which;13!==n&&32!==n||e.bind(this)({prevent:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})}),i(this).on("mousedown touchstart",function(){var e=this;o=setTimeout(function(){o=null,r=!0,t.bind(e)()},n)}),i(this).on("mouseup touchend",function(){null!==o&&(clearTimeout(o),o=null),r&&setTimeout(function(){r=!1},400)})})}}),void i.fn.extend({makeButton:function(e){"string"==typeof(e=e||{})&&(e={label:e}),this.attr({role:e.hasOwnProperty("role")?e.role:"button"});var t=this.attr("tabindex");return"undefined"!==r(t)&&!1!==t||this.attr({tabindex:"0"}),e.hasOwnProperty("label")&&this.attr({"aria-label":e.label}),e.hasOwnProperty("labelledby")&&this.attr({"aria-labelledby":e.labelledby}),this},makeLink:function(e){return this.attr({role:"link",tabindex:"0"}),e&&this.attr({"aria-label":e}),this}}))},729:function(e,t,n){n(73);var r,o,i,a,s,u,l,c,d,f=(0,n(109).createDefaultContext)(),p=f.widgetstorage,h=f.StudentWorkSubmitter,g=n(730),m=g.prepare_calculate,v=g.calculate;e.exports=(r=n(22),o=n(189),i=n(25),n(5),a=n(40),s=n(1),u=n(21),l=n(17),c=n(175),d=n(110).default,void s(function(){return r.getConfig().then(function(e){a.makeWidget({layout:"title_toolbar_layout",title:i.prepare(e.title),instructions:e.instructions,uuid:e.uuid2}),i.processMathElems(s("#title"));var t=d(),n=!0,r=0,f=[],g=m(e.sheets);function b(e,t,n){return f[e].table.data[t][n]}function w(){n||function(e){for(var t=0;t<e.length;++t){var n=e[t];f[n.sheet].table.data[n.row][n.column]=n.val}}(v(e.sheets,g,b))}function y(){a.centerTitle(!0);var e=s(f[r].div).parent(),t=s("#data-area"),n=t.height(),o=t.width();e.css({"max-width":o,"max-height":n})}for(var C=0;C<e.sheets.length;++C){var D="dataTable_"+C,A=s(document.createElement("div")).addClass("tablewrapper center-centered").append(s(document.createElement("div")).attr("id",D)).appendTo("#data-area");C>0&&A.hide();var E=o({tablediv:"#"+D,tabledata:e.sheets[C].tabledata,calculate:w,spellcheck:!0});s(document.createElement("span")).addClass("sheettab").attr("index",C+"").safeHtml(e.sheets[C].listentryname).appendTo("#sheettabs"),f.push({div:"#"+D,table:E})}function _(){for(var e={inputCellCount:0,changedCellCount:0},n=0;n<f.length;++n){var r=f[n].table.getProgress();e.inputCellCount+=r.inputCellCount,e.changedCellCount+=r.changedCellCount}t.setProgress(e.changedCellCount,e.inputCellCount)}function S(){for(var e=0;e<f.length;++e)f[e].table.clear()}s(".sheettab").click(function(){s(".sheettab.selected").removeClass("selected"),s(f[r].div).parent().hide(),r=parseInt(s(this).attr("index")),s(f[r].div).parent().show(),f[r].table.render(),y(),s(this).addClass("selected")}),s(".sheettab[index='0']").addClass("selected"),e.sheets.length<2&&s("#sheettabs").hide(),n=!1,s("#clearbutton").click(function(){u.showConfirmationDialog(l("The spreadsheet will be permanently deleted and cannot be recovered. Are you sure?"),l("Clear the spreadsheet and start over?"),function(){S(),t.restart()},null,l("Yes, clear"),l("No, keep"))});var k=!1;function x(){k||(saveInputValues(),_()),y()}for(saveInputValues=function(){var t;if(1==f.length)t=f[0].table.getData();else{t={};for(var n=0;n<f.length;++n)t[e.sheets[n].listentryname]=f[n].table.getData()}"yes"==e.save_answers&&p.write(JSON.stringify(t))},p.init({type:"Table",group:""==e.book_title?"_no_name_":e.book_title,name:e.title,id:e.uuid2,updateCallback:function(t){k=!0;try{if(S(),"yes"==e.save_answers&&null!==t&&""!==t){var n=JSON.parse(t);if(1==f.length)f[0].table.setData(n);else for(var r=0;r<f.length;++r){var o=e.sheets[r].listentryname;n.hasOwnProperty(o)?f[r].table.setData(n[o]):console.warn("No data for "+o)}_()}}catch(e){console.error("Exception occurred when loading data"),console.error(e)}k=!1},singleKey:!0,extension:".TableInputs"}),C=0;C<f.length;++C)f[C].table.setChangeCallBack(x);function O(){for(var e=[],t=0;t<f.length;++t)e.push(f[t].table.getEmailTable(!1));return e.join("<br>")}y(),setTimeout(function(){w(),s(f[r].div).bwtable("render")},100),setTimeout(y,200),window.onresize=y,c({config:e,defaultName:"Spreadsheet",getAnswers:function(t){var n=[];return n.push({answer:O(),question:e.title,score:0,outof:parseFloat(e.maximum_score)||0,correctness:-2}),n},submitSuccessMessage:l("Your spreadsheet was sent successfully!"),submitFailedTitle:l("Spreadsheet could not be sent."),submitFailedMessage:l("Unable to send spreadsheet. Make sure you're connected to the internet."),sendDialogMessage:l("Complete the form and click send to submit your spreadsheet to your teacher."),shareDialogMessage:l("Complete the form and click send to email your spreadsheet.")},h,u)}),null}))},73:function(e,t,n){"use strict";n.r(t),function(e){n(125),n(126),n(127),n(128),n(129),n(130),n(75),n(131),n(132);void 0===e&&(window.global=window)}.call(this,n(108))},730:function(e,t,n){"use strict";n.r(t),n.d(t,"prepare_calculate",function(){return f}),n.d(t,"calculate",function(){return p});var r=n(520),o=n.n(r),i=n(521),a=n.n(i),s=new o.a;function u(e,t,n){try{var r=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),o="="===r.charAt(0)?r.substr(1):r;return s.parse(o,n).collapseranges().evaluate(t)}catch(e){return console.error(e.message),"ERROR: "+e.message}}function l(e,t){try{for(var n="="===e.charAt(0)?e.substr(1):e,r=s.parse(n,t).expandranges().variables(),o=[],i=0;i<r.length;++i){var a=r[i];s.functions.hasOwnProperty(a)||o.push(a)}return o}catch(e){return console.error(e.message),[]}}function c(e,t,n){return e+"!"+function(e){for(var t="";e>=0;e=parseInt(e/26)-1)t="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[e%26]+t;return t}(n)+(t+1)}function d(e){return e.listentryname.replace(/ /g,"_")||"default"}function f(e){for(var t,n,r,o,i=[],s=[],u={},f=0;f<e.length;++f){var p=e[f].tabledata,h=d(e[f]),g=p&&p.values||[];for(t=0;t<g.length;++t){var m=g[t];for(n=0;n<m.length;++n){var v=m[n],b=c(h,t,n),w={h:f,i:t,j:n,id:b,calculated:v.hasOwnProperty("CellRole")&&"calculated"===v.CellRole,edges:[]};v.hasOwnProperty("CellRole")&&"calculated"===v.CellRole?w.vars=l(v.value,h):w.vars=[],u[b]=s.length,s.push(w)}}}for(t=0;t<s.length;++t)for(r=s[t],n=0;n<r.vars.length;++n){var y=u[r.vars[n]];void 0!==y&&r.edges.push(y)}try{o=a()(s)}catch(e){return console.error(e),alert(e),[]}for(t=0;t<o.length;++t)(r=s[o[t]]).calculated&&i.unshift(r);return i}function p(e,t,n){if(void 0===p.calculating&&(p.calculating=!1),p.calculating)return[];var r=[];p.calculating=!0;var o,i,a,s,l,f,h,g={};for(o=0;o<e.length;++o){h=e[o].tabledata,f=d(e[o]);var m=h&&h.values||[];for(i=0;i<m.length;++i)for(s=m[i],a=0;a<s.length;++a)(l=s[a]).hasOwnProperty("CellRole")&&"input"!==l.CellRole&&"readonly"!==l.CellRole||(g[c(f,i,a)]=n(o,i,a))}for(var v=0;v<t.length;++v)if(o=(l=t[v]).h,i=l.i,a=l.j,h=e[o].tabledata,f=d(e[o]),(l=(s=h.values[i])[a]).hasOwnProperty("CellRole")&&"calculated"===l.CellRole){var b=u(l.value,g,f);g[c(f,i,a)]=b,r.push({sheet:o,row:i,column:a,val:b})}return p.calculating=!1,r}delete s.consts.E},74:function(e,t,n){var r=n(14).map;e.exports={url:function(e,t){var n="js2objc://"+e;return t&&(n+="?"+r(t,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")),n}}},75:function(e,t){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){"use strict";if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r){r=Object(r);for(var o=Object.keys(Object(r)),i=0,a=o.length;i<a;i++){var s=o[i],u=Object.getOwnPropertyDescriptor(r,s);void 0!==u&&u.enumerable&&(t[s]=r[s])}}}return t}})},76:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n(16),i=n(33),a=i.loadJS,s=i.loadCSS,u=!1,l=!1,c=new RegExp("https://www.bookwidgets.com/create/api/widgets/[0-9]+/preview/config.(css||js)?"),d=new RegExp("http://localhost(:[0-9]+)?/create/api/widgets/[0-9]+/preview/config.(css||js)?");function f(e){return window.WidgetParams?e:0===window.location.pathname.indexOf("/_ah/gcs/bookwidgets-eu--widgets/")?0===e.search(d)?e:window.location.origin+"/_ah/gcs/bookwidgets-eu--widget-assets"+e:window.location.host.startsWith("widgets-eu.")?0===e.search(c)?e:window.location.host.replace("widgets-eu.","//widget-assets-eu.")+e:e}t.default=function(){var e=o.getParameters(!1);e.dbg5&&n(134)({apiKey:e.dbg5,autoCaptureSessions:!1,notifyReleaseStages:["production"],releaseStage:"production",beforeSend:function(e){return 1!==e.stacktrace.length||1!==e.stacktrace[0].lineNumber}});var t=r.Deferred();if(!1===l&&!1===u){u=!0;var i=f(e.content)||"config.js",c=f(e.design)||"config.css";r.when(a(i),s(c)).fail(function(){t.reject(new Error("Unable to load config file"))}).always(function(e,n){n&&r(n).attr("id","designconfig"),u=!1,l=!1;var o=window.widgetconfig;t.resolve(o),-1===navigator.userAgent.indexOf("ibookwidgets")&&(window.widgetconfig=void 0)})}return t}},77:function(e,t,n){function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=n(14).uniq;e.exports=function(e){var t=[];var n=0,i=0,a=null;function s(e){console.log("Select design element",e),void 0!==window.previewsidebar?window.previewsidebar.setSelectedItem(e):window.parent.postMessage({command:"select-design-element",element:e})}function u(){e(".bw-design-tooltip").remove()}function l(l){var c=l.target;e(c).is(".bw-design-tooltip")||e(c).is(".bw-design-tooltip a")||n!==c&&(0===i&&u(),clearTimeout(i),n=c,i=setTimeout(function(n){i=0;var u=!1,l=e(n),c=function(){var n={};e.each(t,function(e,t){var o=r(t,2),i=o[0],a=o[1];try{if(l.is(i)){var s=l.offset().top+"_"+l.offset().left;n[s]?n[s].elements.push(a):n[s]={offset:l.offset(),elements:[a]},u=!0}}catch(e){}}),e.each(n,function(t,n){var r=e(document.createElement("div")).addClass("bw-design-tooltip").attr("data-design-element",n.elements[0]).css({position:"absolute",top:n.offset.top,left:n.offset.left}).appendTo("body");e.each(o(n.elements),function(t,n){e(document.createElement("a")).text(a&&a[n]?a[n]:n).attr("href","#").click(function(e){s(n),e.stopPropagation(),e.preventDefault()}).appendTo(r)})}),l=l.parent()};do{c()}while(!1===u&&l.length>0)}.bind(null,c),400))}function c(){var t=e(".bw-design-tooltip");0!==t.length&&s(t.attr("data-design-element"))}window.activateDesignInfoTooltips=function(e){a=e,window.addEventListener("mousemove",l),window.addEventListener("click",c)},window.disableDesignInfoTooltips=function(){u(),window.removeEventListener("mousemove",l),window.removeEventListener("click",c)};var d=[],f=!1;var p=!1;window.BwNotifyWidgetLoaded=function(){p||(p=!0,window.parent.postMessage("BwWidgetLoaded","*"),window.clientApp&&window.clientApp.widgetLoaded&&window.clientApp.widgetLoaded())};var h=!0;function g(){for(;d.length>0;){d.shift()()}h&&window.BwNotifyWidgetLoaded()}return window.BwUseManualWidgetLoadedNotification=function(){h=!1},function(n){if("bwshortcode"in n&&(window.bwshortcode=n.bwshortcode),"pre"in n&&(console.log("Preview"),"designinfo"in n)){for(var r=0;r<n.designinfo.length;++r)o=n.designinfo[r].s,i=n.designinfo[r].d,t.push([o,i]);"undefined"!=typeof previewsidebar?(console.log("Previewsidebar is defined, immediately set design config"),e(function(){var e;e=function(){window.CssUpdateCounter&&(console.log("has CssUpdateCounter -> updating configCss"),window.updateConfigCSS(window.CssUpdateCounter)),setTimeout(function(){window.activateDesignInfoTooltips()},3e3)},f?setTimeout(e,0):d.push(e)})):(window.parent.postMessage({command:"enable-design-config-support"}),window.addEventListener("beforeunload",function(){window.parent.postMessage({command:"disable-design-config-support"})}))}var o,i;if("bra"in n&&e(function(){"iPad"===navigator.platform&&-1!==navigator.userAgent.indexOf("BookWidgets")||e(document.createElement("div")).addClass("branding").appendTo("body")}),"tri"in n&&e(function(){if("iPad"===navigator.platform||-1===navigator.userAgent.indexOf("BookWidgets")&&-1===navigator.userAgent.indexOf("ibookwidgets")){e(document.createElement("div")).addClass("dialog-sheet").attr("id","preview_alert").css({color:"red","text-shadow":"none"}).append(e(document.createElement("p")).safeHtml("This is a free preview widget, created using a trial version of BookWidgets. <b>This widget may only be used for demonstration and evaluation purposes!</b>")).append(e(document.createElement("p")).text("Please purchase a license key for the BookWidgets tool to remove this message.")).appendTo("body");var t=e(document.createElement("div")).addClass("dialog-sheet-shadow");e(document.body).append(t),window.CreateDialogSheetFor("#preview_alert"),setTimeout(function(){e("#preview_alert").data("dialogSheet").show()},2e3),setTimeout(function(){e("#preview_alert").data("dialogSheet").hide()},6e3),setTimeout(function(){e("#preview_alert").data("dialogSheet").show()},3e4),setTimeout(function(){e("#preview_alert").data("dialogSheet").hide()},34e3)}}),void 0===String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}),window.getWidgetUrl=function(){return window.location.href},window.bwbackbuttonlabel=null,"performance"in window==!1&&(window.performance={}),"now"in window.performance==!1){var a=Date.now();window.performance.timing&&window.performance.timing.navigationStart&&(a=window.performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}return n.hasOwnProperty("backbutton_label")&&""!==n.backbutton_label&&(window.bwbackbuttonlabel=n.backbutton_label),"Vertical"===n.widget_orientation?e("html").addClass("vertical"):e("html").addClass("horizontal"),null!=n.widget_language&&""!==n.widget_language&&e("html").attr("lang",n.widget_language),n.hasOwnProperty("LocalizationMap")&&(window.bwlocalizationmap=n.LocalizationMap),setTimeout(g,0),null}}(n(1))},78:function(e,t,n){"use strict";n.r(t),t.default=function(e){return"undefined"==typeof window||window.navigator&&window.navigator.userAgent&&(window.navigator.userAgent.indexOf("PhantomJS")>=0||window.navigator.userAgent.indexOf("ibookwidgets")>=0)?e:(new window.DOMParser).parseFromString("<html>"+e+"</html>","text/html").documentElement.textContent}},79:function(e,t,n){e.exports=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e(document.createElement("div")).addClass("bw-throbber-wrapper bw-centering-container").appendTo(t),i=e(document.createElement("canvas")).addClass("bw-throbber bw-centered").attr({width:n,height:n}).appendTo(o),a=i[0].getContext("2d");a.translate(n/2,n/2);for(var s=30*n/100,u=0;u<s;++u){a.rotate(2*-Math.PI/s);var l=r?0:255;a.strokeStyle="rgba("+l+","+l+","+l+","+(1/s).toFixed(2)+")",a.lineWidth=3,a.moveTo(n/5,0),a.lineTo(2*n/5,0),a.stroke()}var c=null,d=!1;return window.requestionAnimationFrame&&window.requestAnimationFrame(function e(t){if(c||(c=t),!d){var n="rotate("+360*Math.floor(t/1e3*s)/s+"deg)";i.css({transform:n,"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n}),window.requestionAnimationFrame&&window.requestAnimationFrame(e)}}),{close:function(){o.remove(),d=!0}}}}(n(1))},8:function(e,t,n){"use strict";function r(e){for(var t={},n=e.split("&"),r=0;r<n.length;r++){var o=n[r].indexOf("=");if(!(o<0)){var i=[n[r].substr(0,o),n[r].substr(o+1)],a=decodeURIComponent(i[0]);if(void 0===t[a])t[a]=decodeURIComponent(i[1]);else if("string"==typeof t[a]){var s=[t[a],decodeURIComponent(i[1])];t[a]=s}else t[a].push(decodeURIComponent(i[1]))}}return t}function o(e){return-1===e.indexOf("?")?{}:r(e.replace(/[^?]*\?/,"").replace(/#.*/,""))}var i=/^(https?:\/\/)?((www\.)?youtube\.com\/(v|embed|u|w)|youtu\.be)\/([^?&#]+)/,a=/^(https?:\/\/)?(www\.)?youtube\.com\/watch\?(.*)/;function s(e){var t;return null!=(t=e.match(i))?t[5]:null!=(t=e.match(a))?r(t[3].split("#")[0]).v:null}function u(e){return-1!==(e=e.split("#")[0]).indexOf("?")?e:e.replace("&","?")}function l(e){var t=o(u(e));return null!=t.t?function(e){var t=e.match(/(([0-9]+)m)?([0-9]+)s/);if(null==t)return 0;var n=parseInt(t[3]);return t[2]&&(n+=60*parseInt(t[2])),n}(t.t)+"":null!=t.start?t.start:null}function c(e){var t=o(u(e));return null!=t.end?t.end:null}function d(e){return o(e).cc_load_policy}function f(e){return o(e).cc_lang_pref}function p(e){var t=[],n=l(e);null!=n&&t.push("start="+n);var r=c(e);null!=r&&t.push("end="+r);var o=d(e);null!=o&&t.push("cc_load_policy="+o);var i=f(e);return null!=i&&t.push("cc_lang_pref="+i),0===t.length?"":"?"+t.join("&")}function h(e){return null!=s(e)}var g=[/^(https?:\/\/)?vimeo.com\/(\d+)/,/^(https?:\/\/)?vimeo.com\/album\/[^/]+\/video\/([0-9]+)/,/^(https?:\/\/)?vimeo.com\/channels\/[^/]+\/([0-9]+)/,/^(https?:\/\/)?vimeo.com\/groups\/[^/]+\/video\/([0-9]+)/,/^(https?:\/\/)?vimeo.com\/ondemand\/[^/]+\/video\/([0-9]+)/];function m(e){for(var t=0;t<g.length;++t){var n=e.match(g[t]);if(null!=n)return n[2]}return null}function v(e){return o(e).texttrack}var b=/^(https?:\/\/)?(www\.)?giphy\.com\/(embed|gifs)\/([^/?]+)/,w=/^((https?:)?\/\/)?media.giphy.com\/media\/([^/]+)/;function y(e){var t=e.match(b);return null!=t?t[4]:null!=(t=e.match(w))?t[3]:null}function C(e){return h(e)}function D(e){return h(e)}function A(e){var t=s(e);return null!=t?t:e}function E(e){return function(e){return null!=m(e)}(e)}function _(e){var t=m(e);return null!=t?t:e}function S(e){return function(e){return null!=y(e)}(e)}function k(e){var t=y(e);return null!=t?t:e}n.d(t,"m",function(){return C}),n.d(t,"l",function(){return D}),n.d(t,"h",function(){return A}),n.d(t,"k",function(){return E}),n.d(t,"e",function(){return _}),n.d(t,"j",function(){return S}),n.d(t,"c",function(){return k}),n.d(t,"g",function(){return l}),n.d(t,"f",function(){return c}),n.d(t,"b",function(){return d}),n.d(t,"a",function(){return f}),n.d(t,"i",function(){return p}),n.d(t,"d",function(){return v})},80:function(e,t,n){"use strict";n.r(t),n.d(t,"instructionsAreEmpty",function(){return h}),n.d(t,"showInfoPopup",function(){return g}),n.d(t,"prepareInfoPopup",function(){return m}),n.d(t,"showInfoPopupIfFirstTimeInSession",function(){return v});var r=n(0),o=n.n(r),i=n(53),a=n.n(i),s=n(1),u=n.n(s),l=n(39),c=n(37),d=n(54),f=n.n(d),p=n(30);function h(e){return!e||(!e.instructions||!!Object(p.isEmptyRichText)(e.instructions))}function g(e){if(!h(e)){var t=u()(document.createElement("div")).css({position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%"}).appendTo("body"),n=o.a.createElement(l.b,null,o.a.createElement(l.a,{className:f.a.InstructionsDialog,title:e.instructions_title||"",onOk:function(){t.remove()},onClose:function(){t.remove()}},o.a.createElement(c.a,{text:e.instructions||""})));a.a.render(n,t[0])}}function m(e){if(!h(e)){var t=u()("#title-toolbar");0===t.length&&(t=u()(document.createElement("div")).attr("id","title-toolbar").prependTo("body")),u()(document.createElement("div")).addClass("bw-toolbutton").append(u()(document.createElement("div")).addClass("bw-icon bw-icon-info")).makeButton(e.instructions_title||"").tapOrClick(g.bind(null,e)).prependTo(t)}}function v(e,t){if(!h(e))if(t){var n=t+"/instructions_shown";try{if("true"===sessionStorage.getItem(n))return}catch(e){}g(e);try{sessionStorage.setItem(n,"true")}catch(e){}}else g(e)}},81:function(e,t,n){},82:function(e,t,n){},83:function(e,t,n){var r=n(42);e.exports=function(e){window.addEventListener("message",function(t){var n=t.data;"set-css"===n.command?(!function(t){e("style[id='designconfig'], link[id='designconfig']").remove();var n=document.createElement("style");n.id="designconfig",n.type="text/css",n.appendChild(document.createTextNode(t)),document.head.appendChild(n)}(n.css),r.executeCssUpdateCallbacks()):"show-css-config-elements"===n.command?window.activateDesignInfoTooltips(n.translations):"hide-css-config-elements"===n.command&&window.disableDesignInfoTooltips()})}(n(1))},87:function(e,t,n){e.exports=function(e){var t={},n=function(e){return e<10?"0"+e:""+e};function r(e){var t=Array.prototype.slice.call(arguments,1);try{e&&e.apply(null,t)}catch(e){console.log("Received error when executing callback: "+e)}}return t.getDateTime=function(){var e=new Date;return n(e.getFullYear())+"-"+n(1+e.getMonth())+"-"+n(e.getDate())+" "+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())},t.error=function(e,t){return{code:e,message:t}},t.trimLeadingSlash=function(e){return e.length>0&&"/"==e[0]?e.substr(1):e},t.newCallbackQueue=function(){var e={executeList:[],executing:!1,executeNext:function(){e.executeList.length>0?(e.executing=!0,e.executeList.shift().cb(e.executeNext)):e.executing=!1},executeSequential:function(t,n){if(null!=n&&!1!==n&&null!=n&&e.executeList.length>0)for(var r=0;r<e.executeList.length;++r)e.executeList[r].tag==n&&e.executeList.splice(r,1);e.executeList.push({cb:t,tag:n}),e.executing||e.executeNext()}};return e},t.callSafe=r,t.handleException=function(n,o,i){18==n.code?r(o,t.error(e.BWDS_ERROR_SECURITY,"AsyncBWDS Security Error: problem when accessing: "+JSON.stringify(n))):r(o,t.error(e.BWDS_ERROR_INTERNAL,"AsyncBWDS Error: problem when accessing: "+JSON.stringify(n))),i&&i()},t}(n(46))},88:function(e,t,n){var r=n(74);e.exports=function(e,t){var o=n(26).createLogger("NativeSQLAsyncKeyStore"),i=new e;i.startListening();return function(e){e=e||function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),t.setAttribute("height","1px"),t.setAttribute("width","1px"),document.documentElement.appendChild(t),t.parentNode.removeChild(t),t=null};var t={};function n(e){var t=String.fromCharCode(29);return(e=e.map(function(e){return e.replace(new RegExp(",","g"),t)})).join()}return t.resultForCallback=function(e,t){i.processCallback(e,t)},t.runningInIframe=function(){try{return window.self!==window.parent}catch(e){return!0}},t.callObjC=function(n,o,a,s){var u=r.url(n,o),l=i.registerCallbacks(a,s),c="'"+l.ok+"'",d="'"+l.error+"'",f="window.BWKSNativeSQL.resultForCallback";t.runningInIframe()&&(f="function BWKSNativeSQL_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; BWKSNativeSQL_callback_wrapper"),e(u+"&okCallbackId="+c+"&errorCallbackId="+d+"&callbackFunc="+f)},t.getItemsAsync=function(e,r,i){if(0==e.length)return o.error("NativeSQL Error: getItemsAsync without names"),void i({message:"NativeSQL Error: getItemsAsync without names"});t.callObjC("getItemsAsync",{names:n(e)},r,i)},t.getDirAttribs=function(e,n,r){t.callObjC("getDirAttribsAsync",{dirname:e},n,r)},t.setItemsAsync=function(e,n,r){if(0==e.length)return o.error("NativeSQL Error: setItemsAsync without names"),void r({message:"setItemsAsync without names"});if(e.length>1)return o.error("NativeSQL Error: setItemsAsync can only handle 1 item"),void r({message:"setItemsAsync can only handle 1 item"});var i=e[0];t.callObjC("setItemAsync",{keyname:i.key,value:i.value,attribs:i.attribs},n,r)},t.removeItemsAsync=function(e,r,i){if(0==e.length)return o.error("NativeSQL Error: removeItemsAsync without names"),void i({message:"NativeSQL Error: removeItemsAsync without names"});t.callObjC("removeItemsAsync",{names:n(e)},r,i)},t}}(n(58))},89:function(e,t,n){var r,o,i,a,s,u,l,c,d,f,p,h,g,m,v;e.exports=(r=n(5),o=n(111).f(),i=n(112),a=n(114),s=n(88),n(46),u=n(116),c=new(n(117))(o),d=new i,f=new u(d),p=new a,h=new u(p),g=new s,m=new u(g),"ibw-platform-ipad-bookwidgets"===(v=r.getPlatform())?(l=m,window.BWKSNativeSQL=g,console.log("BWDS: Native")):"ibw-platform-ipad-ibooks"!==v&&"ibw-platform-osx-chrome"!==v&&"ibw-platform-win32-chrome"!==v&&"ibw-platform-chromebook-chrome"!==v&&"ibw-platform-android-chrome"!==v&&"kotobee:"!==window.location.protocol||!window.indexedDB?"ibw-platform-osx-preview"!==v&&"ibw-platform-win32-preview"!==v||!window.openDatabase?(l=c,console.log("BWDS: Local")):(console.log("BWDS: WebSQL"),l=f):(console.log("BWDS: IndexedDB"),l=h),l.test={BWKSIDB:p,BWKSWebSQL:d,BWDSLocal:c,BWDSWebSQL:f},-1!==navigator.userAgent.indexOf("ibookwidgets")&&(window.BWDS=l),l)},9:function(e,t,n){"use strict";n.r(t),n.d(t,"parseCharge",function(){return c}),n.d(t,"parseFormula",function(){return d}),n.d(t,"parseEquation",function(){return p}),n.d(t,"formatFormula",function(){return h}),n.d(t,"formatIon",function(){return g}),n.d(t,"formatEquation",function(){return v}),n.d(t,"matchOrder",function(){return C}),n.d(t,"reduceReactantsAndProducts",function(){return D}),n.d(t,"isBalanced",function(){return A}),n.d(t,"matchIon",function(){return E}),n.d(t,"splitFormulaInIons",function(){return _}),n.d(t,"reduceIons",function(){return S}),n.d(t,"joinIonsToFormula",function(){return k}),n.d(t,"totalCharge",function(){return x}),n.d(t,"equalFormulas",function(){return O});var r=n(10),o=n.n(r),i=function(e){return!isNaN(1*e)},a=function(e){var t=e.charCodeAt(0);return t>=65&&t<=90||t>=97&&t<=122},s=function(e){return a(e)&&e===e.toUpperCase()},u=function(e){return a(e)&&e===e.toLowerCase()},l=function(e,t,n,r,i){var a;if(t)if(""===n&&(n=1),o()(t)&&"1"===n)for(var s=0;s<t.length;++s)a={atom:t[s].atom,qty:parseInt(t[s].qty)},s===t.length-1&&(0!==r&&(a.charge=r),""!==i&&(a.phase=i)),e.push(a);else a={atom:t,qty:parseInt(n)},0!==r&&(a.charge=r),""!==i&&(a.phase=i),e.push(a)},c=function(e){for(var t="",n=0,r=0;r<e.length;++r){var o=e.charAt(r);if(i(o))t+=o;else if("+"===o){if(n=1,r!==e.length-1)return 0}else{if("-"!==o)return 0;if(n=-1,r!==e.length-1)return 0}}return parseInt(t)*n},d=function e(t){var n=[],r="",o="",a=0,d="";if(-1!==t.indexOf("!")||-1!==t.indexOf("@")||-1!==t.indexOf("#")||-1!==t.indexOf("$"))return[];var f=t+"H";f=f.replace(/\(s\)/g,"!").replace(/\(aq\)/g,"@").replace(/\(g\)/g,"#").replace(/\(l\)/g,"$");for(var p=0;p<f.length;++p){var h=f.charAt(p);if(s(h))l(n,r,o,a,d),r=h,o="",d="",a=0;else if(u(h)){if(!r)return[];r+=h}else if(i(h)){if(!r)return[];o+=h}else if("("===h){for(var g=!1,m=p+1;m<f.length;++m)if(")"===f.charAt(m)){g=!0;break}if(!g)return[];if(!i(f.charAt(m+1)))return[];if(l(n,r,o,a,d),0===(r=e(f.substring(p+1,m))).length)return[];o="",d="",a=0,p=m}else if("{"===h){for(g=!1,m=p+1;m<f.length;++m)if("}"===f.charAt(m)){g=!0;break}if(!g)return[];var v=f.substring(p+1,m);a=c(v),p=m}else if("!"===h){if(""!==d)return[];d="s"}else if("@"===h){if(""!==d)return[];d="aq"}else if("#"===h){if(""!==d)return[];d="g"}else{if("$"!==h)return[];if(""!==d)return[];d="l"}}return n},f=function(e,t){for(var n="",r=0;r<e.length;++r){var o=e.charAt(r);if(!i(o)){n=""===n?1:parseInt(n);var a=d(e.substring(r));return 0!==a.length&&(t.push({formula:a,qty:n}),!0)}n+=o}return console.error("Chemistryparser parseTerm: This should never happen"),!1},p=function(e){var t=e.replace(/ /g,"").split("=");if(2!==t.length)return{reactants:[],products:[]};for(var n=t[0].replace(/\+\}/g,"*}").split("+"),r=t[1].replace(/\+\}/g,"*}").split("+"),o=[],i=[],a=0;a<n.length;++a){var s=n[a].replace(/\*\}/g,"+}");if(!f(s,o))return{reactants:[],products:[]}}for(a=0;a<r.length;++a){s=r[a].replace(/\*\}/g,"+}");if(!f(s,i))return{reactants:[],products:[]}}return{reactants:o,products:i}},h=function e(t){for(var n="",r=0;r<t.length;++r){var i=t[r];o()(i.atom)?i.qty>1?n=n+"("+e(i.atom)+")":n+=e(i.atom):n+=i.atom,i.qty>1&&(n=n+"_{"+i.qty+"}"),i.phase&&(n=n+"("+i.phase+")")}return n},g=function(e){var t=h(d(e.ion))+"^{";return 1===e.charge?t+="+":-1===e.charge?t+="-":e.charge>0?t+=e.charge+"+":t+=-e.charge+"-",t+="}"},m=function(e,t){for(var n=[],r=0;r<e.length;++r){var o=e[r],i="";t||1===o.qty||(i=o.qty+" \\, "),i+=h(o.formula),t?n.push({formula:i,qty:o.qty}):n.push(i)}return n},v=function(e,t){return{reactants:m(e.reactants,t),products:m(e.products,t)}},b=function(e){for(var t=[],n=0;n<e.length;++n)for(var r=e[n].formula,i=e[n].qty,a=0;a<r.length;++a){var s=r[a];if(o()(s.atom))for(var u=0;u<s.atom.length;++u)t.push({atom:s.atom[u].atom,qty:s.atom[u].qty*s.qty*i});else t.push({atom:s.atom,qty:s.qty*i})}return t},w=function(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n],o=!1,i=0;i<t.length;++i){var a=t[i];if(r.atom===a.atom){a.qty=a.qty+r.qty,o=!0;break}}o||t.push(r)}return t},y=function(e,t){for(var n=0;n<e.length;++n)if(e[n].atom===t)return n;return-1},C=function(e,t){for(var n=0,r=0;r<e.length;++r){var o=y(t,e[r].atom);if(o===n)++n;else if(o>=n){var i=t.splice(o,1)[0];t.splice(n,0,i),++n}}},D=function(e){var t=b(e.reactants),n=b(e.products);return t=w(t),n=w(n),C(t,n),{reactants:t,products:n}},A=function(e){var t=p(e),n=D(t);if(0===n.reactants.length)return!1;if(n.reactants.length!==n.products.length)return!1;for(var r=0;r<n.reactants.length;++r){var o=n.reactants[r],i=n.products[r];if(i.atom!==o.atom||i.qty!==o.qty)return!1}return!0},E=function(e,t){var n=1;if(o()(e[0].atom)){if(n=e[0].qty,e=e[0].atom,t.pattern.length!==e.length)return 0}else if(t.pattern.length>e.length)return 0;for(var r=0;r<t.pattern.length;++r){var i=t.pattern[r],a=e[r];if(i.atom!==a.atom)return 0;if(1===t.pattern.length)n=a.qty;else if(i.qty!==a.qty)return 0}return n},_=function(e,t){for(var n=[],r=d(e);r.length>0;){for(var o={ion:{pattern:[]}},i=0;i<t.length;++i){var a=t[i],s=E(r,a);s>0&&a.pattern.length>o.ion.pattern.length&&(o={ion:a,qty:s})}if(!(o.ion.pattern.length>0))return console.error("Error: formula contains unknown ions!"),console.error("Partial match: "),console.error(n),console.error("Head of parsedFormula:"),console.error(r),[];n.push({ion:o.ion.ion,charge:o.ion.charge,qty:o.qty}),o.qty>1?r.splice(0,1):r.splice(0,o.ion.pattern.length)}return n},S=function(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n],o=!1,i=0;i<t.length;++i){var a=t[i];if(r.ion===a.ion.ion&&r.charge===a.ion.charge){a.qty++,o=!0;break}}o||t.push({ion:r,qty:1})}return t},k=function(e){e=S(e);for(var t=[],n=0;n<e.length;++n){var r=e[n];1===r.ion.pattern.length?t.push({atom:r.ion.pattern[0].atom,qty:r.qty}):t.push({atom:r.ion.pattern,qty:r.qty})}return function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];if(o()(r.atom))if(1===r.qty)for(var i=0;i<r.atom.length;++i)t.push({atom:r.atom[i].atom,qty:r.atom[i].qty});else t.push(r);else t.push(r)}return t}(t)},x=function(e){for(var t=0,n=0;n<e.length;++n)t+=e[n].charge;return t},O=function e(t,n){if(t.length!==n.length)return!1;for(var r=0;r<t.length;++r){if(t[r].qty!==n[r].qty)return!1;if(o()(t[r].atom)){if(!o()(n[r].atom))return!1;if(!e(t[r].atom,n[r].atom))return!1}else if(t[r].atom!==n[r].atom)return!1}return!0}},90:function(e,t,n){e.exports=function(e,t,r,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(5),a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(65),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n(88);var u=r.isLTI()||t.getParameters().sso;return u&&console.log("Using session storage for credentials"),"ibw-platform-ipad-bookwidgets"===i.getPlatform()?new function(t){this._storage=t,this.setCredentials=function(t){var n=this;return e.Deferred(function(e){n._storage.setItemsAsync([{key:"BwCredentials",value:JSON.stringify(t),attribs:""}],function(){e.resolve()},function(){e.reject()})})},this.getCredentials=function(){var t=this;return e.Deferred(function(e){t._storage.getItemsAsync(["BwCredentials"],function(t){try{var n=JSON.parse(t.BwCredentials.value);e.resolve(n)}catch(t){e.reject()}},function(){e.reject()})})}}(new s):new function(t){this.setCredentials=function(n){return e.Deferred(function(e){try{t.SetItem("BwCredentials",JSON.stringify(n)),e.resolve()}catch(t){e.reject()}})},this.getCredentials=function(){return e.Deferred(function(e){try{var n=JSON.parse(t.GetItem("BwCredentials"));e.resolve(n)}catch(t){e.reject()}})}}(u?o:a)}.bind(null,n(1),n(16),n(45),n(119))},91:function(e,t,n){var r=function(e,t,n){var r=n.bwConfig,o=n.studentaccount,i=n.bwdsstorage,a=n.writecachingonlinestorage,s={},u=e.Deferred();s.initialized=function(){return u};var l=t.getParameters(),c=l.hasOwnProperty("teacher_id")?l.teacher_id:"",d=l.hasOwnProperty("school_id")?l.school_id:"";return r.getConfig().then(function(t){var n="no"!==t.save_answers;function r(e){return"student_name"==e||"student_email"==e||"student_id"==e}var l=null,f=-1;function p(r){if(u.resolve(),r==f)return console.log("Warning: setting identical storage state, ignoring"),e.when();var s=t.book_title&&""!==t.book_title?t.book_title:"_no_name_";switch(r){case o.ANONYMOUS:l=i.createInfoStorage(s,"",n);break;case o.OFFLINE:l=i.createInfoStorage(s,o.getUserId(),n);break;case o.ONLINE:l=a.createInfoStorage(s,c,d)}return f=r,e.when()}s.get=function(e,t){if(f!=o.ANONYMOUS&&o.hasProperty(e))t(o.getProperty(e));else if(n){var i=function(n){t(n[e])};if(null==l)return void t(null);r(e)?l.getCommonProperties(i):l.getGroupProperties(i)}else t(null)},s.set=function(e,t){if(f!=o.ANONYMOUS&&o.hasProperty(e))console.log("Request setting read-only property... skipping");else if(n){var i={};i[e]=t,r(e)?l.setCommonProperties(i):l.setGroupProperties(i)}},s.hasStudentAccount=function(){return f==o.OFFLINE||f==o.ONLINE},s.getStudentAccountUserId=function(){return o.getUserId()},s.getStudentAccountUserName=function(){return o.getUserName()},s.getStudentAccountEmail=function(){return o.getEmail()},s.getStudentAccountProviderId=function(){return o.getProviderId()},s.getStudentAccountProviderHumanId=function(){return o.getProviderHumanId()},s.getStudentAccountToken=function(){return o.getUserToken()},s.getStudentAccountClassName=function(){return o.getUserClassName()},s.isCoAccount=function(){return o.isCoAccount()},o.initialized().then(function(){p(o.getState()),o.registerStateChangeCallback(p)},function(){p(o.ANONYMOUS)})}),s}.bind(null,n(1),n(16));e.exports={bindToContext:r}},92:function(e,t,n){var r=n(47).valueOrCacheValue,o=(n(70).addWeblinkIframe,n(120).displayName),i=function(e,t,n,i,a,s,u,l,c,d,f){var p=f.bwConfig,h=f.credentialstorage,g=f.studentaccountui,m=f.throbber,v={INIT:-1,ANONYMOUS:0,OFFLINE:1,ONLINE:2},b=t.Deferred(),w=t.Deferred();return v.initialized=function(){return b.resolve(),w},p.getConfig().then(function(s){var f=u.getParameters(),p=c.isLTI(),y=f.sso,C=f.login_hint,D=u.getParameters(!1).toplevel,A=p&&!D||f.no_logout||y,E=v.INIT,_=!1;v.stateChangeCallbacks=[],v.registerStateChangeCallback=function(e){this.stateChangeCallbacks.push(e)},v.triggerStateChangeCallbacks=function(){for(var e=[],n=0;n<this.stateChangeCallbacks.length;++n)e.push(this.stateChangeCallbacks[n](E,_));return t.when.apply(null,e)},v.onlinecheck_enabled=!1,v.onlinecheck_count=0;var S=null,k=.5;function x(){return"no"!==s.support_student_account||c.isLTI()||y}v.isStudentAccountsSupported=x,v.setCredentials=function(e,t){var n={username:o(e),userid:e.id,email:e.email,providerid:e.providerID,providerhumanid:e.providerHumanID,provider:e.provider,school:t,className:e.className,token:e.token,sid:null,coaccount:e.isCoAccount};l.setCredentials(n),h.setCredentials(l.credentials())},v.clearCredentials=function(){l.clear(),h.setCredentials(l.credentials())},v.loadCredentials=function(){return t.Deferred(function(e){h.getCredentials().done(function(t){null!==t?l.setCredentials(t):l.clear(),e.resolve(l.credentials())}).fail(function(){console.log("credentials load failure"),l.clear(),e.resolve(l.credentials())})}).promise()},v.getStudentInfo=function(e,n,r){var o,i=null,a=null;(null!=e&&""!==e?a={Authorization:"BWWAAuthToken "+e}:null!=n&&""!==n&&(i={sid:n}),r)&&((i=null!==(o=i)&&void 0!==o?o:{}).pc=r);return t.ajax({type:"GET",dataType:"json",data:i,url:s.student_account_server+"/student/GetInfo",headers:a,timeout:1e4})},v.checkIfOnline=function(e){if(!this.onlinecheck_enabled)return t.when();var n=t.Deferred(),r=l.getUserToken();return this.getStudentInfo(r,null,++this.onlinecheck_count).done(function(e){console.log("Got back online !"),v.goOnline(),n.resolve()}).fail(function(){n.reject()}),n},v.goOffline=function(t){console.log("goOffline");var n=this;e.pushAsyncFunc(function(){return console.log("Executing goOffline"),n.setState(v.OFFLINE)},null,null,!0)},v.goOnline=function(t){console.log("goOnline");var n=this;e.pushAsyncFunc(function(){return console.log("Executing goOnline"),n.setState(v.ONLINE)},null,null,!0)},v.scheduleOnlineCheck=function(){var e=this;k=Math.min(2*k,20),this.onlinecheck_enabled&&(S=setTimeout(function(){e.checkIfOnline().always(function(){e.scheduleOnlineCheck()})},1e3*k))},v.startOnlineCheck=function(){this.onlinecheck_enabled=!0,this.onlinecheck_count=0,k=.5,this.scheduleOnlineCheck()},v.stopOnlineCheck=function(){this.onlinecheck_enabled=!1,null!==S&&clearTimeout(S)},v.setState=function(e){return e===E?(console.log("Warning: setting identical storage state, ignoring",e),t.when()):(E===v.OFFLINE&&this.stopOnlineCheck(),e===v.OFFLINE&&this.startOnlineCheck(),E=e,this.triggerStateChangeCallbacks())},v.setForceOfflineStorage=function(){return!1===_&&(_=!0),this.triggerStateChangeCallbacks()},v.setUserInfo=function(e,t){console.log("Log in successfull"),this.setCredentials(e,t),this.setState(this.ONLINE)},v.waitForExternalLogin=function(e,n){return n=n||2e3,t.Deferred(function(r){var o=null,a=null;var u=g.createPollingUI(function(){o&&clearTimeout(o),a&&a.abort(),l(),r.reject()});function l(){u.close()}!function u(){o=null;var c={sid:e.sid};a=t.ajax({type:"GET",dataType:"json",data:c,url:s.student_account_server+"/student/GetInfo",timeout:1e4,success:function(e){a=null,l(),r.resolve(e)},error:function(e,t,s){if(a=null,"abort"!==t)if(401===e.status||0===e.status)try{0===e.status||"authenticating"===JSON.parse(e.responseText).auth.status?o=setTimeout(u,n):(l(),r.reject({msg:i("Authentication error.")}))}catch(e){l(),r.reject({msg:i("Server error when signing in.")})}else l(),r.reject({msg:i("Received error trying to sign in")+" ("+e.status+")"})}})}()}).promise()},v.serverLogin=function(e,n,r){return t.Deferred(function(o){var a={schoolCode:e,username:n,password:r};return t.ajax({type:"POST",data:a,url:s.student_account_server+"/student/Login",timeout:1e4}).done(function(e){o.resolve(e)}).fail(function(e){401==e.status?o.reject({msg:i("Wrong username or password, please try again.")}):o.reject({msg:i("Received error trying to sign in")+" ("+e.status+")"})})}).promise()},v.login=function(e,n,r){var o=this;return t.Deferred(function(t){"oauth"===n||"signup"===r.action?o.waitForExternalLogin(e).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}):"login"===r.action?o.serverLogin(r.school,r.username,r.password).done(function(e){t.resolve(e,r.school)}).fail(function(e){t.reject(e)}):t.reject({msg:"Unsupported login action"})}).promise()},v.getLoginCredentials=function(e,n){return t.Deferred(function(t){"oauth"===n?t.resolve(e,n):"bw"===n?g.queryBWCredentials(e).done(function(r){t.resolve(e,n,r)}).fail(function(e){t.reject(e)}):"school"===n?g.querySchoolCredentials(e).done(function(r){t.resolve(e,n,r)}).fail(function(e){t.reject(e)}):t.reject({msg:"Unsupported login type: "+n})}).promise()},v.hasSchool=function(){return s.hasOwnProperty("student_account_school")&&s.student_account_school.hasOwnProperty("code")&&null!==s.student_account_school.code&&""!==s.student_account_school.code&&"null"!==s.student_account_school.code},v.selectLoginType=function(e){var r=this;return t.Deferred(function(t){if(e.oauth_links.length>0||!r.hasSchool()){if(y)for(var o=0;o<e.oauth_links.length;++o){var a=e.oauth_links[o];if(a.provider===y)return void n.navigateAlert(i("You need to be signed in to use this widget."),i("Please sign in"),i("OK"),a.url)}g.queryLoginMethod(e).done(function(n){t.resolve(e,n)}).fail(function(e){t.reject(e)})}else t.resolve(e,"school")}).promise()},v.getLoginInfo=function(){var e=f.lfq?u.split(f.lfq):{};e.schoolCode=this.hasSchool()?s.student_account_school.code:"",y?e.providers=y:s.student_account_authrestrict&&"yes"===s.student_account_authrestrict&&(e.providers=(s.student_account_authproviders||[]).join(",")),e.source=function(e){var t=a.getPlatform();return"ibw-platform-ipad-ibooks"===t||"ibw-platform-ipad-ibooks-epub"===t?"ibooks-ios":"ibw-platform-ipad-bookwidgets"===t?a.isPreview()?"bwapp-preview":"bwapp":"ibw-platform-osx-ibooks"===t||"ibw-platform-osx-ibooks-epub"===t?"ibooks-osx":"ibw-platform-osx-preview"===t||"ibw-platform-win32-preview"===t?"bw-preview":"ibw-platform-android-chrome"!==t||e?a.isPreview()?"create-preview":a.isTopLevelPlay()?"play":"embed":"embed"}(!!y),s.kmuserid&&""!=s.kmuserid&&(e.creator=s.kmuserid),"undefined"!=typeof bwshortcode&&(e.widget=bwshortcode),a.isIOS()&&(e.ios="1"),e.q=r(f.q);var n=m("body");return t.Deferred(function(r){t.ajax({type:"GET",dataType:"json",data:e,url:s.student_account_server+"/student/GetLoginForm",timeout:1e4}).done(function(e){n.close(),r.resolve(e)}).fail(function(e){n.close(),400==e.status?r.reject({msg:i("Widget configuration error: school doesn't exist.")}):r.reject({msg:i("Could not connect to server, check your internet connection.")})})}).promise()},v.reportFailure=function(e){return e&&e.hasOwnProperty("msg")?g.showMessage(e.msg,i("Sign in failed")):t.when(!0)},v.requestSignin=function(){var e=this;return t.Deferred(function(t){e.getLoginInfo().then(e.selectLoginType.bind(e)).then(e.getLoginCredentials.bind(e)).then(e.login.bind(e)).then(e.setUserInfo.bind(e)).then(function(){t.resolve(!1)}).fail(function(n){e.reportFailure(n).done(function(e){t.resolve(!e)})})}).promise()},v.showLoginStateInfo=function(){return E===v.OFFLINE?g.queryLogout(i("Offline"),i("You're currently offline and logged in as user:"),this.getUserName(),A):E===v.ONLINE?g.queryLogout(i("Online"),i("You're currently online and logged in as user:"),this.getUserName(),A):t.when()},v.loopLoginUntilOnline=function(e){var t=this;this.requestSignin().done(function(n){E===t.ONLINE?e.resolve():n?t.loopLoginUntilOnline(e):g.showMessage(i("You need to be signed in to use this widget."),i("Please sign in")).done(function(){t.loopLoginUntilOnline(e)})})},v.forceLogin=function(){var e=t.Deferred();return this.loopLoginUntilOnline(e),e},v.setAnonymousOrForceLogin=function(){c.isEmbeddedLTI()?this.loginLTI():"optional"===s.support_student_account?(this.setState(this.ANONYMOUS),w.resolve()):this.forceLogin().done(function(){w.resolve()})},v.initializeWithStoredCredentials=function(e){var t=this,n=e.token,r=e.sid,o=null!=n&&""!==n;if(!1===o&&!1===(null!=r&&""!==r)||x()&&this.hasSchool()&&s.student_account_school.code!==e.school)this.setAnonymousOrForceLogin();else{var i=m("body");t.getStudentInfo(n,r).done(function(n){if(i.close(),y&&!r&&(n.provider!==y||!C||0==C.length||n.providerID!==C&&n.providerHumanID!==C))return console.log("Logged in with incompatible credentials. Re-login."),void t.setAnonymousOrForceLogin();t.setCredentials(n,e.school),t.setState(v.ONLINE),w.resolve()}).fail(function(e){i.close(),console.log("Error getting student info -> either invalid token or wrong connection"),o&&401!==e.status?(t.setState(v.OFFLINE),w.resolve()):t.setAnonymousOrForceLogin()})}},v.loginLTI=function(){var e=m("body"),r=this;t.ajax({type:"POST",data:{lti:u.urlencode(u.getParameters()),url:window.location.protocol+"//"+window.location.host+window.location.pathname,wa:s.WA,id:s.uuid2},headers:d.getAJAXHeaders(),url:s.student_account_server+"/student/Login",timeout:1e4}).then(function(t){e.close(),c.setEmbeddedLTIAuthenticated(),r.setCredentials(t,null),r.setState(v.ONLINE),w.resolve()},function(t){e.close();try{var o=JSON.parse(t.responseText);if("noLTILicense"==o.code)return r.setState(r.ANONYMOUS),void w.reject();if(null!=o.message&&o.message.length>0)return void n.showFatalAlert(o.message,i("Error"))}catch(e){}0===t.readyState?n.showFatalAlert(i("You need an internet connection to access this widget."),i("Error")):n.showFatalAlert(i("Error signing in."),i("Error"))})},v.initialize=function(){var e=this;t(function(){if(!x())return e.setState(e.ANONYMOUS),void w.resolve();var t=f.sid;return t?(window.WidgetParams||history.replaceState("",document.title,window.location.pathname+window.location.search+u.removeQueryStringParameter(u.getHash(),"sid")),void e.initializeWithStoredCredentials({sid:t})):!c.isEmbeddedLTI()||c.isEmbeddedLTIAuthenticated()?!p&&a.isPreview()?(e.setState(e.ANONYMOUS),void w.resolve()):void e.loadCredentials().done(e.initializeWithStoredCredentials.bind(e)):void e.loginLTI()})},b.then(function(){v.initialize()}),v.logout=function(){return this.clearCredentials(),"optional"===s.support_student_account?this.setState(v.ANONYMOUS):(m("body"),window.location.reload(!1)),t.when().promise()},v.requestSignout=function(){return this.showLoginStateInfo().done(this.logout.bind(this))},v.getUserToken=function(){return l.getUserToken()},v.getUserSid=function(){return l.getUserSid()},v.getUserName=function(){return l.getUserName()},v.getUserClassName=function(){return l.getUserClassName()},v.getUserId=function(){return l.getUserId()},v.getEmail=function(){return l.getEmail()},v.getProviderId=function(){return l.getProviderId()},v.getProviderHumanId=function(){return l.getProviderHumanId()},v.isCoAccount=function(){return l.isCoAccount()},v.getState=function(){return E},v.getForceOfflineStorage=function(){return _},v.hasProperty=function(e){return"user_id"===e},v.getProperty=function(e){if("user_id"==e)return this.getUserId()}}),v}.bind(null,n(63),n(1),n(21),n(17),n(5),n(40),n(16),n(60),n(45),n(121));e.exports={bindToContext:i}},93:function(e,t,n){var r=function(e,t,n,r,o){var i=o.bwConfig,a=o.studentaccount,s=i.getConfigSync();return{init:function(o){var i=this;function u(){return a.getState()===a.ANONYMOUS?a.requestSignin():a.requestSignout()}this.studentAccountButtonUI=o;var l=function(e){var n="anonymous",r=t("Not signed in");switch(e){case a.OFFLINE:n="offline",r=t("You're offline");break;case a.ONLINE:n="online";var o=a.getUserName();-1!=o.indexOf("@")&&(o=o.substring(0,o.indexOf("@"))),r=o}i.studentAccountButtonUI.setState(n,r)};this.studentAccountButtonUI.create(function(){if(n.isPreview()){var o=a.hasSchool()?t("Students need school accounts associated with %(school)s (%(schoolCode)s) in order to sign in.").replace("%(school)s",s.student_account_school.name).replace("%(schoolCode)s",s.student_account_school.code)+"<br><br>":t("Any BookWidgets student account can be used to sign in.")+"<br><br>";r.showAlert(t("Your widget will require students to sign in.")+"<br><br>"+o+t("In widget preview mode sign in is not required / not supported."),t("Sign in not available"))}else e.pushAsyncFunc(u)}),l(a.ANONYMOUS),a.initialized().then(function(){l(a.getState()),a.registerStateChangeCallback(l)},function(){l(a.ANONYMOUS),i.studentAccountButtonUI.hide()})}}}.bind(null,n(63),n(17),n(5),n(21));e.exports={bindToContext:r}},94:function(e,t,n){var r=n(14).each,o=function(e,t,n,o){var i,a,s,u,l,c=o.bwConfig,d=o.studentaccount,f=o.studentaccountbutton,p=o.bwdsstorage,h=o.writecachingonlinestorage,g=o.StorageBusyMarker,m=o.throbber,v=o.StudentAccountButtonUI,b={},w="",y=!1,C=t.getParameters(),D=C.hasOwnProperty("teacher_id")?C.teacher_id:"",A=C.hasOwnProperty("school_id")?C.school_id:"",E=C.hasOwnProperty("course_id")?C.course_id:"",_=C.hasOwnProperty("student_class_id")&&!C.hasOwnProperty("iscid")?C.student_class_id:"",S=C.hasOwnProperty("context_id")?C.context_id:"";b.WIDGET_ANONYMOUS=0,b.WIDGET_OFFLINE=1,b.WIDGET_ONLINE=2;var k=null,x=-1,O=!1;function I(){return x!==b.WIDGET_ONLINE||O?e.when(!1):k.moveImageOnlineIfRequired()}function F(){n.pushAsyncFunc(I).done(function(e){e&&F()})}function T(){var t=m("body"),n=e.Deferred();return g.start(),k.loadAll(function(e){g.end(),t.close(),Promise.resolve(i(e)).then(function(){F(),n.resolve()})}),n}b.stateChanged=function(t,n){if(t===x&&n===O)return console.log("Warning: setting identical storage state, ignoring"),e.when();if(x===b.WIDGET_OFFLINE&&t===b.WIDGET_ONLINE&&!0===n)return x=t,O=n,e.when();var r="no"!==c.getConfigSync().save_answers;switch(t){case b.WIDGET_ANONYMOUS:console.log("Using anonymous storage"),k=p.createWidgetStorage(s,a,l,y,"",w,r);break;case b.WIDGET_ONLINE:if(!1===n){console.log("Using online storage"),k=h.createWidgetStorage(s,a,u,l,y,d.getUserId(),w,D,A,E,null==_||""===_?d.getUserClassName()?d.getUserClassName():"":_,S);break}case b.WIDGET_OFFLINE:console.log("Using offline storage"),k=p.createWidgetStorage(s,a,l,y,d.getUserId(),w,r)}var o,f=x,m=O;return x=t,O=n,function(e,t){return-1!=e&&e+t<3}(f,t)?T():f===b.WIDGET_OFFLINE&&t===b.WIDGET_ONLINE?(o=e.Deferred(),g.start(),k.goneOnlineSync(function(e){g.end(),"CONFLICT"==e.status&&i(e.data),"OFFLINE"!==e.status&&F(),o.resolve()}),o):f===b.WIDGET_ONLINE&&t===b.WIDGET_OFFLINE||m!==O?function(){var t=e.Deferred();return k.loadAll(function(e){t.resolve()}),t}():e.when()},b.init=function(e){var t=this;i=e.updateCallback,a=e.type,s=e.group,u=e.name,l=e.id,y=e.singleKey,w=e.extension,g.init(),d.initialized().then(function(){t.stateChanged(d.getState(),d.getForceOfflineStorage()),T(),d.registerStateChangeCallback(t.stateChanged.bind(t))},function(){t.stateChanged(d.ANONYMOUS,!0),T()});var n=!!e.hide_account;d.isStudentAccountsSupported()&&!n&&f.init(v)};var B=null;function N(e,t){var n=e||{};for(var r in t)n[r]=t[r];return n}function P(t){var r=e.Deferred();return g.start(),k.write(t,function(e){g.end(),e&&"CONFLICT"===e.status&&(i(e.data),n.remove(P)),r.resolve()}),r}return b.prepareStorageUpgrade=function(e){B=e},b.write=function(e){null!==k&&(null!=B&&(e=N(B,e),B=null),n.pushAsyncFunc(P,e,y?function(e,t){return t}:N))},b.registerImage=function(t){var r=e.Deferred(),o=(new Date).getTime()+function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}(5);return n.pushSyncFunc(function(){k.writeImage(o,t).done(function(){r.resolve("bwimg:"+o)}).fail(function(){r.reject()})}),r},b.clearImage=function(t){var r=e.Deferred();return 0!==t.indexOf("bwimg:")?(r.reject(),r):(n.pushSyncFunc(function(){var e=t.substring(6);k.clearImage(e).done(function(){r.resolve()}).fail(function(){console.log("Could not clear image"),r.reject()})}),r)},b.getImageUrl=function(t){var r=e.Deferred();return 0!==t.indexOf("bwimg:")?(r.resolve(t),r):(n.pushSyncFunc(function(){var e=t.substring(6);k.readImage(e).done(function(e){r.resolve(e)}).fail(function(){r.reject("")})}),r)},b.sync=function(e){n.pushSyncFunc(e)},b.clear=function(){},b.throttlers=[],b.createThrottler=function(e){var t={cb:e,maxdelay:arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,timeout:null,flush:function(){null!=this.timeout&&(this.clear(),this.cb())},cancel:function(){null!=this.timeout&&(clearTimeout(this.timeout),this.clear())},clear:function(){this.timeout=null,g.end()},trigger:function(){var e=this;null!=this.cb&&null==this.timeout&&(g.start(),this.timeout=setTimeout(function(){e.flush()},this.maxdelay))}};return this.throttlers.push(t),t},b.cancelThrottlers=function(){r(this.throttlers,function(e){e.cancel()})},b.flushThrottlers=function(){r(this.throttlers,function(e){e.flush()})},b}.bind(null,n(1),n(16),n(63));e.exports={bindToContext:o}},95:function(e,t,n){var r=function(){return(new Date).getTime()};var o=function(){var e=null;try{(e=parseInt(sessionStorage.getItem("widget-storage-session")))&&"true"===sessionStorage.getItem("widget-session-running-"+e)&&(e=null)}catch(t){e=null}if(null==e||isNaN(e)){e=r();try{sessionStorage.setItem("widget-storage-session",e)}catch(e){}}try{sessionStorage.setItem("widget-session-running-"+e,"true")}catch(e){}return window.addEventListener("beforeunload",function(){try{sessionStorage.removeItem("widget-session-running-"+e)}catch(e){}}),e}(),i=function(e,t){var n=t.bwConfig,i=t.studentaccount,a=t.blob,s=t.dialog,u=t.tr,l=n.getConfigSync();function c(e){var t,n;s.showInfoMessage(u("Your working copy of %s was submitted by your teacher.").replace("%s",(t=new Date(e.storage_timestamp),n=window.navigator.userLanguage||window.navigator.language,new Intl.DateTimeFormat(n,{dateStyle:"full",timeStyle:"long"}).format(t))))}return{createWidgetStorage:function(t,n,d,f,p,h,g,m,v){var b={},w=null,y=null,C=-1,D=null;function A(t,n){var r=i.getUserToken();return e.ajax({type:"POST",data:t,url:n,headers:{Authorization:"BWWAAuthToken "+r},timeout:3e4,connectTimeout:2e3,beforeSend:function(e,t){var n=this,r=t.xhr;t.xhr=function(){var e=r();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}}})}return b.loadAll=function(r){var a,b,A,E={"widget-id":d,"widget-type":t,"widget-name":n,"teacher-id":p,"school-id":h,"course-id":g,"class-id":m,"context-id":v,"session-id":o};"undefined"!=typeof bwshortcode&&(E["widget-shortcode"]=bwshortcode),a=E,b=function(e){w=e.id,y=e.url,C=e.version,D=JSON.parse(e.data),e.isObserved&&s.showInfoMessage(u("Your progress on this activity will be shared with your teacher.")),e.submissionInfo&&e.submissionInfo.storage_timestamp&&c(e.submissionInfo);try{r(f?D.hasOwnProperty("DATA")?D.DATA:"":D,C)}catch(e){console.error("Error in widget load callback"),console.error(e)}},A=function(e){403===e.status?(console.log("Online  storage nog allowed in this case, use offline storage: ",e.responseText),i.setForceOfflineStorage()):(console.error("Got error reading widget data"),i.goOffline()),r(f?null:{},-1)},e.ajax({type:"GET",dataType:"json",data:a,timeout:3e4,headers:{Authorization:"BWWAAuthToken "+i.getUserToken()},url:l.student_account_server+"/widget-storage/",connectTimeout:2e3,beforeSend:function(e,t){var n=this,r=t.xhr;t.xhr=function(){var e=r();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}},success:b,error:A})},b.overwrite=function(t,n,a){var s=f?{DATA:t}:t;!function(t,n,a,s,u,l,c){var d={version:a,data:JSON.stringify(s),i:1,"session-id":o,timestamp:r()};c&&(d.sync=1);var f=i.getUserToken();e.ajax({type:"PUT",contentType:"text/plain",data:JSON.stringify(d),url:n,headers:{Authorization:"BWWAAuthToken "+f},timeout:3e4,success:u,error:l})}(0,y,C,s,function(e){C=e.version,e.hasOwnProperty("url")&&(y=e.url),D=e.hasOwnProperty("data")?JSON.parse(e.data):s,n({status:"OK",data:f?D.hasOwnProperty("DATA")?D.DATA:null:D,version:C})},function(e,t,r){if(console.log("Got error putting widget data"),409==e.status){console.log("Conflict, someone wrote newer data");var o=JSON.parse(e.responseText);C=o.version,D=JSON.parse(o.data),n({status:"CONFLICT",data:f?D.hasOwnProperty("DATA")?D.DATA:null:D,version:C})}else i.goOffline(),n({status:"OFFLINE"})},a)},b.write=function(e,t){this.overwrite(f?e:function(e,t){var n=e||{};for(var r in t){var o=t[r];null===o?delete n[r]:n[r]=o}return n}(D,e),t)},b.setNextUploadVersion=function(e){C=e},b.writeImage=function(t,n){var r=e.Deferred();return function(e,t){return A({name:t,confirm:"1",contentType:"image/jpeg"},l.student_account_server+"/widget-storage/"+e+"/resources")}(w,t).done(function(t){(function(t,n,r){var o=new a([r],{type:"image/jpeg"});return e.ajax({url:t,data:o,processData:!1,contentType:o.type,type:"PUT"})})(t.upload_url,0,n).done(function(){var e;(e=t.confirm_url,A({},e)).done(function(){r.resolve()}).fail(function(){console.log("confirming upload failed"),i.goOffline(),r.reject()})}).fail(function(){console.log("upload resource failed"),i.goOffline(),r.reject()})}).fail(function(){console.log("getting image url failed"),i.goOffline(),r.reject()}),r},b.clearImage=function(t){return e.Deferred().resolve()},b.readImage=function(t){var n=l.student_account_server+"/widget-storage/"+w+"/resources/"+t,r=i.getUserToken(),o=e.Deferred();return e.ajax({url:n,headers:{Authorization:"BWWAAuthToken "+r},type:"GET"}).done(function(t){e.ajax({url:t.url,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()})}).fail(function(){o.reject()}),o},b.sync=function(e){e()},b.setSessionID=function(e){o=e},b}}}.bind(null,n(1));e.exports={bindToContext:i}},96:function(e,t,n){var r=function(e,t,n,r){var o=r.bwds,i=!1;function a(t){var r=n.Deferred();return o.remove(t,function(t){return null===t||t.code==e.BWDS_ERROR_UNKNOWN?r.resolve():(console.log("Remove failed: "+JSON.stringify(t)),r.reject()),r}),r}function s(r,a,s){var u=n.Deferred();return o.write(r,a,function(n){if(null===n)u.resolve();else{if(s&&!1===i){if(n.code==e.BWDS_ERROR_SECURITY){var r=t.getPlatform();"ibw-platform-ipad-ibooks-epub"===r||"ibw-platform-ipad-ibooks"===r?window.criticalAlert("Unable to save your answer, please restart iBooks to solve this issue.<br>"+r.getIOSIBooksRestartInfo(),"Storage error"):window.criticalAlert("Storing answers not supported on this platform.","Storage error")}else window.criticalAlert("Could not save your answer.","Storage problem");i=!0}console.log("Save failed"),u.reject()}}),u}function u(r,a){var s=n.Deferred();return o.read(r,function(n,r){if(null===n)r?s.resolve(r):(console.log("How did this happen?  No saved data on read!"),s.reject({}));else{if(a&&!1===i)if(n.code==e.BWDS_ERROR_SECURITY){var o=t.getPlatform();"ibw-platform-ipad-ibooks-epub"===o||"ibw-platform-ipad-ibooks"===o?window.criticalAlert("Unable to save your answer, please restart iBooks to solve this issue.<br>"+o.getIOSIBooksRestartInfo(),"Storage error"):window.criticalAlert("Storing answers not supported on this platform.","Storage error"),i=!0}else n.code!=e.BWDS_ERROR_UNKNOWN&&(console.log("Error "+n.code+" occurred while loading data: "+n.message),window.criticalAlert("Storing answers not supported on this platform.","Storage error"),i=!0);s.reject({})}}),s}function l(e,t){var n=e||{};for(var r in t){var o=t[r];null===o?delete n[r]:n[r]=o}return n}return{createWidgetStorage:function(e,t,r,i,c,d,f){var p={},h=""==c?"":c+"/";function g(){return h+"books/"+e+"/"+t+"/"+r}var m={};function v(e){return g()+"/img/"+e}return p.loadAll=function(e){var t,r;i?u(g()+d,f).done(e).fail(function(){e(null)}):""!==c?u(g(),f).always(function(t){try{var n=JSON.parse(t);m=n,e(JSON.parse(t))}catch(t){console.log("Can't parse bwds user data"),console.log(t),e(m)}}):(t=g(),r=n.Deferred(),o.dir(t,function(e,t){null===e?r.resolve(t):r.reject(e)}),r).done(function(t){var r={},i=[];function a(e,t,n){o.read(e+"/"+t,function(e,o){null===e?r[t]=o:console.log("Received error reading: "+t),n.resolve()})}for(var s=0;s<t.length;++s){var u=n.Deferred();i.push(u),a(g(),t[s],u)}n.when.apply(null,i).done(function(){e(r)})}).fail(function(t){e({})})},p.write=function(e,t){if(i)null===e?a(g()+d).always(t):s(g()+d,e,f).always(t);else if(""!==c)m=l(m,e),s(g(),JSON.stringify(m),f).always(t);else{var r=[];for(var o in e){var u=e[o];null===u?r.push(a(g()+"/"+o)):r.push(s(g()+"/"+o,u,f))}n.when.apply(null,r).always(t)}},p.overwriteAndSetVersion=function(e,t){var r=n.Deferred();if(i)null===e?a(g()+d).always(function(){r.resolve()}):s(g()+d,e,f).always(function(){p.setVersion(t).always(function(){r.resolve()})});else if(""!==c){var o=JSON.stringify(e);m=JSON.parse(o),s(g(),o,f).always(function(){p.setVersion(t).always(function(){r.resolve()})})}else console.error("bwds_storage_if.overwriteAndSetVersion not implemented for this storage mode... only intended for local caching"),r.reject();return r},p.setVersion=function(e){var t=n.Deferred(),r=g();return i&&(r+=d),o.stat(r,function(n,i,a){null===n?o.setStat(r,{backup_date:i.modified,backup_version:e},function(e){null===e?t.resolve():(console.log("Problem writing stat: "+JSON.stringify(e)),t.reject())}):(console.log("Got error reading stat for "+r+": means offline mode won't work"),t.reject())}),t},p.getVersion=function(e){var t=g();i&&(t+=d),o.stat(t,function(t,n,r){null===t?e({version:n.backup_version,offlinedata:n.backup_date!=n.modified,hasdata:!0}):(console.log("Error reading stat... assume there is no data"),e({version:0,offlinedata:!1,hasdata:!1}))})},p.writeImage=function(e,t){return s(v(e),t,f)},p.clearImage=function(e){return a(v(e))},p.isImageBackedUp=function(e){var t=n.Deferred();return o.stat(v(e),function(e,n,r){null===e?t.resolve(n.backup_date==n.modified):t.reject()}),t},p.listImagesAndBackupStatus=function(){var e=n.Deferred();return o.stat(g()+"/img",function(t,n,r){if(null===t){for(var o=[],i=0;i<r.length;++i){var a=r[i].name;!0!==r[i].removed&&o.push({id:a.substring(a.lastIndexOf("/")+1),backed_up:r[i].backup_date===r[i].modified})}e.resolve(o)}else e.resolve([])}),e},p.setImageBackedUp=function(e){var t=n.Deferred();return o.stat(v(e),function(n,r,i){null===n?o.setStat(v(e),{backup_date:r.modified},function(e){null===e?t.resolve():t.reject()}):t.reject()}),t},p.readImage=function(e){return u(v(e),f)},p.sync=function(e){o.executeSync(e)},p},createInfoStorage:function(e,t,n){var r={},o={},i={};function a(e){return(""==t?"":t+"/")+"info/"+e}return u(a("BWCommon"),n).always(function(e){try{o=JSON.parse(e)}catch(e){o={}}}),u(a(e),n).always(function(e){try{i=JSON.parse(e)}catch(e){i={}}}),r.getCommonProperties=function(e){e(o)},r.getGroupProperties=function(e){e(i)},r.setCommonProperties=function(e){o=l(o,e),s(a("BWCommon"),JSON.stringify(o),n)},r.setGroupProperties=function(t){i=l(i,t),s(a(e),JSON.stringify(i),n)},r}}}.bind(null,n(46),n(5),n(1));e.exports={bindToContext:r}},97:function(e,t,n){var r=(0,n(26).createLogger)("WriteCachingOnlineStorage"),o=function(e,t){var n=t.studentaccount,o=t.onlinestorage,i=t.bwdsstorage;return{createWidgetStorage:function(t,a,s,u,l,c,d,f,p,h,g,m){var v={};return v.os=o.createWidgetStorage(a,s,u,l,f,p,h,g,m),v.bs=i.createWidgetStorage(t,a,u,l,n.getUserId(),d,!1),v.loadAll=function(t){r.debug("loadAll");var n=e.Deferred(),o=e.Deferred();this.os.loadAll(function(e,t){r.debug("loadAll OS",t,e),n.resolve(e,t)}),this.bs.getVersion(function(e){r.debug("loadAll BS",e),o.resolve(e)});var i=this;e.when(n,o).done(function(e,n){var o=e[0],a=e[1];-1==a?(console.log("error accessing online data, return local data or null"),n.hasdata?(r.debug("load BS data"),i.bs.loadAll(t)):(r.debug("empty data"),t(l?null:{}))):n.version<=a&&!1===n.offlinedata?(r.debug("loadall no offline BS data, use OS data"),i.bs.overwriteAndSetVersion(o,a).always(function(){r.debug("overwriteAndSetVersion done",o,a),t(o)})):(r.debug("have BS offline data"),i.os.setNextUploadVersion(n.version),i.bs.loadAll(function(e){r.debug("BS data loaded",e),i.os.overwrite(e,function(n){"OFFLINE"===n.status?(console.log("error when flushing local data"),t(e)):"CONFLICT"===n.status?(r.debug("goneOnlineSync online data conflict",n.version),i.bs.overwriteAndSetVersion(n.data,n.version).always(function(){t(n.data)})):(r.debug("loadAll online data written to version",n.version),i.bs.setVersion(n.version).always(function(){r.debug("loadAll bs version set"),t(e)}))},!0)}))})},v.goneOnlineSync=function(t){r.debug("goneOnlineSync");var n=e.Deferred(),o=e.Deferred();this.os.loadAll(function(e,t){r.debug("goneOnlineSync OS",t,e),n.resolve(e,t)}),this.bs.getVersion(function(e){r.debug("goneOnlineSync BS",e),o.resolve(e)});var i=this;e.when(n,o).done(function(e,n){var o=e[0],a=e[1];-1==a?(console.log("goneOnlineSync: Can't find online version"),t({status:"OFFLINE"})):n.version<a&&!1===n.offlinedata?(console.log("goneOnlineSync: local version out of date, need to use online version"),i.bs.overwriteAndSetVersion(o,a).always(function(){r.debug("goneOnlineSync returning conflict"),t({status:"CONFLICT",data:o})})):!0===n.offlinedata?(console.log("goneOnlineSync: latest version is local, pushing state online"),i.os.setNextUploadVersion(n.version),i.bs.loadAll(function(e){r.debug("goneOnlineSync: latest version loaded",e),i.os.overwrite(e,function(e){"OFFLINE"===e.status?(r.debug("goneOnlineSync data error when flushing local data"),t({status:"OFFLINE"})):"CONFLICT"==e.status?(r.debug("goneOnlineSync online data conflict",e.version),i.bs.overwriteAndSetVersion(e.data,e.version).always(function(){t(e)})):(r.debug("goneOnlineSync online data written to version",e.version),i.bs.setVersion(e.version).always(function(){r.debug("WriteCachingOnlineStorage goneOnlineSync bs version set"),t({status:"OK"})}))},!0)})):t({status:"OK"})})},v.write=function(e,t){var n=this;n.bs.write(e,function(){n.os.write(e,function(e){void 0!==e&&e.hasOwnProperty("data")?n.bs.overwriteAndSetVersion(e.data,e.version).always(function(){t(e)}):t(e)})})},v.writeImage=function(t,n){var r=e.Deferred(),o=this;return o.bs.writeImage(t,n).done(function(){r.resolve(),o.os.writeImage(t,n).done(function(){o.bs.setImageBackedUp(t)}).fail(function(){})}).fail(function(){o.os.writeImage(t,n).done(function(){r.resolve()}).fail(function(){r.reject()})}),r},v.clearImage=function(t){var n=e.Deferred();return e.when(this.bs.clearImage(t),this.os.clearImage(t)).done(function(){n.resolve()}).fail(function(){n.reject()}),n},v.readImage=function(t){r.debug("WriteCachingOnlineStorage readImage",t);var n=e.Deferred(),o=this;return o.bs.readImage(t).done(function(e){n.resolve(e)}).fail(function(){o.os.readImage(t).done(function(e){n.resolve(e)}).fail(function(){n.reject()})}),n},v.moveImageOnline=function(t){r.debug("WriteCachingOnlineStorage moveImageOnline",t);var n=e.Deferred(),o=this;return o.bs.readImage(t).done(function(e){r.debug("Read image data and moving it online"),o.os.writeImage(t,e).done(function(){r.debug("image written online, setting backed up tag"),o.bs.setImageBackedUp(t).always(function(){n.resolve()})}).fail(function(){r.debug("moving image online failed"),n.reject()})}).fail(function(){r.debug("error reading image"),n.reject()}),n},v.moveImageOnlineIfRequired=function(){r.debug("WriteCachingOnlineStorage moveImageOnlineIfRequired");var t=e.Deferred(),n=this;return n.bs.listImagesAndBackupStatus().done(function(e){r.debug("WriteCachingOnlineStorage moveImageOnlineIfRequired image list:",e);for(var o=0;o<e.length;++o)if(!1===e[o].backed_up)return void n.moveImageOnline(e[o].id).done(function(){r.debug("moveImageOnline succeeded"),t.resolve(!0)}).fail(function(){r.debug("moveImageOnline failed"),t.reject()});t.resolve(!1)}),t},v},createInfoStorage:function(e,t,r){var o={};return o.bs=i.createInfoStorage(e,n.getUserId(),!1),o.getCommonProperties=function(e){this.bs.getCommonProperties(function(t){e(t)})},o.getGroupProperties=function(e){this.bs.getGroupProperties(function(t){e(t)})},o.setCommonProperties=function(e){this.bs.setCommonProperties(e)},o.setGroupProperties=function(e){this.bs.setGroupProperties(e)},o}}}.bind(null,n(1));e.exports={bindToContext:o}},98:function(e,t,n){var r,o,i;e.exports=(r=n(1),(i={}).init=function(){0===r("#storage-busy-marker").length&&r(document.createElement("div")).attr("id","storage-busy-marker").appendTo(".closebutton-container"),o=0},i.start=function(){0==o&&r("#storage-busy-marker").addClass("busy"),++o},i.end=function(){0==--o&&r("#storage-busy-marker").removeClass("busy")},i)},99:function(e,t,n){var r=n(70).addWeblinkIframe;e.exports=function(e,t,n,o,i,a){var s={},u=e.getConfigSync();function l(){var e=i.getPlatform();return!!("ibw-platform-ipad-ibooks"===e||"ibw-platform-ipad-ibooks-epub"===e||"ibw-platform-osx-ibooks"===e||"ibw-platform-osx-ibooks-epub"===e||"ibw-platform-android-chrome"===e||i.isPreview()||"ibw-platform-ipad-bookwidgets"!==e&&!1===i.isTopLevelPlay())}function c(e){for(var t=0;t<e.bw_links.length;++t){var n=e.bw_links[t];if("bw-student"===n.name)return n}return null}function d(){return u.hasOwnProperty("student_account_school")&&u.student_account_school.hasOwnProperty("code")&&null!==u.student_account_school.code&&""!==u.student_account_school.code&&"null"!==u.student_account_school.code}return s.createDialog=function(e,n){var o=t(document.createElement("div")).addClass("bw-login-dialog-wrapper"),i=t(document.createElement("div")).css({position:"absolute",width:"100%",height:"100%",left:"0px",top:"0px"}).appendTo(o),a=t(document.createElement("div")).attr("id","bw-login-dialog").addClass("bw-row-container").appendTo(o);return n&&(o.addClass("bw-centering-container"),a.addClass("bw-centered")),o.appendTo("body"),e&&i.click(function(){o.remove(),e.reject()}),{close:o.remove.bind(o),show:function(e,n){var o;a.empty(),n&&t(document.createElement("div")).addClass("login-dialog-title bw-row-fixed").safeHtml(n).appendTo(a),e.appendTo(a),(o=a).find(".weblink").each(function(){r(t(this).parent()[0],t(this).attr("href"),!0,t(this).attr("message")),t(this).attr("href","")}),o.find(".external-link").each(function(){r(this,t(this).attr("href"),!1,t(this).attr("message")),t(this).attr("href","")})}}},s.queryLoginMethod=function(e){var n=this;return t.Deferred(function(r){var i=n.createDialog(r,!0),a=t(document.createElement("div")).addClass("login-type-selection login-dialog-body");var s,u=c(e),f=null!==u;function p(){removeEventListener("message",h),i.close()}function h(e){var t=e.data;t.hasOwnProperty("msg")&&"linkclicked"===t.msg&&(p(),r.resolve("oauth"))}e.oauth_links.length>0&&function(n,r){n=e.oauth_links;for(var i=0;i<n.length;++i){var a=n[i],s=l()&&a.toplevel,u=s?" weblink login-type-button":" login-type-button",c=s?"_blank":"_top",d=s?"":"setTimeout(function() { window.postMessage({ msg:'linkclicked'}, '*');}, 1000);";t(document.createElement("div")).addClass("web-link-wrapper"+u).append(t(document.createElement("a")).attr({message:"linkclicked",href:a.url,target:c,onclick:d}).safeHtml(o("Sign in using")+" "+a.name)).appendTo(r)}}(e.oauth_links,a),f&&(d()||(s=a,t(document.createElement("div")).addClass("login-type-button").safeHtml(o("Sign in using email and password")).tapOrClick(function(){r.resolve("bw"),p()}).appendTo(s)),function(e,n){t(document.createElement("div")).addClass("login-type-button").safeHtml(o("Sign in using school account")).tapOrClick(function(){r.resolve("school"),p()}).appendTo(n)}(0,a)),i.show(a,o("Sign in")),window.postMessage({msg:"requestlogin"},"*"),addEventListener("message",h)}).promise()},s.queryBWCredentials=function(e){var n=this;return t.Deferred(function(r){var i=n.createDialog(r,!0),a=c(e),s=t(document.createElement("div")).addClass("login-form login-dialog-body");function u(){removeEventListener("message",d),i.close()}function d(e){var t=e.data;t.hasOwnProperty("msg")&&"linkclicked"===t.msg&&(u(),r.resolve({action:"signup"}))}!function(e,n){var i=t(document.createElement("input")).addClass("login-dialog-field").attr({id:"bw-email",placeholder:o("Email"),tabindex:"1"}).appendTo(n),a=t(document.createElement("input")).addClass("login-dialog-field").attr({id:"bw-password",type:"password",placeholder:o("Password"),tabindex:"2"}).appendTo(n);t(document.createElement("button")).addClass("login-dialog-button").attr("tabindex","3").safeHtml(o("Sign in")).tapOrClick(function(){r.resolve({action:"login",school:"",username:i.val(),password:a.val()}),u()}).appendTo(n);var s=l(),c=s?" external-link":"",d=s?"_blank":"_top",f=s?"":"setTimeout(function() { window.postMessage({ msg:'linkclicked'}, '*');}, 1000);";e.hasOwnProperty("resetPasswordURL")&&t(document.createElement("a")).attr({href:e.resetPasswordURL,target:d,onclick:f}).safeHtml(o("Forgot password?")).addClass("bw-reset-password"+c).appendTo(n),e.hasOwnProperty("registerURL")&&(t(document.createElement("hr")).appendTo(n),t(document.createElement("p")).css("position","relative").appendSafe("Don't have an account?").append(t(document.createElement("br"))).append(t(document.createElement("a")).attr({message:"linkclicked",href:e.registerURL,target:d,onclick:f}).addClass("bw-signup"+c).safeHtml(o("Sign up here"))).appendTo(n))}(a,s),i.show(s,o("Sign in")),window.postMessage({msg:"requestlogin"},"*"),addEventListener("message",d)}).promise()},s.querySchoolCredentials=function(e){var n=this;return t.Deferred(function(e){var r,i=n.createDialog(e,!0),a=t(document.createElement("div")).addClass("login-form login-dialog-body");d()||(r=t(document.createElement("input")).attr({id:"school-school",placeholder:o("School code"),tabindex:"1"}).addClass("login-dialog-field").appendTo(a));var s=t(document.createElement("input")).attr({id:"school-username",placeholder:o("Username"),tabindex:"2"}).addClass("login-dialog-field").appendTo(a),l=t(document.createElement("input")).attr({id:"school-password",type:"password",placeholder:o("Password"),tabindex:"3"}).addClass("login-dialog-field").appendTo(a);t(document.createElement("button")).addClass("login-dialog-button").attr("tabindex","4").safeHtml(o("Sign in")).tapOrClick(function(){var t=d()?u.student_account_school.code:r.val();e.resolve({action:"login",school:t,username:s.val(),password:l.val()}),i.close()}).appendTo(a),i.show(a,d()?u.student_account_school.name:o("Sign in")),window.postMessage({msg:"requestlogin"},"*")}).promise()},s.queryLogout=function(e,n,r,i){var a=this;return t.Deferred(function(s){var u=a.createDialog(s),l=t(document.createElement("div")).attr("id","offline-dialog").addClass("login-dialog-body");t(document.createElement("p")).safeHtml(n).appendTo(l),t(document.createElement("div")).attr("id","login-current-user").appendTo(l).safeHtml(r||""),i||t(document.createElement("div")).addClass("login-dialog-button").safeHtml(o("Sign out")).tapOrClick(function(){u.close(),s.resolve()}).appendTo(l),u.show(l,e)}).promise()},s.showMessage=function(e,r){return t.Deferred(function(t){n.showAlert(e,r,o("OK"),function(){t.resolve()})})},s.createPollingUI=function(e){var n=this.createDialog(null,!0),r=t(document.createElement("div")).addClass("login-pollingdialog");return t(document.createElement("p")).safeHtml(o("Waiting for account sign in to complete...")).appendTo(r),t(document.createElement("div")).addClass("login-dialog-button").safeHtml(o("Cancel")).tapOrClick(e).appendTo(r),n.show(r,o("Waiting")),n},s}(n(22),n(1),n(21),n(17),n(5),n(40))}});